"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};
/*!     Underscore.js 1.5.2
 *     http://underscorejs.org
 *     @Copyright (c) 2009-2013 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 *     @License: Underscore may be freely distributed under the MIT license. */
/*!     Underscore.js 1.5.2
 *     http://underscorejs.org
 *     @Copyright (c) 2009-2013 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 *     @License: Underscore may be freely distributed under the MIT license. */
(function(){var e=this,t=e._,i={},n=Array.prototype,o=Object.prototype,a=Function.prototype,r=n.push,s=n.slice,l=n.concat,p=o.toString,c=o.hasOwnProperty,h=n.forEach,u=n.map,d=n.reduce,f=n.reduceRight,g=n.filter,m=n.every,y=n.some,v=n.indexOf,S=n.lastIndexOf,M=Array.isArray,E=Object.keys,L=a.bind,_=function(e){return e instanceof _?e:this instanceof _?void(this._wrapped=e):new _(e)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=_),exports._=_):e._=_,_.VERSION="1.5.2";var C=_.each=_.forEach=function(e,t,n){if(null!=e)if(h&&e.forEach===h)e.forEach(t,n);else if(e.length===+e.length){for(var o=0,a=e.length;o<a;o++)if(t.call(n,e[o],o,e)===i)return}else{var r=_.keys(e);for(o=0,a=r.length;o<a;o++)if(t.call(n,e[r[o]],r[o],e)===i)return}};_.map=_.collect=function(e,t,i){var n=[];return null==e?n:u&&e.map===u?e.map(t,i):(C(e,function(e,o,a){n.push(t.call(i,e,o,a))}),n)};var w="Reduce of empty array with no initial value";_.reduce=_.foldl=_.inject=function(e,t,i,n){var o=arguments.length>2;if(null==e&&(e=[]),d&&e.reduce===d)return n&&(t=_.bind(t,n)),o?e.reduce(t,i):e.reduce(t);if(C(e,function(e,a,r){o?i=t.call(n,i,e,a,r):(i=e,o=!0)}),!o)throw new TypeError(w);return i},_.reduceRight=_.foldr=function(e,t,i,n){var o=arguments.length>2;if(null==e&&(e=[]),f&&e.reduceRight===f)return n&&(t=_.bind(t,n)),o?e.reduceRight(t,i):e.reduceRight(t);var a=e.length;if(a!==+a){var r=_.keys(e);a=r.length}if(C(e,function(s,l,p){l=r?r[--a]:--a,o?i=t.call(n,i,e[l],l,p):(i=e[l],o=!0)}),!o)throw new TypeError(w);return i},_.find=_.detect=function(e,t,i){var n;return I(e,function(e,o,a){if(t.call(i,e,o,a))return n=e,!0}),n},_.filter=_.select=function(e,t,i){var n=[];return null==e?n:g&&e.filter===g?e.filter(t,i):(C(e,function(e,o,a){t.call(i,e,o,a)&&n.push(e)}),n)},_.reject=function(e,t,i){return _.filter(e,function(e,n,o){return!t.call(i,e,n,o)},i)},_.every=_.all=function(e,t,n){t||(t=_.identity);var o=!0;return null==e?o:m&&e.every===m?e.every(t,n):(C(e,function(e,a,r){if(!(o=o&&t.call(n,e,a,r)))return i}),!!o)};var I=_.some=_.any=function(e,t,n){t||(t=_.identity);var o=!1;return null==e?o:y&&e.some===y?e.some(t,n):(C(e,function(e,a,r){if(o||(o=t.call(n,e,a,r)))return i}),!!o)};_.contains=_.include=function(e,t){return null!=e&&(v&&e.indexOf===v?-1!=e.indexOf(t):I(e,function(e){return e===t}))},_.invoke=function(e,t){var i=s.call(arguments,2),n=_.isFunction(t);return _.map(e,function(e){return(n?t:e[t]).apply(e,i)})},_.pluck=function(e,t){return _.map(e,function(e){return e[t]})},_.where=function(e,t,i){return _.isEmpty(t)?i?void 0:[]:_[i?"find":"filter"](e,function(e){for(var i in t)if(t[i]!==e[i])return!1;return!0})},_.findWhere=function(e,t){return _.where(e,t,!0)},_.max=function(e,t,i){if(!t&&_.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.max.apply(Math,e);if(!t&&_.isEmpty(e))return-1/0;var n={computed:-1/0,value:-1/0};return C(e,function(e,o,a){var r=t?t.call(i,e,o,a):e;r>n.computed&&(n={value:e,computed:r})}),n.value},_.min=function(e,t,i){if(!t&&_.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.min.apply(Math,e);if(!t&&_.isEmpty(e))return 1/0;var n={computed:1/0,value:1/0};return C(e,function(e,o,a){var r=t?t.call(i,e,o,a):e;r<n.computed&&(n={value:e,computed:r})}),n.value},_.shuffle=function(e){var t,i=0,n=[];return C(e,function(e){t=_.random(i++),n[i-1]=n[t],n[t]=e}),n},_.sample=function(e,t,i){return arguments.length<2||i?e[_.random(e.length-1)]:_.shuffle(e).slice(0,Math.max(0,t))};var T=function(e){return _.isFunction(e)?e:function(t){return t[e]}};_.sortBy=function(e,t,i){var n=T(t);return _.pluck(_.map(e,function(e,t,o){return{value:e,index:t,criteria:n.call(i,e,t,o)}}).sort(function(e,t){var i=e.criteria,n=t.criteria;if(i!==n){if(i>n||void 0===i)return 1;if(i<n||void 0===n)return-1}return e.index-t.index}),"value")};var b=function(e){return function(t,i,n){var o={},a=null==i?_.identity:T(i);return C(t,function(i,r){var s=a.call(n,i,r,t);e(o,s,i)}),o}};_.groupBy=b(function(e,t,i){(_.has(e,t)?e[t]:e[t]=[]).push(i)}),_.indexBy=b(function(e,t,i){e[t]=i}),_.countBy=b(function(e,t){_.has(e,t)?e[t]++:e[t]=1}),_.sortedIndex=function(e,t,i,n){for(var o=(i=null==i?_.identity:T(i)).call(n,t),a=0,r=e.length;a<r;){var s=a+r>>>1;i.call(n,e[s])<o?a=s+1:r=s}return a},_.toArray=function(e){return e?_.isArray(e)?s.call(e):e.length===+e.length?_.map(e,_.identity):_.values(e):[]},_.size=function(e){return null==e?0:e.length===+e.length?e.length:_.keys(e).length},_.first=_.head=_.take=function(e,t,i){if(null!=e)return null==t||i?e[0]:s.call(e,0,t)},_.initial=function(e,t,i){return s.call(e,0,e.length-(null==t||i?1:t))},_.last=function(e,t,i){if(null!=e)return null==t||i?e[e.length-1]:s.call(e,Math.max(e.length-t,0))},_.rest=_.tail=_.drop=function(e,t,i){return s.call(e,null==t||i?1:t)},_.compact=function(e){return _.filter(e,_.identity)};var x=function(e,t,i){return t&&_.every(e,_.isArray)?l.apply(i,e):(C(e,function(e){_.isArray(e)||_.isArguments(e)?t?r.apply(i,e):x(e,t,i):i.push(e)}),i)};_.flatten=function(e,t){return x(e,t,[])},_.without=function(e){return _.difference(e,s.call(arguments,1))},_.uniq=_.unique=function(e,t,i,n){_.isFunction(t)&&(n=i,i=t,t=!1);var o=i?_.map(e,i,n):e,a=[],r=[];return C(o,function(i,n){(t?n&&r[r.length-1]===i:_.contains(r,i))||(r.push(i),a.push(e[n]))}),a},_.union=function(){return _.uniq(_.flatten(arguments,!0))},_.intersection=function(e){var t=s.call(arguments,1);return _.filter(_.uniq(e),function(e){return _.every(t,function(t){return _.indexOf(t,e)>=0})})},_.difference=function(e){var t=l.apply(n,s.call(arguments,1));return _.filter(e,function(e){return!_.contains(t,e)})},_.zip=function(){for(var e=_.max(_.pluck(arguments,"length").concat(0)),t=new Array(e),i=0;i<e;i++)t[i]=_.pluck(arguments,""+i);return t},_.object=function(e,t){if(null==e)return{};for(var i={},n=0,o=e.length;n<o;n++)t?i[e[n]]=t[n]:i[e[n][0]]=e[n][1];return i},_.indexOf=function(e,t,i){if(null==e)return-1;var n=0,o=e.length;if(i){if("number"!=typeof i)return e[n=_.sortedIndex(e,t)]===t?n:-1;n=i<0?Math.max(0,o+i):i}if(v&&e.indexOf===v)return e.indexOf(t,i);for(;n<o;n++)if(e[n]===t)return n;return-1},_.lastIndexOf=function(e,t,i){if(null==e)return-1;var n=null!=i;if(S&&e.lastIndexOf===S)return n?e.lastIndexOf(t,i):e.lastIndexOf(t);for(var o=n?i:e.length;o--;)if(e[o]===t)return o;return-1},_.range=function(e,t,i){arguments.length<=1&&(t=e||0,e=0),i=arguments[2]||1;for(var n=Math.max(Math.ceil((t-e)/i),0),o=0,a=new Array(n);o<n;)a[o++]=e,e+=i;return a};var k=function(){};_.bind=function(e,t){var i,n;if(L&&e.bind===L)return L.apply(e,s.call(arguments,1));if(!_.isFunction(e))throw new TypeError;return i=s.call(arguments,2),n=function(){if(!(this instanceof n))return e.apply(t,i.concat(s.call(arguments)));k.prototype=e.prototype;var o=new k;k.prototype=null;var a=e.apply(o,i.concat(s.call(arguments)));return Object(a)===a?a:o}},_.partial=function(e){var t=s.call(arguments,1);return function(){return e.apply(this,t.concat(s.call(arguments)))}},_.bindAll=function(e){var t=s.call(arguments,1);if(0===t.length)throw new Error("bindAll must be passed function names");return C(t,function(t){e[t]=_.bind(e[t],e)}),e},_.memoize=function(e,t){var i={};return t||(t=_.identity),function(){var n=t.apply(this,arguments);return _.has(i,n)?i[n]:i[n]=e.apply(this,arguments)}},_.delay=function(e,t){var i=s.call(arguments,2);return setTimeout(function(){return e.apply(null,i)},t)},_.defer=function(e){return _.delay.apply(_,[e,1].concat(s.call(arguments,1)))},_.throttle=function(e,t,i){var n,o,a,r=null,s=0;i||(i={});var l=function(){s=!1===i.leading?0:new Date,r=null,a=e.apply(n,o)};return function(){var p=new Date;s||!1!==i.leading||(s=p);var c=t-(p-s);return n=this,o=arguments,c<=0?(clearTimeout(r),r=null,s=p,a=e.apply(n,o)):r||!1===i.trailing||(r=setTimeout(l,c)),a}},_.debounce=function(e,t,i){var n,o,a,r,s;return function(){a=this,o=arguments,r=new Date;var l=function(){var p=new Date-r;p<t?n=setTimeout(l,t-p):(n=null,i||(s=e.apply(a,o)))},p=i&&!n;return n||(n=setTimeout(l,t)),p&&(s=e.apply(a,o)),s}},_.once=function(e){var t,i=!1;return function(){return i?t:(i=!0,t=e.apply(this,arguments),e=null,t)}},_.wrap=function(e,t){return function(){var i=[e];return r.apply(i,arguments),t.apply(this,i)}},_.compose=function(){var e=arguments;return function(){for(var t=arguments,i=e.length-1;i>=0;i--)t=[e[i].apply(this,t)];return t[0]}},_.after=function(e,t){return function(){if(--e<1)return t.apply(this,arguments)}},_.keys=E||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var i in e)_.has(e,i)&&t.push(i);return t},_.values=function(e){for(var t=_.keys(e),i=t.length,n=new Array(i),o=0;o<i;o++)n[o]=e[t[o]];return n},_.pairs=function(e){for(var t=_.keys(e),i=t.length,n=new Array(i),o=0;o<i;o++)n[o]=[t[o],e[t[o]]];return n},_.invert=function(e){for(var t={},i=_.keys(e),n=0,o=i.length;n<o;n++)t[e[i[n]]]=i[n];return t},_.functions=_.methods=function(e){var t=[];for(var i in e)_.isFunction(e[i])&&t.push(i);return t.sort()},_.extend=function(e){return C(s.call(arguments,1),function(t){if(t)for(var i in t)e[i]=t[i]}),e},_.pick=function(e){var t={},i=l.apply(n,s.call(arguments,1));return C(i,function(i){i in e&&(t[i]=e[i])}),t},_.omit=function(e){var t={},i=l.apply(n,s.call(arguments,1));for(var o in e)_.contains(i,o)||(t[o]=e[o]);return t},_.defaults=function(e){return C(s.call(arguments,1),function(t){if(t)for(var i in t)void 0===e[i]&&(e[i]=t[i])}),e},_.clone=function(e){return _.isObject(e)?_.isArray(e)?e.slice():_.extend({},e):e},_.tap=function(e,t){return t(e),e};var R=function(e,t,i,n){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return e===t;e instanceof _&&(e=e._wrapped),t instanceof _&&(t=t._wrapped);var o=p.call(e);if(o!=p.call(t))return!1;switch(o){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if("object"!=(void 0===e?"undefined":_typeof(e))||"object"!=(void 0===t?"undefined":_typeof(t)))return!1;for(var a=i.length;a--;)if(i[a]==e)return n[a]==t;var r=e.constructor,s=t.constructor;if(r!==s&&!(_.isFunction(r)&&r instanceof r&&_.isFunction(s)&&s instanceof s))return!1;i.push(e),n.push(t);var l=0,c=!0;if("[object Array]"==o){if(c=(l=e.length)==t.length)for(;l--&&(c=R(e[l],t[l],i,n)););}else{for(var h in e)if(_.has(e,h)&&(l++,!(c=_.has(t,h)&&R(e[h],t[h],i,n))))break;if(c){for(h in t)if(_.has(t,h)&&!l--)break;c=!l}}return i.pop(),n.pop(),c};_.isEqual=function(e,t){return R(e,t,[],[])},_.isEmpty=function(e){if(null==e)return!0;if(_.isArray(e)||_.isString(e))return 0===e.length;for(var t in e)if(_.has(e,t))return!1;return!0},_.isElement=function(e){return!(!e||1!==e.nodeType)},_.isArray=M||function(e){return"[object Array]"==p.call(e)},_.isObject=function(e){return e===Object(e)},C(["Arguments","Function","String","Number","Date","RegExp"],function(e){_["is"+e]=function(t){return p.call(t)=="[object "+e+"]"}}),_.isArguments(arguments)||(_.isArguments=function(e){return!(!e||!_.has(e,"callee"))}),"function"!=typeof/./&&(_.isFunction=function(e){return"function"==typeof e}),_.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},_.isNaN=function(e){return _.isNumber(e)&&e!=+e},_.isBoolean=function(e){return!0===e||!1===e||"[object Boolean]"==p.call(e)},_.isNull=function(e){return null===e},_.isUndefined=function(e){return void 0===e},_.has=function(e,t){return c.call(e,t)},_.noConflict=function(){return e._=t,this},_.identity=function(e){return e},_.times=function(e,t,i){for(var n=Array(Math.max(0,e)),o=0;o<e;o++)n[o]=t.call(i,o);return n},_.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))};var A={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};A.unescape=_.invert(A.escape);var P={escape:new RegExp("["+_.keys(A.escape).join("")+"]","g"),unescape:new RegExp("("+_.keys(A.unescape).join("|")+")","g")};_.each(["escape","unescape"],function(e){_[e]=function(t){return null==t?"":(""+t).replace(P[e],function(t){return A[e][t]})}}),_.result=function(e,t){if(null!=e){var i=e[t];return _.isFunction(i)?i.call(e):i}},_.mixin=function(e){C(_.functions(e),function(t){var i=_[t]=e[t];_.prototype[t]=function(){var e=[this._wrapped];return r.apply(e,arguments),B.call(this,i.apply(_,e))}})};var O=0;_.uniqueId=function(e){var t=++O+"";return e?e+t:t},_.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var D=/(.)^/,N={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"},U=/\\|'|\r|\n|\t|\u2028|\u2029/g;_.template=function(e,t,i){var n;i=_.defaults({},i,_.templateSettings);var o=new RegExp([(i.escape||D).source,(i.interpolate||D).source,(i.evaluate||D).source].join("|")+"|$","g"),a=0,r="__p+='";e.replace(o,function(t,i,n,o,s){return r+=e.slice(a,s).replace(U,function(e){return"\\"+N[e]}),i&&(r+="'+\n((__t=("+i+"))==null?'':_.escape(__t))+\n'"),n&&(r+="'+\n((__t=("+n+"))==null?'':__t)+\n'"),o&&(r+="';\n"+o+"\n__p+='"),a=s+t.length,t}),r+="';\n",i.variable||(r="with(obj||{}){\n"+r+"}\n"),r="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+r+"return __p;\n";try{n=new Function(i.variable||"obj","_",r)}catch(e){throw e.source=r,e}if(t)return n(t,_);var s=function(e){return n.call(this,e,_)};return s.source="function("+(i.variable||"obj")+"){\n"+r+"}",s},_.chain=function(e){return _(e).chain()};var B=function(e){return this._chain?_(e).chain():e};_.mixin(_),C(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=n[e];_.prototype[e]=function(){var i=this._wrapped;return t.apply(i,arguments),"shift"!=e&&"splice"!=e||0!==i.length||delete i[0],B.call(this,i)}}),C(["concat","join","slice"],function(e){var t=n[e];_.prototype[e]=function(){return B.call(this,t.apply(this._wrapped,arguments))}}),_.extend(_.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}).call(window);_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};
/*! Backbone.js - 1.1.2
 *  @Copyright (c) 2010-2014 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 *  @License: Backbone may be freely distributed under the MIT license.
 *  For all details and documentation: http://backbonejs.org */
/*! Backbone.js - 1.1.2
 *  @Copyright (c) 2010-2014 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 *  @License: Backbone may be freely distributed under the MIT license.
 *  For all details and documentation: http://backbonejs.org */
!function(e,t){if("function"==typeof define&&define.amd)define(["underscore","jquery","exports"],function(i,n,o){e.Backbone=t(e,o,i,n)});else if("undefined"!=typeof exports){var i=require("underscore");t(e,exports,i)}else e.Backbone=t(e,{},e._,e.jQuery||e.Zepto||e.ender||e.$)}(window,function(e,t,i,n){var o=e.Backbone,a=[],r=a.slice;t.VERSION="1.1.2",t.$=n,t.noConflict=function(){return e.Backbone=o,this},t.emulateHTTP=!1,t.emulateJSON=!1;var s=t.Events={on:function(e,t,i){return p(this,"on",e,[t,i])&&t?(this._events||(this._events={}),(this._events[e]||(this._events[e]=[])).push({callback:t,context:i,ctx:i||this}),this):this},once:function(e,t,n){if(!p(this,"once",e,[t,n])||!t)return this;var o=this,a=i.once(function(){o.off(e,a),t.apply(this,arguments)});return a._callback=t,this.on(e,a,n)},off:function(e,t,n){var o,a,r,s,l,c,h,u;if(!this._events||!p(this,"off",e,[t,n]))return this;if(!e&&!t&&!n)return this._events=void 0,this;for(l=0,c=(s=e?[e]:i.keys(this._events)).length;l<c;l++)if(e=s[l],r=this._events[e]){if(this._events[e]=o=[],t||n)for(h=0,u=r.length;h<u;h++)a=r[h],(t&&t!==a.callback&&t!==a.callback._callback||n&&n!==a.context)&&o.push(a);o.length||delete this._events[e]}return this},trigger:function(e){if(!this._events)return this;var t=r.call(arguments,1);if(!p(this,"trigger",e,t))return this;var i=this._events[e],n=this._events.all;return i&&c(i,t),n&&c(n,arguments),this},stopListening:function(e,t,n){var o=this._listeningTo;if(!o)return this;var a=!t&&!n;n||"object"!==(void 0===t?"undefined":_typeof(t))||(n=this),e&&((o={})[e._listenId]=e);for(var r in o)(e=o[r]).off(t,n,this),(a||i.isEmpty(e._events))&&delete this._listeningTo[r];return this}},l=/\s+/,p=function(e,t,i,n){if(!i)return!0;if("object"===(void 0===i?"undefined":_typeof(i))){for(var o in i)e[t].apply(e,[o,i[o]].concat(n));return!1}if(l.test(i)){for(var a=i.split(l),r=0,s=a.length;r<s;r++)e[t].apply(e,[a[r]].concat(n));return!1}return!0},c=function(e,t){var i,n=-1,o=e.length,a=t[0],r=t[1],s=t[2];switch(t.length){case 0:for(;++n<o;)(i=e[n]).callback.call(i.ctx);return;case 1:for(;++n<o;)(i=e[n]).callback.call(i.ctx,a);return;case 2:for(;++n<o;)(i=e[n]).callback.call(i.ctx,a,r);return;case 3:for(;++n<o;)(i=e[n]).callback.call(i.ctx,a,r,s);return;default:for(;++n<o;)(i=e[n]).callback.apply(i.ctx,t);return}};i.each({listenTo:"on",listenToOnce:"once"},function(e,t){s[t]=function(t,n,o){return(this._listeningTo||(this._listeningTo={}))[t._listenId||(t._listenId=i.uniqueId("l"))]=t,o||"object"!==(void 0===n?"undefined":_typeof(n))||(o=this),t[e](n,o,this),this}}),s.bind=s.on,s.unbind=s.off,i.extend(t,s);var h=t.Model=function(e,t){var n=e||{};t||(t={}),this.cid=i.uniqueId("c"),this.attributes={},t.collection&&(this.collection=t.collection),t.parse&&(n=this.parse(n,t)||{}),n=i.defaults({},n,i.result(this,"defaults")),this.set(n,t),this.changed={},this.initialize.apply(this,arguments)};i.extend(h.prototype,s,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(e){return i.clone(this.attributes)},sync:function(){return t.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return i.escape(this.get(e))},has:function(e){return null!=this.get(e)},set:function(e,t,n){var o,a,r,s,l,p,c,h;if(null==e)return this;if("object"===(void 0===e?"undefined":_typeof(e))?(a=e,n=t):(a={})[e]=t,n||(n={}),!this._validate(a,n))return!1;r=n.unset,l=n.silent,s=[],p=this._changing,this._changing=!0,p||(this._previousAttributes=i.clone(this.attributes),this.changed={}),h=this.attributes,c=this._previousAttributes,this.idAttribute in a&&(this.id=a[this.idAttribute]);for(o in a)t=a[o],i.isEqual(h[o],t)||s.push(o),i.isEqual(c[o],t)?delete this.changed[o]:this.changed[o]=t,r?delete h[o]:h[o]=t;if(!l){s.length&&(this._pending=n);for(var u=0,d=s.length;u<d;u++)this.trigger("change:"+s[u],this,h[s[u]],n)}if(p)return this;if(!l)for(;this._pending;)n=this._pending,this._pending=!1,this.trigger("change",this,n);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,i.extend({},t,{unset:!0}))},clear:function(e){var t={};for(var n in this.attributes)t[n]=void 0;return this.set(t,i.extend({},e,{unset:!0}))},hasChanged:function(e){return null==e?!i.isEmpty(this.changed):i.has(this.changed,e)},changedAttributes:function(e){if(!e)return!!this.hasChanged()&&i.clone(this.changed);var t,n=!1,o=this._changing?this._previousAttributes:this.attributes;for(var a in e)i.isEqual(o[a],t=e[a])||((n||(n={}))[a]=t);return n},previous:function(e){return null!=e&&this._previousAttributes?this._previousAttributes[e]:null},previousAttributes:function(){return i.clone(this._previousAttributes)},fetch:function(e){void 0===(e=e?i.clone(e):{}).parse&&(e.parse=!0);var t=this,n=e.success;return e.success=function(i){if(!t.set(t.parse(i,e),e))return!1;n&&n(t,i,e),t.trigger("sync",t,i,e)},A(this,e),this.sync("read",this,e)},save:function(e,t,n){var o,a,r,s=this.attributes;if(null==e||"object"===(void 0===e?"undefined":_typeof(e))?(o=e,n=t):(o={})[e]=t,n=i.extend({validate:!0},n),o&&!n.wait){if(!this.set(o,n))return!1}else if(!this._validate(o,n))return!1;o&&n.wait&&(this.attributes=i.extend({},s,o)),void 0===n.parse&&(n.parse=!0);var l=this,p=n.success;return n.success=function(e){l.attributes=s;var t=l.parse(e,n);if(n.wait&&(t=i.extend(o||{},t)),i.isObject(t)&&!l.set(t,n))return!1;p&&p(l,e,n),l.trigger("sync",l,e,n)},A(this,n),"patch"===(a=this.isNew()?"create":n.patch?"patch":"update")&&(n.attrs=o),r=this.sync(a,this,n),o&&n.wait&&(this.attributes=s),r},destroy:function(e){var t=this,n=(e=e?i.clone(e):{}).success,o=function(){t.trigger("destroy",t,t.collection,e)};if(e.success=function(i){(e.wait||t.isNew())&&o(),n&&n(t,i,e),t.isNew()||t.trigger("sync",t,i,e)},this.isNew())return e.success(),!1;A(this,e);var a=this.sync("delete",this,e);return e.wait||o(),a},url:function(){var e=i.result(this,"urlRoot")||i.result(this.collection,"url")||R();return this.isNew()?e:e.replace(/([^\/])$/,"$1/")+encodeURIComponent(this.id)},parse:function(e,t){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(e){return this._validate({},i.extend(e||{},{validate:!0}))},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=i.extend({},this.attributes,e);var n=this.validationError=this.validate(e,t)||null;return!n||(this.trigger("invalid",this,n,i.extend(t,{validationError:n})),!1)}});i.each(["keys","values","pairs","invert","pick","omit"],function(e){h.prototype[e]=function(){var t=r.call(arguments);return t.unshift(this.attributes),i[e].apply(i,t)}});var u=t.Collection=function(e,t){t||(t={}),t.model&&(this.model=t.model),void 0!==t.comparator&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,i.extend({silent:!0},t))},d={add:!0,remove:!0,merge:!0},f={add:!0,remove:!1};i.extend(u.prototype,s,{model:h,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return t.sync.apply(this,arguments)},add:function(e,t){return this.set(e,i.extend({merge:!1},t,f))},remove:function(e,t){var n,o,a,r,s=!i.isArray(e);for(e=s?[e]:i.clone(e),t||(t={}),n=0,o=e.length;n<o;n++)(r=e[n]=this.get(e[n]))&&(delete this._byId[r.id],delete this._byId[r.cid],a=this.indexOf(r),this.models.splice(a,1),this.length--,t.silent||(t.index=a,r.trigger("remove",r,this,t)),this._removeReference(r,t));return s?e[0]:e},set:function(e,t){(t=i.defaults({},t,d)).parse&&(e=this.parse(e,t));var n,o,a,r,s,l,p,c=!i.isArray(e);e=c?e?[e]:[]:i.clone(e);var u=t.at,f=this.model,g=this.comparator&&null==u&&!1!==t.sort,m=i.isString(this.comparator)?this.comparator:null,y=[],v=[],S={},M=t.add,E=t.merge,L=t.remove,_=!(g||!M||!L)&&[];for(n=0,o=e.length;n<o;n++){if(a=(s=e[n]||{})instanceof h?r=s:s[f.prototype.idAttribute||"id"],l=this.get(a))L&&(S[l.cid]=!0),E&&(s=s===r?r.attributes:s,t.parse&&(s=l.parse(s,t)),l.set(s,t),g&&!p&&l.hasChanged(m)&&(p=!0)),e[n]=l;else if(M){if(!(r=e[n]=this._prepareModel(s,t)))continue;y.push(r),this._addReference(r,t)}r=l||r,!_||!r.isNew()&&S[r.id]||_.push(r),S[r.id]=!0}if(L){for(n=0,o=this.length;n<o;++n)S[(r=this.models[n]).cid]||v.push(r);v.length&&this.remove(v,t)}if(y.length||_&&_.length)if(g&&(p=!0),this.length+=y.length,null!=u)for(n=0,o=y.length;n<o;n++)this.models.splice(u+n,0,y[n]);else{_&&(this.models.length=0);var C=_||y;for(n=0,o=C.length;n<o;n++)this.models.push(C[n])}if(p&&this.sort({silent:!0}),!t.silent){for(n=0,o=y.length;n<o;n++)(r=y[n]).trigger("add",r,this,t);(p||_&&_.length)&&this.trigger("sort",this,t)}return c?e[0]:e},reset:function(e,t){t||(t={});for(var n=0,o=this.models.length;n<o;n++)this._removeReference(this.models[n],t);return t.previousModels=this.models,this._reset(),e=this.add(e,i.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),e},push:function(e,t){return this.add(e,i.extend({at:this.length},t))},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return this.add(e,i.extend({at:0},t))},shift:function(e){var t=this.at(0);return this.remove(t,e),t},slice:function(){return r.apply(this.models,arguments)},get:function(e){if(null!=e)return this._byId[e]||this._byId[e.id]||this._byId[e.cid]},at:function(e){return this.models[e]},where:function(e,t){return i.isEmpty(e)?t?void 0:[]:this[t?"find":"filter"](function(t){for(var i in e)if(e[i]!==t.get(i))return!1;return!0})},findWhere:function(e){return this.where(e,!0)},sort:function(e){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return e||(e={}),i.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(i.bind(this.comparator,this)),e.silent||this.trigger("sort",this,e),this},pluck:function(e){return i.invoke(this.models,"get",e)},fetch:function(e){void 0===(e=e?i.clone(e):{}).parse&&(e.parse=!0);var t=e.success,n=this;return e.success=function(i){var o=e.reset?"reset":"set";n[o](i,e),t&&t(n,i,e),n.trigger("sync",n,i,e)},A(this,e),this.sync("read",this,e)},create:function(e,t){if(t=t?i.clone(t):{},!(e=this._prepareModel(e,t)))return!1;t.wait||this.add(e,t);var n=this,o=t.success;return t.success=function(e,i){t.wait&&n.add(e,t),o&&o(e,i,t)},e.save(null,t),e},parse:function(e,t){return e},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(e,t){if(e instanceof h)return e;(t=t?i.clone(t):{}).collection=this;var n=new this.model(e,t);return n.validationError?(this.trigger("invalid",this,n.validationError,t),!1):n},_addReference:function(e,t){this._byId[e.cid]=e,null!=e.id&&(this._byId[e.id]=e),e.collection||(e.collection=this),e.on("all",this._onModelEvent,this)},_removeReference:function(e,t){this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,i,n){("add"!==e&&"remove"!==e||i===this)&&("destroy"===e&&this.remove(t,n),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],null!=t.id&&(this._byId[t.id]=t)),this.trigger.apply(this,arguments))}});i.each(["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain","sample"],function(e){u.prototype[e]=function(){var t=r.call(arguments);return t.unshift(this.models),i[e].apply(i,t)}});i.each(["groupBy","countBy","sortBy","indexBy"],function(e){u.prototype[e]=function(t,n){var o=i.isFunction(t)?t:function(e){return e.get(t)};return i[e](this.models,o,n)}});var g=t.View=function(e){this.cid=i.uniqueId("view"),e||(e={}),i.extend(this,i.pick(e,y)),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},m=/^(\S+)\s*(.*)$/,y=["model","collection","el","id","attributes","className","tagName","events"];i.extend(g.prototype,s,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(e,i){return this.$el&&this.undelegateEvents(),this.$el=e instanceof t.$?e:t.$(e),this.el=this.$el[0],!1!==i&&this.delegateEvents(),this},delegateEvents:function(e){if(!e&&!(e=i.result(this,"events")))return this;this.undelegateEvents();for(var t in e){var n=e[t];if(i.isFunction(n)||(n=this[e[t]]),n){var o=t.match(m),a=o[1],r=o[2];n=i.bind(n,this),a+=".delegateEvents"+this.cid,""===r?this.$el.on(a,n):this.$el.on(a,r,n)}}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_ensureElement:function(){if(this.el)this.setElement(i.result(this,"el"),!1);else{var e=i.extend({},i.result(this,"attributes"));this.id&&(e.id=i.result(this,"id")),this.className&&(e.class=i.result(this,"className"));var n=t.$("<"+i.result(this,"tagName")+">").attr(e);this.setElement(n,!1)}}}),t.sync=function(e,n,o){var a=S[e];i.defaults(o||(o={}),{emulateHTTP:t.emulateHTTP,emulateJSON:t.emulateJSON});var r={type:a,dataType:"json"};if(o.url||(r.url=i.result(n,"url")||R()),null!=o.data||!n||"create"!==e&&"update"!==e&&"patch"!==e||(r.contentType="application/json",r.data=JSON.stringify(o.attrs||n.toJSON(o))),o.emulateJSON&&(r.contentType="application/x-www-form-urlencoded",r.data=r.data?{model:r.data}:{}),o.emulateHTTP&&("PUT"===a||"DELETE"===a||"PATCH"===a)){r.type="POST",o.emulateJSON&&(r.data._method=a);var s=o.beforeSend;o.beforeSend=function(e){if(e.setRequestHeader("X-HTTP-Method-Override",a),s)return s.apply(this,arguments)}}"GET"===r.type||o.emulateJSON||(r.processData=!1),"PATCH"===r.type&&v&&(r.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var l=o.xhr=t.ajax(i.extend(r,o));return n.trigger("request",n,l,o),l};var v=!("undefined"==typeof window||!window.ActiveXObject||window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent),S={create:"POST",update:"PUT",patch:"PATCH",delete:"DELETE",read:"GET"};t.ajax=function(){return t.$.ajax.apply(t.$,arguments)};var M=t.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},E=/\((.*?)\)/g,L=/(\(\?)?:\w+/g,_=/\*\w+/g,C=/[\-{}\[\]+?.,\\\^$|#\s]/g;i.extend(M.prototype,s,{initialize:function(){},route:function(e,n,o){i.isRegExp(e)||(e=this._routeToRegExp(e)),i.isFunction(n)&&(o=n,n=""),o||(o=this[n]);var a=this;return t.history.route(e,function(i){var r=a._extractParameters(e,i);a.execute(o,r),a.trigger.apply(a,["route:"+n].concat(r)),a.trigger("route",n,r),t.history.trigger("route",a,n,r)}),this},execute:function(e,t){e&&e.apply(this,t)},navigate:function(e,i){return t.history.navigate(e,i),this},_bindRoutes:function(){if(this.routes){this.routes=i.result(this,"routes");for(var e,t=i.keys(this.routes);null!=(e=t.pop());)this.route(e,this.routes[e])}},_routeToRegExp:function(e){return e=e.replace(C,"\\$&").replace(E,"(?:$1)?").replace(L,function(e,t){return t?e:"([^/?]+)"}).replace(_,"([^?]*?)"),new RegExp("^"+e+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(e,t){var n=e.exec(t).slice(1);return i.map(n,function(e,t){return t===n.length-1?e||null:e?decodeURIComponent(e):null})}});var w=t.History=function(){this.handlers=[],i.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},I=/^[#\/]|\s+$/g,T=/^\/+|\/+$/g,b=/msie [\w.]+/,x=/\/$/,k=/#.*$/;w.started=!1,i.extend(w.prototype,s,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root},getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getFragment:function(e,t){if(null==e)if(this._hasPushState||!this._wantsHashChange||t){e=decodeURI(this.location.pathname+this.location.search);var i=this.root.replace(x,"");e.indexOf(i)||(e=e.slice(i.length))}else e=this.getHash();return e.replace(I,"")},start:function(e){if(w.started)throw new Error("Backbone.history has already been started");w.started=!0,this.options=i.extend({root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=!1!==this.options.hashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var n=this.getFragment(),o=document.documentMode,a=b.exec(navigator.userAgent.toLowerCase())&&(!o||o<=7);if(this.root=("/"+this.root+"/").replace(T,"/"),a&&this._wantsHashChange){var r=t.$('<iframe src="javascript:0" tabindex="-1">');this.iframe=r.hide().appendTo("body")[0].contentWindow,this.navigate(n)}this._hasPushState?t.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!a?t.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=n;var s=this.location;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot())return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+"#"+this.fragment),!0;this._hasPushState&&this.atRoot()&&s.hash&&(this.fragment=this.getHash().replace(I,""),this.history.replaceState({},document.title,this.root+this.fragment))}if(!this.options.silent)return this.loadUrl()},stop:function(){t.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),w.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();if(t===this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe))),t===this.fragment)return!1;this.iframe&&this.navigate(t),this.loadUrl()},loadUrl:function(e){return e=this.fragment=this.getFragment(e),i.any(this.handlers,function(t){if(t.route.test(e))return t.callback(e),!0})},navigate:function(e,t){if(!w.started)return!1;t&&!0!==t||(t={trigger:!!t});var i=this.root+(e=this.getFragment(e||""));if(e=e.replace(k,""),this.fragment!==e){if(this.fragment=e,""===e&&"/"!==i&&(i=i.slice(0,-1)),this._hasPushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,i);else{if(!this._wantsHashChange)return this.location.assign(i);this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,e,t.replace))}return t.trigger?this.loadUrl(e):void 0}},_updateHash:function(e,t,i){if(i){var n=e.href.replace(/(javascript:|#).*$/,"");e.replace(n+"#"+t)}else e.hash="#"+t}}),t.history=new w;h.extend=u.extend=M.extend=g.extend=w.extend=function(e,t){var n,o=this;n=e&&i.has(e,"constructor")?e.constructor:function(){return o.apply(this,arguments)},i.extend(n,o,t);var a=function(){this.constructor=n};return a.prototype=o.prototype,n.prototype=new a,e&&i.extend(n.prototype,e),n.__super__=o.prototype,n};var R=function(){throw new Error('A "url" property or function must be specified')},A=function(e,t){var i=t.error;t.error=function(n){i&&i(e,n,t),e.trigger("error",e,n,t)}};return t});_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};
/*!
 * A simple service locator
 * @author  Tim Griesser
 * @license MIT
 * @see https://github.com/tgriesser/ioc.js
 */
/*!
 * @name InfoBox
 * @version 1.1.13 [March 19, 2014]
 * @author Gary Little (inspired by proof-of-concept code from Pamela Fox of Google)
 * @copyright Copyright 2010 Gary Little [gary at luxcentral.com]
 * @fileoverview InfoBox extends the Google Maps JavaScript API V3 <tt>OverlayView</tt> class.
 *  <p>
 *  An InfoBox behaves like a <tt>google.maps.InfoWindow</tt>, but it supports several
 *  additional properties for advanced styling. An InfoBox can also be used as a map label.
 *  <p>
 *  An InfoBox also fires the same events as a <tt>google.maps.InfoWindow</tt>.
 */
/*!
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *       http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function InfoBox(e){e=e||{},google.maps.OverlayView.apply(this,arguments),this.content_=e.content||"",this.disableAutoPan_=e.disableAutoPan||!1,this.maxWidth_=e.maxWidth||0,this.pixelOffset_=e.pixelOffset||new google.maps.Size(0,0),this.position_=e.position||new google.maps.LatLng(0,0),this.zIndex_=e.zIndex||null,this.boxClass_=e.boxClass||"infoBox",this.boxStyle_=e.boxStyle||{},this.closeBoxMargin_=e.closeBoxMargin||"2px",this.closeBoxURL_=e.closeBoxURL||"https://www.google.com/intl/en_us/mapfiles/close.gif",""===e.closeBoxURL&&(this.closeBoxURL_=""),this.infoBoxClearance_=e.infoBoxClearance||new google.maps.Size(1,1),void 0===e.visible&&(void 0===e.isHidden?e.visible=!0:e.visible=!e.isHidden),this.isHidden_=!e.visible,this.alignBottom_=e.alignBottom||!1,this.pane_=e.pane||"floatPane",this.enableEventPropagation_=e.enableEventPropagation||!1,this.div_=null,this.closeListener_=null,this.moveListener_=null,this.contextListener_=null,this.eventListeners_=null,this.fixedWidthSet_=null}
/*!
 * A simple service locator
 * @author  Tim Griesser
 * @license MIT
 * @see https://github.com/tgriesser/ioc.js
 */
(function(){var e=Array.prototype.slice,t=function(){return t.resolve.apply(t,arguments)},i=t._registers={},n=t._singletons={};if(t.register=function(e,t){if(this.isRegistered(e))throw new Error(e+" is already registered in the IoC container. Use ioc.replace to replace it.");return i[e]=t,this},t.replace=function(e,t,i){if(!this.isRegistered(e))throw new Error(e+" must be registered in the IoC container to replace it.");return this.unregister(e),this[i?"singleton":"register"](e,t),this},t.registerOrReplace=function(e,t,i){return this.isRegistered(e)?this.replace(e,t,i):this[i?"singleton":"register"](e,t),this},t.isRegistered=function(e){return void 0!==i[e]},t.unregister=function(e){if(!this.isRegistered(e))throw new Error(e+" must be registered in the IoC to unregister it");return delete i[e],n[e]&&delete n[e],this},t.singleton=function(e,t){if(this.isRegistered(e))throw new Error(e+" is already registered in the IoC container. Use ioc.replace to replace it.");return i[e]=function(){return i[e]="function"==typeof t?t.apply(this,arguments):t,n[e]=!0,i[e]},this},t.resolve=function(t){if(!this.isRegistered(t))throw new Error(t+" is not registered in the IoC container");return"function"!=typeof i[t]||n[t]?i[t]:i[t].apply(this,e.call(arguments,1))},t.alias=function(t){for(var n=e.call(arguments,1),o=i[t],a=0,r=n.length;a<r;a++)i[n[a]]=o;return this},t.ctor=function(t){var n=i[t]();if("function"!=typeof n)throw new Error(t+"is not a function in the IoC container");function o(){}o.prototype=n.prototype;var a=new o,r=n.apply(a,e.call(arguments,1));return Object(r)===r?r:a},"function"==typeof define&&"object"==_typeof(define.amd)&&define.amd)define("ioc",[],function(){return t});else if("object"===("undefined"==typeof exports?"undefined":_typeof(exports)))module.exports=t;else{this.ioc=t}}).call(window),InfoBox.prototype=new google.maps.OverlayView,InfoBox.prototype.createInfoBoxDiv_=function(){var e,t,i,n=this,o=function(e){e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation()};if(!this.div_){if(this.div_=document.createElement("div"),this.setBoxStyle_(),void 0===this.content_.nodeType?this.div_.innerHTML=this.getCloseBoxImg_()+this.content_:(this.div_.innerHTML=this.getCloseBoxImg_(),this.div_.appendChild(this.content_)),this.getPanes()[this.pane_].appendChild(this.div_),this.addClickHandler_(),this.div_.style.width?this.fixedWidthSet_=!0:0!==this.maxWidth_&&this.div_.offsetWidth>this.maxWidth_?(this.div_.style.width=this.maxWidth_,this.div_.style.overflow="auto",this.fixedWidthSet_=!0):(i=this.getBoxWidths_(),this.div_.style.width=this.div_.offsetWidth-i.left-i.right+"px",this.fixedWidthSet_=!1),this.panBox_(this.disableAutoPan_),!this.enableEventPropagation_){for(this.eventListeners_=[],t=["mousedown","mouseout","mouseup","click","dblclick","touchstart","touchend","touchmove"],e=0;e<t.length;e++)this.eventListeners_.push(google.maps.event.addDomListener(this.div_,t[e],o));this.eventListeners_.push(google.maps.event.addDomListener(this.div_,"mouseover",function(e){this.style.cursor="default"}))}this.contextListener_=google.maps.event.addDomListener(this.div_,"contextmenu",function(e){e.returnValue=!1,e.preventDefault&&e.preventDefault(),n.enableEventPropagation_||o(e)}),google.maps.event.trigger(this,"domready")}},InfoBox.prototype.getCloseBoxImg_=function(){var e="";return""!==this.closeBoxURL_&&(e="<img",e+=" src='"+this.closeBoxURL_+"'",e+=" align=right",e+=" style='",e+=" position: relative;",e+=" cursor: pointer;",e+=" margin: "+this.closeBoxMargin_+";",e+="'>"),e},InfoBox.prototype.addClickHandler_=function(){var e;""!==this.closeBoxURL_?(e=this.div_.firstChild,this.closeListener_=google.maps.event.addDomListener(e,"click",this.getCloseClickHandler_())):this.closeListener_=null},InfoBox.prototype.getCloseClickHandler_=function(){var e=this;return function(t){t.cancelBubble=!0,t.stopPropagation&&t.stopPropagation(),google.maps.event.trigger(e,"closeclick"),e.close()}},InfoBox.prototype.panBox_=function(e){var t,i=0,n=0;if(!e&&(t=this.getMap())instanceof google.maps.Map){t.getBounds().contains(this.position_)||t.setCenter(this.position_),t.getBounds();var o=t.getDiv(),a=o.offsetWidth,r=o.offsetHeight,s=this.pixelOffset_.width,l=this.pixelOffset_.height,p=this.div_.offsetWidth,c=this.div_.offsetHeight,h=this.infoBoxClearance_.width,u=this.infoBoxClearance_.height,d=this.getProjection().fromLatLngToContainerPixel(this.position_);if(d.x<-s+h?i=d.x+s-h:d.x+p+s+h>a&&(i=d.x+p+s+h-a),this.alignBottom_?d.y<-l+u+c?n=d.y+l-u-c:d.y+l+u>r&&(n=d.y+l+u-r):d.y<-l+u?n=d.y+l-u:d.y+c+l+u>r&&(n=d.y+c+l+u-r),0!==i||0!==n){t.getCenter();t.panBy(i,n)}}},InfoBox.prototype.setBoxStyle_=function(){var e,t;if(this.div_){this.div_.className=this.boxClass_,this.div_.style.cssText="",t=this.boxStyle_;for(e in t)t.hasOwnProperty(e)&&(this.div_.style[e]=t[e]);this.div_.style.WebkitTransform="translateZ(0)",void 0!==this.div_.style.opacity&&""!==this.div_.style.opacity&&(this.div_.style.MsFilter='"progid:DXImageTransform.Microsoft.Alpha(Opacity='+100*this.div_.style.opacity+')"',this.div_.style.filter="alpha(opacity="+100*this.div_.style.opacity+")"),this.div_.style.position="absolute",this.div_.style.visibility="hidden",null!==this.zIndex_&&(this.div_.style.zIndex=this.zIndex_)}},InfoBox.prototype.getBoxWidths_=function(){var e,t={top:0,bottom:0,left:0,right:0},i=this.div_;return document.defaultView&&document.defaultView.getComputedStyle?(e=i.ownerDocument.defaultView.getComputedStyle(i,""))&&(t.top=parseInt(e.borderTopWidth,10)||0,t.bottom=parseInt(e.borderBottomWidth,10)||0,t.left=parseInt(e.borderLeftWidth,10)||0,t.right=parseInt(e.borderRightWidth,10)||0):document.documentElement.currentStyle&&i.currentStyle&&(t.top=parseInt(i.currentStyle.borderTopWidth,10)||0,t.bottom=parseInt(i.currentStyle.borderBottomWidth,10)||0,t.left=parseInt(i.currentStyle.borderLeftWidth,10)||0,t.right=parseInt(i.currentStyle.borderRightWidth,10)||0),t},InfoBox.prototype.onRemove=function(){this.div_&&(this.div_.parentNode.removeChild(this.div_),this.div_=null)},InfoBox.prototype.draw=function(){this.createInfoBoxDiv_();var e=this.getProjection().fromLatLngToDivPixel(this.position_);this.div_.style.left=e.x+this.pixelOffset_.width+"px",this.alignBottom_?this.div_.style.bottom=-(e.y+this.pixelOffset_.height)+"px":this.div_.style.top=e.y+this.pixelOffset_.height+"px",this.isHidden_?this.div_.style.visibility="hidden":this.div_.style.visibility="visible"},InfoBox.prototype.setOptions=function(e){void 0!==e.boxClass&&(this.boxClass_=e.boxClass,this.setBoxStyle_()),void 0!==e.boxStyle&&(this.boxStyle_=e.boxStyle,this.setBoxStyle_()),void 0!==e.content&&this.setContent(e.content),void 0!==e.disableAutoPan&&(this.disableAutoPan_=e.disableAutoPan),void 0!==e.maxWidth&&(this.maxWidth_=e.maxWidth),void 0!==e.pixelOffset&&(this.pixelOffset_=e.pixelOffset),void 0!==e.alignBottom&&(this.alignBottom_=e.alignBottom),void 0!==e.position&&this.setPosition(e.position),void 0!==e.zIndex&&this.setZIndex(e.zIndex),void 0!==e.closeBoxMargin&&(this.closeBoxMargin_=e.closeBoxMargin),void 0!==e.closeBoxURL&&(this.closeBoxURL_=e.closeBoxURL),void 0!==e.infoBoxClearance&&(this.infoBoxClearance_=e.infoBoxClearance),void 0!==e.isHidden&&(this.isHidden_=e.isHidden),void 0!==e.visible&&(this.isHidden_=!e.visible),void 0!==e.enableEventPropagation&&(this.enableEventPropagation_=e.enableEventPropagation),this.div_&&this.draw()},InfoBox.prototype.setContent=function(e){this.content_=e,this.div_&&(this.closeListener_&&(google.maps.event.removeListener(this.closeListener_),this.closeListener_=null),this.fixedWidthSet_||(this.div_.style.width=""),void 0===e.nodeType?this.div_.innerHTML=this.getCloseBoxImg_()+e:(this.div_.innerHTML=this.getCloseBoxImg_(),this.div_.appendChild(e)),this.fixedWidthSet_||(this.div_.style.width=this.div_.offsetWidth+"px",void 0===e.nodeType?this.div_.innerHTML=this.getCloseBoxImg_()+e:(this.div_.innerHTML=this.getCloseBoxImg_(),this.div_.appendChild(e))),this.addClickHandler_()),google.maps.event.trigger(this,"content_changed")},InfoBox.prototype.setPosition=function(e){this.position_=e,this.div_&&this.draw(),google.maps.event.trigger(this,"position_changed")},InfoBox.prototype.setZIndex=function(e){this.zIndex_=e,this.div_&&(this.div_.style.zIndex=e),google.maps.event.trigger(this,"zindex_changed")},InfoBox.prototype.setVisible=function(e){this.isHidden_=!e,this.div_&&(this.div_.style.visibility=this.isHidden_?"hidden":"visible")},InfoBox.prototype.getContent=function(){return this.content_},InfoBox.prototype.getPosition=function(){return this.position_},InfoBox.prototype.getZIndex=function(){return this.zIndex_},InfoBox.prototype.getVisible=function(){return void 0!==this.getMap()&&null!==this.getMap()&&!this.isHidden_},InfoBox.prototype.show=function(){this.isHidden_=!1,this.div_&&(this.div_.style.visibility="visible")},InfoBox.prototype.hide=function(){this.isHidden_=!0,this.div_&&(this.div_.style.visibility="hidden")},InfoBox.prototype.open=function(e,t){var i=this;t&&(this.position_=t.getPosition(),this.moveListener_=google.maps.event.addListener(t,"position_changed",function(){i.setPosition(this.getPosition())})),this.setMap(e),this.div_&&this.panBox_()},InfoBox.prototype.close=function(){var e;if(this.closeListener_&&(google.maps.event.removeListener(this.closeListener_),this.closeListener_=null),this.eventListeners_){for(e=0;e<this.eventListeners_.length;e++)google.maps.event.removeListener(this.eventListeners_[e]);this.eventListeners_=null}this.moveListener_&&(google.maps.event.removeListener(this.moveListener_),this.moveListener_=null),this.contextListener_&&(google.maps.event.removeListener(this.contextListener_),this.contextListener_=null),this.setMap(null)},window.NRT.AppEvent={ENTER_MOBILE_SIZE:"NRT.AppEvent.EnterMobileSize",EXIT_MOBILE_SIZE:"NRT.AppEvent.ExitMobileSize",ENTER_TABLET_DOWN_SIZE:"NRT.AppEvent.EnterTabletDownSize",EXIT_TABLET_DOWN_SIZE:"NRT.AppEvent.ExitTabletDownSize",MAPDATA_READY:"NRT.AppEvent.MapDataReady",SEARCHLIST_CHANGED:"NRT.AppEvent.SearchListChanged",SCROLL_EFFECT_COMPLETE:"NRT.AppEvent.ScrollEffectComplete",REVERT_FROM_GALLERYVIEW:"NRT.AppEvent.RevertFromGallery"},window.NRT.SearchListEvent={CENTER_MAP_CLICK:"NRT.SearchListEvent.CenterMapClick",RENDER_COMPLETE:"NRT.SearchListEvent.RenderComplete",SNAPSHOT_MOUSEENTER:"NRT.SearchListEvent.SnapshotMouseEnter",SNAPSHOT_MOUSELEAVE:"NRT.SearchListEvent.SnapshotMouseLeave",LOAD_MORE_CLICK:"NRT.SearchListEvent.LoadMoreClick",PAGER_CLICK:"NRT.SearchListEvent.PagerClick",INFO_CLICK:"NRT.SearchListEvent.InfoClick",MAIL_CLICK:"NRT.SearchListEvent.MailClick",FORWARD_CLICK:"NRT.SearchListEvent.FowardClick",HIDE_PROPERTY_CLICK:"NRT.SearchListEvent.HidePropertyClick",SHOW_MAP_CLICK:"NRT.SearchListEvent.ShowMapClick",SHOW_MAP_CLICK_NEW_PSR_PANELS:"NRT.SearchListEvent.ShowMapClickNewPSRPanels",DYM_CLOSE_CLICK:"NRT.SearchListEvent.DYMCloseClick",SAVE_SEARCH_CLOSE_CLICK:"NRT.SearchListEvent.SaveSearchCloseClick",VOW_CLOSE_CLICK:"NRT.SearchListEvent.VOWCloseClick",MOBILE_LIST_TRIGGER_CLICK:"NRT.SearchListEvent.MobileListTriggerClick",MOBILE_MAP_TRIGGER_CLICK:"NRT.SearchListEvent.MobileMapTriggerClick",LIST_MAP_CLICK:"NRT.SearchListEvent.ListMapClick",LIST_ONLY_CLICK:"NRT.SearchListEvent.ListOnlyClick",MAP_ONLY_CLICK:"NRT.SearchListEvent.MapOnlyClick",CAROUSEL_FIRST_IMAGE_LOADED:"NRT.SearchListEvent.CarouselFirstImageLoaded"},window.NRT.SearchMapEvent={MARKER_CLICK:"NRT.SearchMapEvent.MarkerClick",MARKER_MOUSEDOWN:"NRT.SearchMapEvent.MarkerMousedown",MARKER_MOUSEOUT:"NRT.SearchMapEvent.MarkerMouseout",MARKER_MOUSEUP:"NRT.SearchMapEvent.MarkerMouseup",MARKER_MOUSEOVER:"NRT.SearchMapEvent.MarkerMouseover",PROPERTY_MARKER_CLICK:"NRT.SearchMapEvent.PropertyMarkerClick",PROPERTY_MARKER_MOUSEDOWN:"NRT.SearchMapEvent.PropertyMarkerMousedown",PROPERTY_MARKER_MOUSEOUT:"NRT.SearchMapEvent.PropertyMarkerMouseout",PROPERTY_MARKER_MOUSEUP:"NRT.SearchMapEvent.PropertyMarkerMouseup",PROPERTY_MARKER_MOUSEOVER:"NRT.SearchMapEvent.PropertyMarkerMouseover",MAJOR_PIN_CLICK:"NRT.SearchMapEvent.MajorPinClick",MAJOR_PIN_MOUSEDOWN:"NRT.SearchMapEvent.MajorPinMousedown",MAJOR_PIN_MOUSEOUT:"NRT.SearchMapEvent.MajorPinMouseout",MAJOR_PIN_MOUSEUP:"NRT.SearchMapEvent.MajorPinMouseup",MAJOR_PIN_MOUSEOVER:"NRT.SearchMapEvent.MajorPinMouseover",MINOR_PIN_CLICK:"NRT.SearchMapEvent.MinorPinClick",MINOR_PIN_MOUSEDOWN:"NRT.SearchMapEvent.MinorPinMousedown",MINOR_PIN_MOUSEOUT:"NRT.SearchMapEvent.MinorPinMouseout",MINOR_PIN_MOUSEUP:"NRT.SearchMapEvent.MinorPinMouseup",MINOR_PIN_MOUSEOVER:"NRT.SearchMapEvent.MinorPinMouseover",POI_MARKER_CLICK:"NRT.SearchMapEvent.PoiMarkerClick",POI_MARKER_MOUSEDOWN:"NRT.SearchMapEvent.PoiMarkerMousedown",POI_MARKER_MOUSEOUT:"NRT.SearchMapEvent.PoiMarkerMouseout",POI_MARKER_MOUSEOVER:"NRT.SearchMapEvent.PoiMarkerMouseover",POI_MARKER_MOUSEUP:"NRT.SearchMapEvent.PoiMarkerMouseup",PROPERTY_MARKERS_ADDED:"NRT.SearchMapEvent.PropertyMarkersAdded",INFO_WINDOW_MOUSEENTER:"NRT.SearchMapEvent.InfoWindowMouseenter",INFO_WINDOW_MOUSELEAVE:"NRT.SearchMapEvent.InfoWindowMouseleave",INFO_WINDOW_CLOSE:"NRT.SearchMapEvent.InfoWindowClose",INFO_WINDOW_ACTION_CLICK:"NRT.SearchMapEvent.InfoWindowActionClick",INFO_WINDOW_DETAIL_LINK_CLICK:"NRT.SearchMapEvent.InfoWindowDetailLinkClick",BOUNDS_CHANGED:"NRT.SearchMapEvent.bounds_changed",CENTER_CHANGED:"NRT.SearchMapEvent.center_changed",CLICK:"NRT.SearchMapEvent.click",DBLCLICK:"NRT.SearchMapEvent.dblclick",DRAG:"NRT.SearchMapEvent.drag",DRAGEND:"NRT.SearchMapEvent.dragend",DRAGSTART:"NRT.SearchMapEvent.dragstart",HEADING_CHANGED:"NRT.SearchMapEvent.heading_changed",IDLE:"NRT.SearchMapEvent.idle",MAPTYPEID_CHANGED:"NRT.SearchMapEvent.maptypeid_changed",MOUSEMOVE:"NRT.SearchMapEvent.mousemove",MOUSEOUT:"NRT.SearchMapEvent.mouseout",MOUSEOVER:"NRT.SearchMapEvent.mouseover",PROJECTION_CHANGED:"NRT.SearchMapEvent.projection_changed",RESIZE:"NRT.SearchMapEvent.resize",RIGHTCLICK:"NRT.SearchMapEvent.rightclick",TILESLOADED:"NRT.SearchMapEvent.tilesloaded",TILT_CHANGED:"NRT.SearchMapEvent.tilt_changed",ZOOM_CHANGED:"NRT.SearchMapEvent.zoom_changed"},window.NRT.PropertiesEvent={FETCH_SUCCESS:"NRT.PropertiesEvent.FetchSuccess",SUMMARY_FETCH_SUCCESS:"NRT.PropertiesEvent.SummaryFetchSuccess"},window.NRT.FormEvent={CHANGE:"NRT.FormEvent.change"},window.NRT.HeaderEvent={ALERT_CHANGE:"NRT.HeaderEvent.alertChange"},function(e,t,i,n){var o=function(e){this.options=e,this.$el=t(e.selector),n.isFunction(this.initialize)&&this.initialize(),n.isFunction(e.initialize)&&e.initialize()};o.prototype.className="BaseForm",o.extend=i.Model.extend,e.BaseForm=o}(window.NRT,jQuery,Backbone,_);_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e,t,i,n,o){var a=e.BaseForm.extend({className:"SearchForm",autocomplete:{},additionalLocationsAutocomplete:{},initialPrimaryLocationEntity:{},initialPrimaryLocationPath:"",primaryLocationEntity:{},primaryLocationSearchTerm:{},searchType:1,searchTypeOriginalId:0,searchCategoryType:1,propertyCategoryType:1,stateId:0,searchSource:-1,translationType:{toForSale:1,toRent:2,toSold:3},initialize:function(){var i;e.Global.Feature.UseNewPropertySearchFilters||(this.$el.on("submit",t.proxy(this.onUpdateResultsClick,this)),t("#add-a-keyword").on("keydown",t.proxy(function(e){13===e.keyCode&&this.onAddKeywordClick(e)},this)),t("#add-a-location").on("keydown",t.proxy(function(e){13===e.keyCode&&this.onAddLocationClick(e)},this)),t("#add-a-location-list").on("click",".remove-location-item",this.onRemoveUserItemClick),t("#add-a-keyword-list").on("click",".remove-user-item",this.onRemoveKeywordItemClick),t("#add-location-submit").on("click",t.proxy(this.onAddLocationClick,this)),t("#add-keyword-submit").on("click",t.proxy(this.onAddKeywordClick,this)),t(".js-more-neighborhoods-modal").on("submit","#nearby-locations",this.onAddNearbyLocationsClick),t("#price-min").autoNumeric("init",{aSign:"$",vMin:"0",mDec:"0"}),t("#price-max").autoNumeric("init",{aSign:"$",vMin:"0",mDec:"0"}),t(".meta-links a.inactive-list-status-cat").on("click",t.proxy(this.onListStatusCategoryLinkClick,this)),t(".meta-links a.inactive-prop-cat").on("click",t.proxy(this.onPropertyCategoryLinkClick,this)),(i=new e.QuickSearch).SetSearchSource(this.searchSource),i.SetResultsCallback(function(){}),this.autocomplete=new e.PropertySearchAutocomplete,this.autocomplete.Initialize("#searchtext-2",e.Utility.AssembleUrl(["quicksearch","getautocomplete"])),this.additionalLocationsAutocomplete=new e.PropertySearchAutocomplete,this.additionalLocationsAutocomplete.Initialize("#add-a-location",e.Utility.AssembleUrl(["quicksearch","getautocomplete"]),!0,null,"AdditionalLocations"))},getCriteriaPath:function(){var e,i,n,o,a,r,s,l,p,c,h=[],u=[],d=[],f=[],g=[],m=[],y=[],v=!1,S=0,M=0,E=0,L=0;return t(".search-form :checkbox").not("[type=hidden]").filter(":checked").not('[name$="[]"]').each(function(){"8"===(i=this.name)&&(v=!0),"3881_1"===i||"3881_2"===i?u.push(i):h.push(i)}),t(".search-form :checkbox").not("[type=hidden]").filter('[name$="[]"]').each(function(){var i=t(this);if(e=i.prop("name"),n=this.value,i.prop("checked"))switch(e){case"uloc[]":m.push(encodeURIComponent(n));break;case"aloc[]":g.push(encodeURIComponent(n));break;case"keyw[]":y.push(n.trim());break;default:u.push(this.name.replace("[]","")+"_"+encodeURIComponent(n))}else switch(e){case"uloc[]":m.push(encodeURIComponent(n)+"_0");break;case"keyw[]":y.push(n.trim()+"_0")}}),t(".search-form select").not("[type=hidden]").each(function(){var e=t(this),a=e.val();if(i=this.name,n=this.value,"216"===e.prop("name"))v&&d.push(i+"_"+encodeURIComponent(n));else if(a!==e.find(":first, option").val()){if((o=e.data("defaultvalue"))&&a===o)return!0;d.push(i+"_"+encodeURIComponent(n))}}),t(".search-form input[type=text]").not("[type=hidden]").filter(function(){var e=t(this);i=this.name,e.val().length>0&&"input_for_location"!==e.prop("name")&&("object"!==_typeof(e.data("autoNumeric"))?f.push(i+"_"+encodeURIComponent(this.value)):f.push(i+"_"+encodeURIComponent(e.autoNumeric("get"))))}),t(".search-form input[type=tel]").not("[type=hidden]").filter(function(){var e=t(this);i=this.name,e.val().length>0&&"input_for_location"!==e.prop("name")&&("object"!==_typeof(e.data("autoNumeric"))?f.push(i+"_"+encodeURIComponent(this.value)):f.push(i+"_"+encodeURIComponent(e.autoNumeric("get"))))}),t(".search-form input[type=radio]").not("[type=hidden]").filter(function(){t(this).prop("checked")&&d.push(this.name+"_"+encodeURIComponent(this.value))}),1!==this.propertyCategoryType&&d.push("18_"+this.propertyCategoryType),a=d.concat(u,f),r="",s="",l="",p="",c="",h.length>0&&(r="/incl-"+h.join(",")+"/",(h.indexOf("22")>-1||h.indexOf("122")>-1||h.indexOf("123")>-1||h.indexOf("196")>-1||h.indexOf("3887")>-1)&&(S=1),h.indexOf("7")>-1&&(E=1),h.indexOf("56")>-1&&(L=1)),a.length>0&&(s="/kvc-"+a.join(",")+"/",a.indexOf("17_3")>-1&&(M=1)),g.length>0&&(l="/aloc-"+g.join(",")+"/"),m.length>0&&(p="/uloc-"+m.join(",")+"/"),y.length>0&&(c="/keyw-"+y.join(",")+"/"),{inclusionPath:r,keyValuePath:s,nearbyLocationsPath:l,userLocationsPath:p,keywordsPath:c,includesForeclosure:S,includesCondos:M,includesOpenHouses:E,includesNewConstruction:L}},getSimpleSearchCriteriaPath:function(e,i){var o,r,s,l,p,c,h="",u="",d="",f=[],g=[],m=n.location.pathname;return t(".search-form .simple-search input[type=text]").not("[type=hidden]").filter(function(){var i=t(this);if(i.val().length>0&&"input_for_location"!==i.prop("name"))if("object"!==_typeof(i.data("autoNumeric")))g.push(this.name+"_"+encodeURIComponent(this.value));else{if(o=this.name,e)switch(r=a.prototype.translationType,e){case r.toForSale:"3990"===o&&(o="3878"),"3991"===o&&(o="3879");break;case r.toSold:"3878"===o&&(o="3990"),"3879"===o&&(o="3991");break;case r.toRent:"3878"===o&&(o=null),"3879"===o&&(o=null),"3990"===o&&(o=null),"3991"===o&&(o=null)}o&&g.push(o+"_"+encodeURIComponent(i.autoNumeric("get")))}}),t(".search-form .simple-search select").not("[type=hidden]").each(function(){var e=t(this),i=e.val();if(i!==e.find(":first, option").val()){if((s=e.data("defaultvalue"))&&i===s)return!0;f.push(this.name+"_"+encodeURIComponent(this.value))}}),i&&((l=m.match(/\/aloc\-[0-9-_,]+\//))&&l.length>0&&(u=l[0]),(p=m.match(/\/uloc\-[0-9-_,]+\//))&&p.length>0&&(d=p[0])),(c=f.concat(g)).length>0&&(h="/kvc-"+c.join(",")+"/"),{inclusionPath:"",keyValuePath:h,nearbyLocationsPath:u,userLocationsPath:d,keywordsPath:""}},validatePriceMinMax:function(){var e,i=t("#price-min").autoNumeric("get"),n=t("#price-max").autoNumeric("get");parseInt(n,10)<parseInt(i,10)&&(e=i,t("#price-min").autoNumeric("init"),t("#price-min").autoNumeric("set",n),t("#price-max").autoNumeric("init"),t("#price-max").autoNumeric("set",e))},validateSearch:function(){var i=t("#searchtext-2"),n=i.closest("form");return e.Validate.Initialize(n),i.length>0&&(i.rules("remove"),i.rules("add",{required:!0,messages:{required:"Oops! We didn't find any matching locations. Try again?"}}),i.rules("add",{regex:/^[a-zA-Z0-9\s,\-_'"&\.\/\#()]+$/g,messages:{regex:"Oops, we didn't understand those characters, Try again?"}})),t(n).valid()},updatePrimaryLocationPath:function(i,n){var a,r,s,l=this;l.primaryLocationSearchTerm!==o&&null!==l.primaryLocationSearchTerm&&l.primaryLocationSearchTerm.length>0&&null!==l.primaryLocationEntity&&l.primaryLocationSearchTerm!==l.primaryLocationEntity.Text&&(l.primaryLocationEntity=null),l.initialPrimaryLocationEntity&&l.initialPrimaryLocationEntity.DisplayText===l.primaryLocationSearchTerm?l.primaryLocationEntity=l.initialPrimaryLocationEntity:null===l.primaryLocationEntity&&null===l.primaryLocationSearchTerm&&(l.primaryLocationEntity=l.initialPrimaryLocationEntity),a=t("#SearchType").val(),l.searchType=a!==o&&null!==a?parseInt(a,10):l.searchTypeOriginalId,36===l.searchType&&1!==n.includesCondos&&(l.searchType=35),37===l.searchType&&1!==n.includesForeclosure&&(l.searchType=35),40===l.searchType&&1!==n.includesOpenHouses&&(l.searchType=35),41===l.searchType&&1!==n.includesNewConstruction&&(l.searchType=35),(r=t("#SearchSource").val())!==o&&null!==r&&(l.searchSource=parseInt(r,10)),s={searchEntity:l.primaryLocationEntity,searchTerm:l.primaryLocationSearchTerm,searchTypeId:l.searchType,previousSearchEntity:l.initialPrimaryLocationEntity,searchSource:l.searchSource},t.ajax({url:e.Utility.AssembleUrl(["quicksearch","getsearchresultsurl"]),type:"POST",contentType:"application/json",dataType:"json",data:JSON.stringify(s)}).done(l.onSuccessfulURL(i,n,l)).fail(function(t,i,n){var o="NRT.SearchForm.updatePrimaryLocationPath: Ajax Error";throw e.Event.Raise(e.Event.eError.ASYNC_ERROR,o,t,i,n),e.Utility.LogConsole(o+": "+t.toString()),new Error(o)})},onSuccessfulURL:function(i,n,o){return function(a,r,s){var l,p,c;if(a&&a.redirectToUrl&&a.redirectToUrl.length>0)a.searchEntity&&a.searchEntity.HasEntity&&e.SearchLocationsHistory.AddSearchLocation(a.searchEntity.Zone,a.searchEntity.EntityType,a.searchEntity.EntityId,a.searchEntity.Text),a.hasZoneChanged?o.navigateToNewURL(a.redirectToUrl,null,!0,!0,!1):a.hasPrimaryLocationChanged?(l=o.getSimpleSearchCriteriaPath(),o.navigateToNewURL(a.redirectToUrl,l,!1,!0,!1)):(p=i.replace(i,a.redirectToUrl),o.navigateToNewURL(p,n,!1,!1,!1));else{c=t("#searchtext-2"),t(".error").removeClass("error");var h=c.parent().find("#searchtext-2-error");h.length>0?(c.parent().addClass("error"),h.html('<span for="searchtext-2" class="message">Oops! We didn\'t find any matching locations. Try again?</span>')):c.parent().parent().addClass("error").find("#searchtext-2-error").html('<span for="searchtext-2" class="message">Oops! We didn\'t find any matching locations. Try again?</span>')}}},parseParam:function(e){var t="",i=n.location.search,o=i.indexOf(e),a=i.indexOf("&",o);return o>-1&&(t=a>-1?i.substring(o,a):i.substring(o)),t},navigateToNewURL:function(e,t,i,o,a){var r,s,l,p,c,h,u,d,f,g,m,y,v,S,M,E=n.location;for(t&&(e.indexOf("/kvc-")>0?e=e.replace(/\/kvc-[A-Za-z0-9_,%&();\.]*\//,t.keyValuePath):e+=t.keyValuePath,e.indexOf("/incl-")>0?e=e.replace(/\/incl-[A-Za-z0-9_,%&();\.]*\//,t.inclusionPath):e+=t.inclusionPath,e.indexOf("/aloc-")>0?e=e.replace(/\/aloc-[A-Za-z0-9\-_!,%&();\.]*\//,t.nearbyLocationsPath):e+=t.nearbyLocationsPath,e.indexOf("/uloc-")>0?e=e.replace(/\/uloc-[A-Za-z0-9\-_!,%&();\.]*\//,t.userLocationsPath):e+=t.userLocationsPath,e.indexOf("/keyw-")>0?e=e.replace(/\/keyw-[A-Za-z0-9\-_!,%&();\.\#]*\//,t.keywordsPath.replace(/%2f/gi,"!2f").replace(/%26/,"!26").replace(/%23/,"!23").replace(/%2e/,"!2e")):e+=t.keywordsPath.replace(/%2f/gi,"!2f").replace(/%26/,"!26").replace(/%23/,"!23").replace(/%2e/,"!2e")),r="",s="",p=(l=e.split("/")).length,h=0;h<p;h+=1)(c=l[h]).length>0&&("?"===c[0]?s=c:(r+="/",r+=c));u=this.parseParam("sortId"),d=this.parseParam("groupId"),f=this.parseParam("mode"),g=this.parseParam("latitude"),m=this.parseParam("longitude"),y=this.parseParam("searchTerm"),v="",S=[],s.length>0&&S.push(s),f.length>0&&S.push(f),y.length>0&&-1===s.indexOf("searchTerm=")&&S.push(y),!(i||o||a)&&d.length>0&&S.push(d),i||o||(g.length>0&&S.push(g),m.length>0&&S.push(m)),u.length>0&&("8"===(2===(M=u.split("=")).length?M[1]:null)&&(i||o)||S.push(u)),S.length>0&&0!==(v=S.join("&")).indexOf("?")&&(v="?"+v),n.location=E.protocol+"//"+E.hostname+r.toLowerCase()+"/"+v},addNearbyLocation:function(e){var n=t(e),o=t("#add-a-location-list").children().length,a=t(".additional-location-template").html(),r={nodeId:o,entityId:n.data("entity-id"),entityType:n.data("entity-type"),text:n.data("entity-text")};t("#add-a-location-list").append(i.template(a,r))}});a.prototype.onUpdateResultsClick=function(i){var o,a,r,s=n.location.pathname;i.preventDefault(),this.validatePriceMinMax(),this.validateSearch()&&(t("#add-a-keyword").val(""),o=this.getCriteriaPath(),(a=new e.QuickSearch).Initialize("#searchtext-2",null,!1,"#PrimaryLocationEntity"),r=a.GetSearchInfo(this.autocomplete.GetSelectedObject(),this.autocomplete.GetSearchTerm()),this.primaryLocationEntity=r.SearchData,this.primaryLocationSearchTerm=r.SearchTerm,!this.locationEquals(this.primaryLocationEntity,this.primaryLocationSearchTerm,this.initialPrimaryLocationEntity)?this.updatePrimaryLocationPath(s,o):this.navigateToNewURL(s,o,!1,!1,!1))},a.prototype.onAddLocationClick=function(e){var n,a,r,s,l;e.preventDefault(),0!==t("#add-a-location").val().replace(/[_|*&;$%!#@"^<>:?{}=()+\[\]\\]/g,"").length&&((n=this.additionalLocationsAutocomplete.GetSelectedObject())!==o&&null!==n&&n.EntityId===this.initialPrimaryLocationEntity.EntityId&&n.EntityType===this.initialPrimaryLocationEntity.EntityType||(t("#add-a-location-list").find('input[id^="uloc"]').length>=25?t("#add-a-location").val(""):(n!==o&&null!==n&&(5===n.EntityType&&-2===n.EntityId&&(n.EntityId=n.Text),0!==(a=t("#add-a-location-list").find('input[type="checkbox"][value="'+n.EntityId+"_"+n.EntityType+'"]')).length?a.prop("checked","checked"):(r=t("#add-a-location-list").children().length,s=t(".additional-location-template").html(),l={nodeId:r,entityId:n.EntityId,entityType:n.EntityType,text:n.Text},t("#add-a-location-list").append(i.template(s,l)))),t("#add-a-location").val(""))))},a.prototype.onAddNearbyLocationsClick=function(e){var i,n,o=0,r=t("#nearby-locations").find('input[type="checkbox"]');e.preventDefault(),i=t("#add-a-location-list").find("input").filter(function(e){return!t(this).hasClass("system-entered")}),o+=i.length,r.each(function(){var e=t(this);(n=t("#add-a-location-list").find('input[type="checkbox"][value="'+e.attr("data-entity-id")+"_"+e.attr("data-entity-type")+'"]')).length>0?n.prop("checked",e.is(":checked")?"checked":""):o<25&&e.is(":checked")&&(a.prototype.addNearbyLocation(this),o+=1)}),t(".js-more-neighborhoods-modal").trigger("close")},a.prototype.onAddKeywordClick=function(e){var n,o,a,r,s;e.preventDefault(),o=t("#add-a-keyword").val().trim().replace(/[_|*;$%!@^<>:?{}=()+\[\]\\]/g,"").replace(/\s+/g," "),n=i.escape(o),o=encodeURIComponent(o),0!==n.length?(a=t("#add-a-keyword-list").children().length,r=t(".keywords-template").html(),s={nodeId:a,text:n,encodedValue:o},t("#add-a-keyword-list").append(i.template(r,s)),t("#add-a-keyword").val(""),a>3?t("#add-a-keyword-form").hide():t("#add-a-keyword-form").show()):t("#add-a-keyword").val("")},a.prototype.onRemoveKeywordItemClick=function(e){e.preventDefault(),t(this).parent().remove(),t("#add-a-keyword-list").children().length>4?t("#add-a-keyword-form").hide():t("#add-a-keyword-form").show()},a.prototype.onRemoveUserItemClick=function(e){e.preventDefault(),t(this).parent().remove()},a.prototype.onListStatusCategoryLinkClick=function(e){var i,o,r,s,l,p=n.location;e.preventDefault(),i=t(e.target).is("font")?e.currentTarget.href.replace(p.protocol+"//"+p.hostname,""):e.target.href.replace(p.protocol+"//"+p.hostname,""),s=a.prototype.translationType,o=-1===i.indexOf("/rentals/")&&-1===i.indexOf("/recent-sales/")?s.toForSale:i.indexOf("/recent-sales/")>=0?s.toSold:s.toRent,r=a.prototype.getSimpleSearchCriteriaPath(o,!0),(l=i.match(/\/kvc\-\d+\_\d+\//))&&l.length>0&&(r.keyValuePath&&r.keyValuePath.length?r.keyValuePath=r.keyValuePath.slice(0,-1)+","+l[0].replace("/kvc-",""):r.keyValuePath=l[0]),a.prototype.navigateToNewURL(i,r,!1,!1,!0)},a.prototype.onPropertyCategoryLinkClick=function(e){var t,i,o,r,s=n.location,l=e.target.href.replace(s.protocol+"//"+s.hostname,""),p="",c="",h="",u=s.pathname;e.preventDefault(),(t=u.match(/\/aloc\-[0-9-_,]+\//))&&t.length>0&&(p=t[0]),(i=u.match(/\/uloc\-[0-9-_,]+\//))&&i.length>0&&(c=i[0]),(o=l.match(/\/kvc\-\d+\_\d+\//))&&o.length>0&&(h=o[0]),r={inclusionPath:"",keyValuePath:h,nearbyLocationsPath:p,userLocationsPath:c,keywordsPath:""},a.prototype.navigateToNewURL(l,r,!1,!1,!0)},a.prototype.locationEquals=function(e,t,i){return!1},e.SearchForm=a}(window.NRT,jQuery,_,window),window.NRT.LatLng=function(e,t){function i(){return this._lat+","+this._lng}return{Latitude:e,Longitude:t,ToString:i,ToUrlValue:i}},window.NRT.Point=function(e,t){return{X:e,Y:t}},function(e){e.SphericalMercatorProjection=function(t){var i=t;return{ToPoint:function(t){var n=t.Longitude/360+.5,o=Math.sin(.017453292519943295*t.Latitude),a=.5*Math.log((1+o)/(1-o))/(-2*Math.PI)+.5;return new e.Point(n*i,a*i)},ToLatLng:function(t){var n=360*(t.X/i-.5),o=.5-t.Y/i,a=90-2*Math.atan(Math.exp(2*-o*Math.PI))*(180/Math.PI);return new e.LatLng(a,n)}}}}(window.NRT),function(e){e.GeoSpatialRectangle=function(e,t,i,n){var o=e,a=t,r=i,s=n;return{SouthWestLatitude:o,SouthWestLongitude:a,NorthEastLatitude:r,NorthEastLongitude:s,IsPointWithinBounds:function(e,t){return e>o&&e<r&&t>a&&t<s}}},e.GeoSpatialRectangle.CreateFromBounds=function(t){var i,n,o,a,r=t.split(",");return i=parseFloat(r[0]),n=parseFloat(r[1]),o=parseFloat(r[2]),a=parseFloat(r[3]),e.GeoSpatialRectangle(i,n,o,a)}}(window.NRT),window.NRT.MapPoint=function(e){var t=0,i=0,n=[];return{Add:function(e){n.push(e),1===n.length&&(t=e.Latitude,i=e.Longitude)},Latitude:t,Longitude:i,Points:n,IsACluster:e,Bounds:[]}},function(e){var t={};t={GetPins:function(i,n,o,a){for(var r=0,s=[],l=[],p=[],c=e.GeoSpatialRectangle.CreateFromBounds(n),h=!1,u=0,d=25*a;r<i.length;r++)i[r].Latitude>0&&i[r].IsDisplayOnMap&&c.IsPointWithinBounds(i[r].Latitude,i[r].Longitude)&&(s.push(i[r]),(s.length>o||s.length>d)&&(h=!0));if(h||(h=t.InspectForJams(s,c)),h)for(p=t.GetClusters(i,a),r=0;r<p.length;r++)c.IsPointWithinBounds(p[r].Latitude,p[r].Longitude)&&(l.push(p[r]),u+=p[r].Points.length);return{resultSetInfo:i,pinsToDraw:s,count:i.length,clusters:p,clustersWithinBounds:l.length,clustersToDraw:l,tallyWithinBounds:h?u:s.length,isClusteredResults:h,clusterThreshold:o,geospatialBounds:n}},InspectForJams:function(t,i){var n,o,a,r,s=(i.NorthEastLongitude-i.SouthWestLongitude)/12,l=!1,p=t.length,c=0;for(n=i.SouthWestLongitude;n<i.NorthEastLongitude;n+=s){for(o=i.SouthWestLatitude;o<i.NorthEastLatitude;o+=s){for(r=e.GeoSpatialRectangle(o,n,o+s,n+s),c=0,a=0;a<p;a++)if(r.IsPointWithinBounds(t[a].Latitude,t[a].Longitude)&&++c>70){l=!0;break}if(l)break}if(l)break}return l},GetClusters:function(t,i){var n,o,a,r,s,l,p,c,h,u,d,f,g,m=Math.ceil(256*Math.pow(2,i)/300),y=new e.SphericalMercatorProjection(m),v=[],S=[];for(n=0;n<t.length;n++)(g=t[n]).IsDisplayOnMap&&0!==g.Latitude&&(c=y.ToPoint({Latitude:g.Latitude,Longitude:g.Longitude}),void 0===(f=v[a=m*Math.floor(c.X)+Math.floor(c.Y)])&&(r=y.ToLatLng({X:Math.floor(c.X)+.5,Y:Math.floor(c.Y)+.5}),(f=e.MapPoint(!0)).Latitude=r.Latitude,f.Longitude=r.Longitude,v[a]=f,S.push(f)),(p=e.MapPoint(!1)).Latitude=g.Latitude,p.Longitude=g.Longitude,p.ListingID=g.ListingID,f.Add(p));var M=new google.maps.LatLngBounds;for(n=0;n<S.length;n++){for(s=0,l=0,90,0,180,-180,h=(f=S[n]).Points,o=0;o<h.length;o++)s+=u=(c=h[o]).Latitude,l+=d=c.Longitude,M.extend(new google.maps.LatLng(u,d));f.Latitude=s/h.length,f.Longitude=l/h.length,f.Bounds=e.GeoSpatialRectangle(M.getSouthWest().lat(),M.getSouthWest().lng(),M.getNorthEast().lat(),M.getNorthEast().lng())}return S}},e.CustomClusterer=t}(window.NRT),function(e){var t,i={_cacheSize:100,_cache:[],_cacheListingIndex:[]};t={Get:function(e){return-1!==i._cacheListingIndex.indexOf(e)?i._cache[i._cacheListingIndex.indexOf(e)]:null},Clear:function(){for(;i._cache.length>0;)i._cache.pop(),i._cacheListingIndex.pop()},Append:function(e,t){var n,o,a,r=i._cache,s=r.length;if(s>i._cacheSize){for(n=0,o=0,a=0;a<s;a+=1)r[a].time<o&&(n=a,o=i._cache[a].time);r[n]={time:Date.now(),listingID:e,data:t},i._cacheListingIndex[n]=e}else r[s]={time:Date.now(),listingID:e,data:t},i._cacheListingIndex[i._cacheListingIndex.length]=e},Exists:function(e){return-1!==i._cacheListingIndex.indexOf(e)}},window.NRT.ListingCache=t}(),function(e,t,i,n,o,a,r){var s=function(e){this.Marker=e.marker,this.Data=e.data||{},this.Template=e.template,this.Type=null,l.searchMap=e.searchMap,l.map=void 0===l.searchMap||null===l.searchMap?e.map:l.searchMap.map,l.defaultOptions={},l.openTimer={}},l={searchMap:null,map:null,defaultOptions:{},openTimer:{},infoBox:null};s.prototype.Close=function(){try{i.event.clearListeners(l.infoBox,"domready")}catch(e){}null!==l.infoBox&&(l.infoBox.close(),l.infoBox=null,this.Marker=null),o("app.events").trigger(e.SearchMapEvent.INFO_WINDOW_CLOSE)},s.prototype.createInfoBox=function(){var e=n.template(this.Template,this.Data),t=this.Marker.options().icons[this.Marker.pinType][this.Marker.pinVariation].infoBox,i=n.extend(t,{content:e});l.defaultOptions=t,l.infoBox=new a(i)},s.prototype.Open=function(){var n,a=this;l.infoBox||this.createInfoBox(),i.event.addListener(l.infoBox,"domready",function(){(n=t(l.infoBox.div_).css("opacity",0)).hover(function(){o("app.events").trigger(e.SearchMapEvent.INFO_WINDOW_MOUSEENTER,{infoWindow:a})},function(){o("app.events").trigger(e.SearchMapEvent.INFO_WINDOW_MOUSELEAVE,{infoWindow:a})}),n.find(".tooltip-control").on("click",function(i){i.preventDefault(),o("app.events").trigger(e.SearchMapEvent.INFO_WINDOW_ACTION_CLICK,{action:t(this).data("action"),infoWindow:a})}),n.find("a[data-pid]").on("click",function(i){var n=t(this),a=n.data("pid"),r=n.attr("href");o("app.events").trigger(e.SearchMapEvent.INFO_WINDOW_DETAIL_LINK_CLICK,{listingID:a,listingUrl:r}),App.state.isShowPDModal&&(i.preventDefault(),App.loadDetailModal(a,r))}),clearTimeout(l.openTimer),l.openTimer=setTimeout(function(){var e,o,r,s,p,c,h,u=[],d={};a.Marker&&l.infoBox.div_&&(o={top:(e=t(l.map.getDiv())).offset().top,right:e.offset().left+e.width(),left:e.offset().left},r={top:n.offset().top,right:n.offset().left+n.width(),left:n.offset().left},h=l.searchMap&&l.searchMap.isMessageShowing?40:0,r.top-h<o.top?(u.push("bottom"),d.alignBottom=!1,p="poi"==a.Marker.pinType?12:6,c=-187):(u.push("top"),p="poi"==a.Marker.pinType?-48:-38,c=-184),r.left<o.left?(u.push("right"),c=-17):r.right>o.right&&(u.push("left"),c=-353),d.pixelOffset=new i.Size(c,p),l.infoBox&&l.infoBox.setOptions(d),s=u.join("-"),n.find(".map-tool-tip").addClass(s),n.css("opacity",1))},50)}),l.infoBox.open(l.map,this.Marker)},e.InfoWindow=s}(window.NRT,jQuery,google.maps,_,ioc,InfoBox),function(e,t,i,n,o,a,r){var s=i.Marker;s.extend=n.Model.extend;var l,p={};l={isIE11:Object.hasOwnProperty.call(window,"ActiveXObject")&&!window.ActiveXObject,pinType:null,pinVariation:null,pinState:null,isActive:!1,initialize:function(){o("app.events").on(e.PropertiesEvent.FETCH_SUCCESS,this.onPropertySummaryFetchSuccess,this)},options:function(){return o("app.config").marker},constructor:function(e,t){i.Marker.call(this,t),a.isUndefined(e.pinType)||(this.pinType=e.pinType),a.isUndefined(e.pinVariation)||(this.pinVariation=e.pinVariation),this.pinState=a.isUndefined(e.pinState)?"normal":e.pinState,this.data={},this.setPin(this.pinType,this.pinVariation,this.pinState),a.isFunction(e.initialize)&&(this.initialize=e.initialze),i.event.addListener(this,"click",p.onClick),i.event.addListener(this,"mousedown",p.onMousedown),i.event.addListener(this,"mouseout",p.onMouseout),i.event.addListener(this,"mouseover",p.onMouseover),i.event.addListener(this,"mouseup",p.onMouseup),this.initialize(e)},closeInfoWindow:function(e){this.isActive=!1,null!==App.infoWindow&&App.infoWindow.Close()},onPropertySummaryFetchSuccess:function(t){!1!==this.isActive&&(void 0!==App.infoWindow&&null!==App.infoWindow||(App.infoWindow=new e.InfoWindow({searchMap:App.searchMap})),App.infoWindow.Type=this.pinType,App.infoWindow.Marker=this,App.infoWindow.Data=t,App.infoWindow.Template=t.BubbleHtml,App.infoWindow.Open())},onPropertySummaryFetchSuccessCache:function(t){e.ListingCache.Append(t.ListingID,t.BubbleHtml),this.onPropertySummaryFetchSuccess(t)},openInfoWindow:function(i,n){var o,a;if(i||null===App.infoWindow||App.infoWindow.Marker!==this)if(i&&App.infoWindow.Close(),this.isActive=!0,"property"!==this.pinType&&"hintProperty"!==this.pinType)App.infoWindow=new e.InfoWindow({type:this.pinType,marker:this,searchMap:App.searchMap,data:this.data,template:t("."+this.pinType+"-infowindow-template").html()}),App.infoWindow.Open();else if(("listOnly"!==App.state.listViewType||1==App.state.isMobileViewShowingMap)&&(this.model.IsACluster||(n=this.data&&this.data.ListingID&&this.data.ListingID>0?this.data.ListingID:-1),n>-1)){if(e.ListingCache.Exists(n))return void this.onPropertySummaryFetchSuccess({BubbleHtml:e.ListingCache.Get(n).data,ListingID:n});e.Utility.LogConsole("marker.openInfoWindow: get map bubble, listing #"+n),a={listingID:n,multipleListingIDs:0==(o=this).pinMultiples.length?n:o.pinMultiples,searchCategoryType:App.searchform.searchCategoryType,inGeoMode:App.state.inGeocoordinateSearchMode},t.ajax({type:"GET",traditional:!0,url:this.options().endpoint,data:a}).done(function(e){o.onPropertySummaryFetchSuccessCache(e)})}},setPin:function(t,n,o){var r,s;if(t&&(this.pinType=t),n&&(this.pinVariation=n),o&&(this.pinState=o),r=this.options().icons[this.pinType][this.pinVariation],a.isArray(r.anchor)&&(r.anchor=new i.Point(r.anchor[0],r.anchor[1])),"poi"!=this.pinType&&"detail"!=this.pinType){var l=50,p="n/a";null!=this.model&&this.model[3]&&this.model[3]>-1&&(App.searchform.searchCategoryType>6&&App.searchform.searchCategoryType<10?p=this.model[3].toFixed().replace(/(\d+)(?=(\d{3})+)/g,"$1,"):(this.model[3]<1e3&&(p=this.model[3]),this.model[3]<1e6?p=Math.floor(this.model[3]/1e3)+"k":this.model[3]<1e8?((p=Math.floor(this.model[3]/1e4)/100+"M").length>4&&10,l=60):p=Math.floor(this.model[3]/1e6)+"M"));var c="normal"==this.pinState?"#2560b1;":"#d6ac24;",h='<?xml version="1.0"?><svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="'+l.toString()+'" height="30"><g><path style="fill:'+c+';fill-opacity:1;stroke:#fff;stroke-width:2;stroke-miterlimit:4;stroke-opacity:1;" ';h=(h+=60==l?'d="m 5.8556493,0 c -2.6751935,0 -4.8288694,2.4344 -4.8288694,5.4582 l 0,10.9159 c 0,3.0239 2.1536759,5.4579 4.8288694,5.4579 l 16.8234367,-0.045 c 8.637628,8.1929 5.960933,8.2265 14.598096,0.018 l 16.867165,0.027 c 2.675195,0 4.828872,-2.434 4.828872,-5.4579 l 0,-10.9159 c 0,-3.0238 -2.153674,-5.4582 -4.828872,-5.4582 z"':'d="m 4.9488753,0 c -2.2216641,0 -4.01022424,2.4497 -4.01022424,5.4926 l 0,10.9847 c 0,3.043 1.78856014,5.4924 4.01022424,5.4924 l 13.9713357,-0.045 c 7.173278,8.2446 4.950367,8.2784 12.12326,0.018 l 14.00765,0.027 c 2.221666,0 4.010227,-2.4494 4.010227,-5.4924 l 0,-10.9847 c 0,-3.0429 -1.788559,-5.4926 -4.010227,-5.4926 z"')+' /></g><g><text x="'+(l/2-1).toString()+'" y="15" style="font-family:Arial,Helvetica,sans-serif;font-weight:400;font-size:12px;fill:#fff;text-anchor:middle;">$'+p+"</text></g></svg>";var u="data:image/svg+xml;base64,"+btoa(h);s={anchor:r.anchor,size:new i.Size(l,30),scaledSize:new i.Size(l,30),url:u}}else s={anchor:r.anchor,scaledSize:new i.Size(r.width,r.height),url:r[this.pinState][Number(e.Helpers.IsRetina())]};this.setOptions({optimized:!this.isIE11}),this.setIcon(s)},setPinState:function(e){this.pinState=e,this.setPin()},setPinVariation:function(e){this.pinVariation=e,this.setPin()}},p={onClick:function(){o("app.events").trigger(e.SearchMapEvent.MARKER_CLICK,{marker:this})},onMousedown:function(){o("app.events").trigger(e.SearchMapEvent.MARKER_MOUSEDOWN,{marker:this})},onMouseout:function(){o("app.events").trigger(e.SearchMapEvent.MARKER_MOUSEOUT,{marker:this})},onMouseover:function(){o("app.events").trigger(e.SearchMapEvent.MARKER_MOUSEOVER,{marker:this})},onMouseup:function(){o("app.events").trigger(e.SearchMapEvent.MARKER_MOUSEUP,{marker:this})}},e.Marker=s.extend(l)}(window.NRT,jQuery,google.maps,Backbone,ioc,_),function(e,t,i,n){var o=e.Marker.extend({pinType:"property",pinVariation:"minor",pinState:"normal",visited:!1}),a={};o.prototype.initialize=function(e){this.model=e.model,this.modelIndex=e.model.index,this.visited=e.visited,this.pinType=e.pinType?e.pinType:"property",this.data=this.model,i.addListener(this,"click",t.proxy(a.onClick,this)),i.addListener(this,"mouseout",t.proxy(a.onMouseout,this)),i.addListener(this,"mouseover",t.proxy(a.onMouseover,this)),i.addListener(this,"mouseup",t.proxy(a.onMouseup,this)),this.visible=!(0===e.model.Latitude&&0===e.model.Longitude),this.initializePin(e.forceAsMinor)},o.prototype.initializePin=function(e){var t=this.getPinVariation(),i=this.visited?"visited":"normal";this.setPin(null,t,i),null!==App.infoWindow&&App.infoWindow.Marker===this&&this.openInfoWindow(!0)},o.prototype.setPin=function(e,t,i){var n;void 0!==this.model&&(e&&(this.pinType=e),t&&(this.pinVariation=t),i&&(this.pinState=i),n=this.options().icons[this.pinType][this.pinVariation],_.isArray(n.anchor)&&(n.anchor=new googleMaps.Point(n.anchor[0],n.anchor[1])),this.setIcon(this.getIconState(this.model)))},o.prototype.getIconState=function(e){var t,i,n,o,a,r,s,l,p,c,h="n/a";return e.IsACluster?((p=e.Points.length)>1e4?(n=122,r=36):p>1e3?(n=84,r=26):p>100?(n=68,r=24):p>10?(n=54,r=20):(n=40,r=18),a=n,o=n/2,l='<?xml version="1.0"?><svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="'+n.toString()+'" height="'+a.toString()+'"><circle cx="'+o.toString()+'" cy="'+o.toString()+'" r="'+(o-2).toString()+'" stroke="#fff" stroke-width="3" fill="#ffd33b" opacity=".8" /><text style="font-family:Whitney,Trebuchet MS, Helvetica, sans-serif;" font-size="'+r.toString()+'px"  text-anchor="middle" x="'+o.toString()+'" y="'+(o+r/3).toString()+'" fill="#464646">'+p.toString()+"</text></svg>",c="data:image/svg+xml;base64,"+btoa(l),i={size:new google.maps.Size(n,a),scaledSize:new google.maps.Size(n,a),anchor:new google.maps.Point(n/2,a/2),url:c}):(n=50,a=30,8,t="normal"==this.pinState?"#2560b1;":"#d6ac24;",null!=e&&e.Price&&(e.Price>-1&&(App.searchform.searchCategoryType>6&&App.searchform.searchCategoryType<10?h=e.Price.toFixed().replace(/(\d+)(?=(\d{3})+)/g,"$1,"):(e.Price<1e3&&(h=e.Price),e.Price<1e6?h=Math.floor(e.Price/1e3)+"k":e.Price<1e8?((h=Math.floor(e.Price/1e4)/100+"M").length>4&&10,n=60):h=Math.floor(e.Price/1e6)+"M")),s='<?xml version="1.0"?><svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="'+n.toString()+'" height="30"><g><path style="fill:'+t+';fill-opacity:1;stroke:#fff;stroke-width:2;stroke-miterlimit:4;stroke-opacity:1;" ',s=(s+=60===n?'d="m 5.8556493,0 c -2.6751935,0 -4.8288694,2.4344 -4.8288694,5.4582 l 0,10.9159 c 0,3.0239 2.1536759,5.4579 4.8288694,5.4579 l 16.8234367,-0.045 c 8.637628,8.1929 5.960933,8.2265 14.598096,0.018 l 16.867165,0.027 c 2.675195,0 4.828872,-2.434 4.828872,-5.4579 l 0,-10.9159 c 0,-3.0238 -2.153674,-5.4582 -4.828872,-5.4582 z"':'d="m 4.9488753,0 c -2.2216641,0 -4.01022424,2.4497 -4.01022424,5.4926 l 0,10.9847 c 0,3.043 1.78856014,5.4924 4.01022424,5.4924 l 13.9713357,-0.045 c 7.173278,8.2446 4.950367,8.2784 12.12326,0.018 l 14.00765,0.027 c 2.221666,0 4.010227,-2.4494 4.010227,-5.4924 l 0,-10.9847 c 0,-3.0429 -1.788559,-5.4926 -4.010227,-5.4926 z"')+' /></g><g><text x="'+(n/2-1).toString()+'" y="15" style="font-family:Arial,Helvetica,sans-serif;font-weight:400;font-size:12px;fill:#fff;text-anchor:middle;">$'+h+"</text></g></svg>"),c="data:image/svg+xml;base64,"+btoa(s),i={size:new google.maps.Size(n,a),scaledSize:new google.maps.Size(n,a),url:c}),i},o.prototype.getPinVariation=function(){var e=App.state.listIndexRange[0],t=App.state.listIndexRange[1];return this.model.IsACluster?"cluster":this.model.Offset>=e&&this.model.Offset<=t?"major":"minor"},e.Marker.prototype.setPinState=function(e){this.pinState="normal"===e&&this.visited?"visited":e,this.setPin()},a={onClick:function(){n("app.events").trigger(e.SearchMapEvent.PROPERTY_MARKER_CLICK,{marker:this}),n("app.events").trigger(e.SearchMapEvent[this.pinVariation.toUpperCase()+"_PIN_CLICK"],{marker:this})},onMousedown:function(){n("app.events").trigger(e.SearchMapEvent.PROPERTY_MARKER_MOUSEDOWN,{marker:this}),n("app.events").trigger(e.SearchMapEvent[this.pinVariation.toUpperCase()+"_PIN_MOUSEDOWN"],{marker:this})},onMouseout:function(){n("app.events").trigger(e.SearchMapEvent.PROPERTY_MARKER_MOUSEOUT,{marker:this}),n("app.events").trigger(e.SearchMapEvent[this.pinVariation.toUpperCase()+"_PIN_MOUSEOUT"],{marker:this})},onMouseover:function(){n("app.events").trigger(e.SearchMapEvent.PROPERTY_MARKER_MOUSEOVER,{marker:this}),n("app.events").trigger(e.SearchMapEvent[this.pinVariation.toUpperCase()+"_PIN_MOUSEOVER"],{marker:this})},onMouseup:function(){n("app.events").trigger(e.SearchMapEvent.PROPERTY_MARKER_MOUSEUP,{marker:this}),n("app.events").trigger(e.SearchMapEvent[this.pinVariation.toUpperCase()+"_PIN_MOUSEUP"],{marker:this})}},e.PropertyMarker=o}(window.NRT,jQuery,google.maps.event,ioc),function(e,t,i,n,o){var a=e.Marker.extend({pinType:"poi",pinVariation:"default",pinState:"normal",data:{}}),r=function(){n("app.events").trigger(e.SearchMapEvent.POI_MARKER_CLICK,{marker:this})},s=function(){n("app.events").trigger(e.SearchMapEvent.POI_MARKER_MOUSEDOWN,{marker:this})},l=function(){n("app.events").trigger(e.SearchMapEvent.POI_MARKER_MOUSEOUT,{marker:this})},p=function(){n("app.events").trigger(e.SearchMapEvent.POI_MARKER_MOUSEOVER,{marker:this})},c=function(){n("app.events").trigger(e.SearchMapEvent.POI_MARKER_MOUSEUP,{marker:this})};a.prototype.initialize=function(e){this.data=e.placeResult,this.initializePin(),i.addListener(this,"click",t.proxy(r,this)),i.addListener(this,"mousedown",t.proxy(s,this)),i.addListener(this,"mouseout",t.proxy(l,this)),i.addListener(this,"mouseover",t.proxy(p,this)),i.addListener(this,"mouseup",t.proxy(c,this))},a.prototype.initializePin=function(){var e=this.pinVariationFromSearchType(this.data.POICategory);this.setPin(this.pinType,e,null)},a.prototype.pinVariationFromSearchType=function(e){var i="default";return t.each(this.options().icons.poi,function(t,n){if(!1,-1!==o.indexOf(n.searchTypes,e))return i=t,!1}),i},a.prototype.pinVariationFromSearchTypes=function(e){var i,n=this,o="default";return t.each(e,function(e,t){if("default"!==(i=n.pinVariationFromSearchType(t)))return o=i,!1}),o},e.PoiMarker=a}(window.NRT,jQuery,google.maps.event,ioc,_),function(e,t,i,n){var o=e.Marker.extend({pinType:"detail",pinVariation:"major",pinState:"active",data:{}}),a={};o.prototype.initialize=function(e){this.pinState=e.pinState?e.pinState:"active",this.initializePin(),i.addListener(this,"click",t.proxy(a.onClick,this)),i.addListener(this,"mousedown",t.proxy(a.onMousedown,this)),i.addListener(this,"mouseout",t.proxy(a.onMouseout,this)),i.addListener(this,"mouseover",t.proxy(a.onMouseover,this)),i.addListener(this,"mouseup",t.proxy(a.onMouseup,this))},o.prototype.initializePin=function(){var e=this.pinState;this.setPin(null,"major",e),null!==App.infoWindow&&App.infoWindow.Marker===this&&this.openInfoWindow(!0)},a={onClick:function(){n("app.events").trigger(e.SearchMapEvent.MARKER_CLICK,{marker:this})},onMousedown:function(){n("app.events").trigger(e.SearchMapEvent.MARKER_MOUSEDOWN,{marker:this})},onMouseout:function(){n("app.events").trigger(e.SearchMapEvent.MARKER_MOUSEOUT,{marker:this})},onMouseover:function(){n("app.events").trigger(e.SearchMapEvent.MARKER_MOUSEOVER,{marker:this})},onMouseup:function(){n("app.events").trigger(e.SearchMapEvent.MARKER_MOUSEUP,{marker:this})}},e.DetailMarker=o}(window.NRT,jQuery,google.maps.event,ioc),function(e){var t=e.BaseForm.extend({className:"NearbyForm"});e.NearbyForm=t}(window.NRT),function(e,t,i,n,o){var a={},r={};a={overrideScrollPropertyIndex:null,Initialize:function(){i("app.events").on(e.AppEvent.SEARCHLIST_CHANGED,r.onSearchListChanged,this),i("app.events").on(e.SearchListEvent.SNAPSHOT_MOUSEENTER,r.onSnapshotMouseEnter,this),i("app.events").on(e.SearchMapEvent.MAJOR_PIN_CLICK,r.onMajorPinClick,this),i("app.events").on(e.SearchMapEvent.MAJOR_PIN_MOUSEOVER,r.onMajorPinMouseover,this),i("app.events").on(e.SearchMapEvent.MINOR_PIN_CLICK,r.onMinorPinClick,this),i("app.events").on(e.SearchMapEvent.MINOR_PIN_MOUSEOVER,n.debounce(r.highlightsOff,250),this),i("app.events").on(e.SearchListEvent.SHOW_MAP_CLICK,r.onShowMapClick,this),i("app.events").on(e.SearchListEvent.SHOW_MAP_CLICK_NEW_PSR_PANELS,r.onShowMapClick_NewPSRPanel,this),t(o).on("resize.effects",t.proxy(r.onWindowResize,this))},ScrollToProperty:function(n,s,l,p){var c,h;if(0,a.overrideScrollPropertyIndex&&(n=a.overrideScrollPropertyIndex,a.overrideScrollPropertyIndex=null,s=!0),(c=t("#snapshot-"+n)).length){if(h=c.offset().top,s&&r.highlightSnapshot(c),0===n&&t(o).scrollTop()<h)return void(l&&i("app.events").trigger(e.AppEvent.SCROLL_EFFECT_COMPLETE));n>0&&(h-=100),t("html, body").delay(30).animate({scrollTop:h},0,function(){l&&i("app.events").trigger(e.AppEvent.SCROLL_EFFECT_COMPLETE)})}}},r={onWindowResize:function(e){n.debounce(r.teardownShowMapClick(),100)},onSearchListChanged:function(n){var r;App.userInitiatedLoad&&(App.userInitiatedLoad=!1,n.forceScroll?a.ScrollToProperty(n.offset,!0,!0):(r=t(o).scrollTop(),t("html,body").scrollTop(r),i("app.events").trigger(e.AppEvent.SCROLL_EFFECT_COMPLETE)))},onMajorPinClick:function(e){a.ScrollToProperty(e.marker.model.Offset,!0)},onMajorPinMouseover:function(e){App.searchMap.markers.mouseIsOverInfoWindow||r.highlightSnapshot(e.marker.model.Offset)},onMinorPinClick:function(e){a.overrideScrollPropertyIndex=e.marker.model.Offset},onSnapshotMouseEnter:function(e){r.highlightSnapshot(e.element)},onShowMapClick:function(i){var o,a,r,s=t(".static-map-template").html(),l=t(i.element).parents(".property-snapshot").css("z-index",10),p=l.data("offset"),c=t(".list-items").css("position","relative"),h=p,u={width:l.outerWidth(),height:l.outerHeight(),top:Math.round(l.offset().top-c.offset().top),lat:l.data("lat"),lng:l.data("lng"),zoom:15,classname:"static-map-"+h,slideOffset:60};t.ajax({url:e.Utility.AssembleUrl(["location","getgooglemapsurl"]),type:"GET",contentType:"application/json",dataType:"json",data:{url:n.template("https://maps.googleapis.com/maps/api/staticmap?size=<%= width %>x<%= height %>&zoom=<%= zoom %>&sensor=false&center=<%= lat %>,<%= lng %>&maptype=roadmap&markers=color:blue%7C<%= lat %>,<%= lng %>",u)}}).done(function(e){c.css("position","relative").append(n.template(s,u)),(o=t("."+u.classname)).find(".close-static-map").click(function(){l.animate({left:0},function(){o.remove().css("z-index",2)})}),r=o.find("img");var i=u.width-u.slideOffset;i>500&&(i=500),l.animate({left:i}),a=e,r.one("error",function(){r.remove()}).attr("src",a)}).fail(e.Utility.LogConsole("signedSrc: "+a))},onShowMapClick_NewPSRPanel:function(i){var o,a,r,s=t(".static-map-template").html(),l=t(i.element).parents(".property-snapshot-psr-panel"),p=(t(".list-items"),l.data("offset")),c={width:l.outerWidth(),height:l.outerHeight(),top:-5,left:-5,lat:l.data("lat"),lng:l.data("lng"),zoom:15,classname:"static-map-"+p,slideOffset:0};t.ajax({url:e.Utility.AssembleUrl(["location","getgooglemapsurl"]),type:"GET",contentType:"application/json",dataType:"json",data:{url:n.template("https://maps.googleapis.com/maps/api/staticmap?size=<%= width %>x<%= height %>&zoom=<%= zoom %>&sensor=false&center=<%= lat %>,<%= lng %>&maptype=roadmap&markers=color:blue%7C<%= lat %>,<%= lng %>",c)}}).done(function(e){l.append(n.template(s,c)),(o=t("."+c.classname)).find(".close-static-map").click(function(){o.addClass("slideOutLeft animated").one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){t(this).remove()})}),r=o.find("img"),c.width-c.slideOffset>640&&640,o.css({"z-index":"5"}).addClass("psr-panel").find(".close-static-map").addClass("psr-panel").end().addClass("slideInLeft animated").one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){}),a=e,r.one("error",function(){r.remove()}).attr("src",a)}).fail(e.Utility.LogConsole("signedSrc: "+a))},highlightSnapshot:function(e){var i;(i=n.isNumber(e)?t("#snapshot-"+e):t(e)).length&&i.addClass("selected").siblings().removeClass("selected")},highlightsOff:function(){"undefined"!==App.searchMap&&App.searchMap.markers.mouseIsOverInfoWindow||t("property-snapshot-psr-panel").removeClass("selected")},teardownShowMapClick:function(){t(".static-map-wrap").remove()}},e.Effects=a}(window.NRT,jQuery,ioc,_,window),function(e,t,i,n,o){var a={},r={};a={Path:function(e){var n=this.UrlQueryVars(),o={};return e&&i.extend(n,e),t.each(n,function(e,t){null!==t&&(o[e]=t)}),App.state.isShowPDModal?Object.getOwnPropertyNames(o).length>0?"/?"+t.param(o):"":"/?"+t.param(o)},UrlQueryVar:function(e,t,n){var o=n||this.UrlQueryVars();return i.isUndefined(t)&&(t=""),i.isUndefined(o[e])?t:o[e]},UrlQueryVars:function(){var e,t,i,n,a,r,s={},l=o.location.href.match(/\w+=[^#]*/);if(l)for(t=(e=l[0].split("&")).length,r=0;r<t;r+=1)i=e[r].split("="),n=decodeURIComponent(i[0]),(a=decodeURIComponent(i[1])).match(/^-?[0-9]\d*(.\d+)?$/)&&(a=parseFloat(a)),s[n]=a;return s},UrlQueryVarsForReset:function(){var e=this.UrlQueryVars();return{groupId:e.groupId||App.searchData.groupId,sortId:e.sortId||App.searchData.sortId,offset:e.offset||App.searchData.offset,z:e.z||null,c:e.c||null}},BaseIndex:function(e,t){return Math.floor(e/t)*t},IsRetina:function(){return!!o.devicePixelRatio&&(o.devicePixelRatio>1||o.matchMedia&&o.matchMedia("(-webkit-min-device-pixel-ratio: 1.5),(-moz-min-device-pixel-ratio: 1.5),(min-device-pixel-ratio: 1.5)").matches)}},r={pushStateSupport:function(){return!(!o.history||!history.pushState)},url:function(e){return r.pushStateSupport()?r.canonicalUrl(e):o.location.href.split("#")[0]+a.Path(e)},canonicalUrl:function(e){var t=a.Path(e);return o.location.protocol+"//"+o.location.host+"/"+n.options.root+t}},e.Helpers=a}(window.NRT,jQuery,_,Backbone.history,window),function(e,t,i,n,o,a){var r=function(t){this.activeMarker=null,this.unsetActiveMarkerTimeout=null,this.mouseIsOverInfoWindow=!1,this.propertyMarkers=[],this.resultsListingData=[],this.poiMarkers=[],this.searchMap=t,this.map=t.map,this.poicount=0,n("app.events").on(e.AppEvent.ENTER_TABLET_DOWN_SIZE,s.onEnterTabletDownSize,this),n("app.events").on(e.AppEvent.EXIT_TABLET_DOWN_SIZE,s.onExitTabletDownSize,this),n("app.events").on(e.FormEvent.CHANGE,o.debounce(s.onFormChange,1100),this),n("app.events").on(e.AppEvent.MAPDATA_READY,s.onPropertiesFetchSuccess,this),n("app.events").on(e.SearchListEvent.RENDER_COMPLETE,s.onListRenderComplete,this),n("app.events").on(e.SearchListEvent.SNAPSHOT_MOUSEENTER,s.onSearchListSnapshotMouseEnter,this),n("app.events").on(e.SearchMapEvent.PROPERTY_MARKERS_ADDED,s.onPropertyMarkersAdded,this),n("app.events").on(e.SearchMapEvent.INFO_WINDOW_ACTION_CLICK,s.onInfoWindowActionClick,this),n("app.events").on(e.SearchMapEvent.INFO_WINDOW_MOUSEENTER,s.onInfoWindowMouseEnter,this),n("app.events").on(e.SearchMapEvent.INFO_WINDOW_MOUSELEAVE,s.onInfoWindowMouseLeave,this),n("app.events").on(e.SearchMapEvent.INFO_WINDOW_CLOSE,s.onInfoWindowClose,this),n("app.events").on(e.SearchMapEvent.MARKER_MOUSEOVER,s.onMarkerMouseover,this),n("app.events").on(e.SearchMapEvent.MARKER_MOUSEOUT,s.onMarkerMouseout,this),n("app.events").on(e.SearchListEvent.CENTER_MAP_CLICK,s.onSearchListCenterMapClick,this)},s={onFormChange:function(e){"NearbyForm"===e.className&&this.doNearbySearch()},onInfoWindowActionClick:function(i){var o,a=this,r=this.activeMarker.pinMultiples,s=r?r.indexOf(+i.infoWindow.Data.ListingID):0,l=this.activeMarker;switch(i.action){case"close":this.unsetActiveMarker();break;case"center_map":n("app.events").blockNext(e.SearchMapEvent.INFO_WINDOW_MOUSELEAVE),this.mouseIsOverInfoWindow=!1,this.map.setCenter(this.activeMarker.getPosition()),App.router.maybeFetch();break;case"prev_listing":o={listingID:r[s-1],multipleListingIDs:r,searchCategoryType:App.searchform.searchCategoryType,inGeoMode:App.state.inGeocoordinateSearchMode},t.ajax({type:"GET",traditional:!0,url:this.options().endpoint,data:o}).done(function(t){App.infoWindow.Close(),App.infoWindow=new e.InfoWindow({type:l.pinType,marker:l,searchMap:a.searchMap,data:t,template:t.BubbleHtml}),App.infoWindow.Open()});break;case"next_listing":o={listingID:r[s+1],multipleListingIDs:r,searchCategoryType:App.searchform.searchCategoryType,inGeoMode:App.state.inGeocoordinateSearchMode},t.ajax({type:"GET",traditional:!0,url:this.options().endpoint,data:o}).done(function(t){App.infoWindow.Close(),App.infoWindow=new e.InfoWindow({type:l.pinType,marker:l,searchMap:a.searchMap,data:t,template:t.BubbleHtml}),App.infoWindow.Open()})}},onInfoWindowClose:function(){this.mouseIsOverInfoWindow=!1},onInfoWindowMouseEnter:function(){this.mouseIsOverInfoWindow=!0,clearTimeout(this.unsetActiveMarkerTimeout)},onInfoWindowMouseLeave:function(){this.mouseIsOverInfoWindow=!1,this.unsetActiveMarker(!0)},onListRenderComplete:function(){this.setMajorPins()},onMarkerMouseover:function(e){e.marker.model&&e.marker.model.IsACluster||this.mouseIsOverInfoWindow||(this.activeMarker!==e.marker?this.setActiveMarker(e.marker):clearTimeout(this.unsetActiveMarkerTimeout))},onMarkerMouseout:function(){this.mouseIsOverInfoWindow||this.unsetActiveMarker(!0)},onNearbySearchComplete:function(){var i,n=this,o=this.map.YelpArray;o.length>0&&t.each(o,function(t,o){o.isOnMap||(i=new e.PoiMarker({placeResult:o},{position:o.geometry.location,map:n.map}),n.poiMarkers.push(i),this.poicount++,o.isOnMap=1)})},onPropertiesFetchSuccess:function(e){this.updateModelData(e.models)},onPropertyMarkersAdded:function(){this.doNearbySearch(),e.Utility.LogConsole("NRT.MapMarkers.onPropertyMarkersAdded: primary markers added.")},onSearchListCenterMapClick:function(t){var o,a,r=this,s=r.map.getZoom();0!==r.propertyMarkers.length&&(o=r.resultsListingData.resultSetInfo[t.offset],r.map.setCenter(new i.LatLng(o.Latitude,o.Longitude)),s<=15?r.map.setZoom(16):s<22&&r.map.setZoom(s+1),n("app.events").once(e.SearchMapEvent.PROPERTY_MARKERS_ADDED,function(){for(var e=0;e<r.propertyMarkers.length;e++)if(r.propertyMarkers[e].model.IsACluster){for(var t=0;t<r.propertyMarkers[e].model.Points.length;t++)if(r.propertyMarkers[e].model.Points[t].ListingID===o.ListingID){a=r.propertyMarkers[e];break}}else if(r.propertyMarkers[e].model.ListingID===o.ListingID){a=r.propertyMarkers[e];break}a&&r.setActiveMarker(a,o.ListingID)}))},onSearchListSnapshotMouseEnter:o.debounce(function(e){var i,o,a=this;if(0!==a.propertyMarkers.length&&!n("app.state").isMobileSize()&&!n("app.state").isTabletDownSize()){o=t(e.element).data("pid");for(var r=0;r<a.propertyMarkers.length;r++)if(a.propertyMarkers[r].model.IsACluster){for(var s=0;s<a.propertyMarkers[r].model.Points.length;s++)if(a.propertyMarkers[r].model.Points[s].ListingID===o){i=a.propertyMarkers[r];break}}else if(a.propertyMarkers[r].model.ListingID===o){i=a.propertyMarkers[r];break}i&&this.activeMarker&&this.marker&&this.activeMarker===i||(a.activeMarker&&a.unsetActiveMarker(),i&&a.setActiveMarker(i,o))}},250)};r.prototype.options=function(){return n("app.config").mapMarkers},r.prototype.findListingIdsOfColocatedListings=function(e,t){var i,n=[],o=t.length;for(i=0;i<o;i+=1)t[i].model.Latitude===e.Latitude&&t[i].model.Longitude===e.Longitude&&n.push({index:i,ListingID:t[i].model.ListingID});return n},r.prototype.getMarkerForListingID=function(e){var t,i=this.propertyMarkers,n=i.length,o=null;for(t=0;t<n;t+=1)if(i[t].listingID===e){o=i[t].listingID;break}return o},r.prototype.updateModelData=function(t){var i,o=[];if(void 0!==t&&null!==t){for(i=0;i<t.length;i++)o.push({IsDisplayOnMap:0!==t[i][1],ListingID:t[i][0],Latitude:t[i][1],Longitude:t[i][2],Price:t[i][3],Offset:i,IsACluster:!1});this.updateMarkers(o),n("app.events").trigger(e.SearchMapEvent.PROPERTY_MARKERS_ADDED,{markers:this.propertyMarkers})}},r.prototype.updateMarkers=function(i){var n,o=this;o.clearAll(),o.unsetActiveMarker(),void 0===i&&(i=o.resultsListingData.resultSetInfo),n=o.map.getBounds().toUrlValue(),o.resultsListingData=e.CustomClusterer.GetPins(i,n,200,o.map.getZoom()),o.resultsListingData.isClusteredResults?t.each(o.resultsListingData.clustersToDraw,function(e,t){o.addMarker(e,t,!0,!1)}):t.each(o.resultsListingData.pinsToDraw,function(e,t){o.addMarker(e,t,!1,!1)}),e.Utility.LogConsole("NRT.MapMarkers.updateMarkers: updated markers")},r.prototype.clearAll=function(e){var i=this,n=o.isUndefined(e)?["propertyMarkers","poiMarkers"]:[e+"Markers"];if(t.each(n,function(e,n){t.each(i[n],function(e,t){t.setMap(null),t.unbindAll(),t=null}),i[n].length=0}),-1!==n.indexOf("propertyMarkers")){for(var a=0;a<i.propertyMarkers.length;a++)google.maps.event.clearInstanceListeners(i.propertyMarkers[a]),i.propertyMarkers[a].setMap(null),i.propertyMarkers[a]=null;i.propertyMarkers.length=0}},r.prototype.setActiveMarker=function(e,t){var i=this;if(e){if(i.activeMarker&&i.activeMarker===e)return void(t&&clearTimeout(i.unsetActiveMarkerTimeout));i.unsetActiveMarker(),i.activeMarker=e,i.activeMarker.setPinState("active"),i.activeMarker.setZIndex(1e6),i.activeMarker.openInfoWindow(!1,t)}},r.prototype.unsetActiveMarker=function(e){var t=this,i=e?250:0,n=function(){clearTimeout(t.unsetActiveMarkerTimeout),t.activeMarker&&(t.activeMarker.closeInfoWindow(e),t.activeMarker.setPinState("normal"),t.activeMarker.setZIndex(100),t.activeMarker=null)};null!==t.activeMarker&&(clearTimeout(t.unsetActiveMarkerTimeout),0===i?n():t.unsetActiveMarkerTimeout=o.delay(n,i))},r.prototype.setMajorPins=function(){t.each(this.propertyMarkers,function(e,t){t.initializePin()})},r.prototype.updateNearbySearch=function(){},r.prototype.doNearbySearch=function(){var e,i,n,o,a,r,s=this,l=[];if(t(App.nearbyForm.options.selector+" input:checked").each(function(){l.push(t(this).attr("name"))}),0!==(e=l.length)){for(i={restaurant:"0",store:"1",school:"2",place_of_worship:"3"},n=[],o=0;o<e;o+=1)n.push(i[l[o]]);r={bounds:{NorthBound:(a=this.map.getBounds()).getNorthEast().lat(),SouthBound:a.getSouthWest().lat(),WestBound:a.getSouthWest().lng(),EastBound:a.getNorthEast().lng()},categories:n},App.poiManager.SubmitYelpQueries(r.bounds,r.categories,function(){s.clearAll("poi")})}else this.clearAll("poi")},r.prototype.markerClickHandler=function(e){e.addListener("click",function(){var t=this.map.getZoom();new i.LatLng(e.model.Bounds.SouthWestLatitude,e.model.Bounds.SouthWestLongitude),new i.LatLng(e.model.Bounds.NorthEastLatitude,e.model.Bounds.NorthEastLongitude);t<19&&this.map.setZoom(t+2),this.map.setCenter(new i.LatLng(e.model.Latitude,e.model.Longitude))})},r.prototype.addMarker=function(t,n,o){var a,r,s,l,p=[],c=this.propertyMarkers;if(n.Latitude*n.Longitude!=0&&(p=this.findListingIdsOfColocatedListings(n,c)),(s=new e.PropertyMarker({model:n,visited:n.visited,forceAsMinor:o,pinType:"property"},{position:new i.LatLng(n.Latitude,n.Longitude),optimized:!1})).pinMultiples=[],(a=p.length)>0){for(l=0;l<a;l+=1)c[p[l].index].pinMultiples.push(n.ListingID);r=c[p[0].index].pinMultiples,s.pinMultiples=r.slice()}s.setMap(this.map),c[t]=s,n.IsACluster&&this.markerClickHandler(s)},e.MapMarkers=r}(window.NRT,jQuery,google.maps,ioc,_),function(e,t,i,n,o){var a=function(){this.currentCoreParams={},this.models=[],this.pendingCoreParams={},this.currentRequest=null,this.renderedList=null,this.totalResultsCount=0};a.prototype.config=function(){return i("app.config").properties},a.prototype.fetch=function(n){var a;if(this.renderedList=null,this.pendingCoreParams={searchId:App.searchData.searchId,groupId:n.groupId,sortId:n.sortId,offset:n.offset,bounds:n.bounds},n.isGeoSearch=i("app.state").inGeocoordinateSearchMode,n.searchType=App.searchform.searchType,n.searchTypeOriginalId=App.searchform.searchTypeOriginalId,n.propertyCategoryType=App.searchform.propertyCategoryType,n.searchCategoryType=App.searchform.searchCategoryType,n.stateId=App.searchform.stateId,this.equalParams(this.currentCoreParams,this.pendingCoreParams)&&!n.forceFetch)return this.currentCoreParams.offset=this.pendingCoreParams.offset,this.currentCoreParams.sortId=this.pendingCoreParams.sortId,e.Utility.LogConsole("NRT.Properties.fetch: nothing changed - minor pins the same."),void this.triggerSuccess();a=this,e.Utility.LogConsole("NRT.Properties.fetch: back to the server for more minor pins...groupId:"+(n.groupId===o?"":n.groupId.toString())+"&sortId:"+(n.sortId===o?"":n.sortId.toString())+"&offset:"+(n.offset===o?"":n.offset.toString())+"&bounds:"+(n.bounds===o?"":n.bounds.toString())+"&isGeo:"+(n.isGeoSearch===o?"":n.isGeoSearch.toString())+"&z:"+e.Helpers.UrlQueryVar("z")+"&c:"+e.Helpers.UrlQueryVar("c")),this.currentRequest=t.ajax({beforeSend:function(){null!==a.currentRequest&&a.currentRequest.abort()},url:this.config().endpoint,data:n}).done(t.proxy(a.transformToArray,a)).fail(t.proxy(a.onFetchFail,a))},a.prototype.transformToArray=function(e){var t,i=e.resultSetInfo.Results,n=i.length,o=[];for(t=0;t<n;t+=1)o.push([i[t].l,i[t].a,i[t].b,i[t].p]);e.resultSetInfo.Results=o,this.onFetchSuccess(e)},a.prototype.equalParams=function(e,t){return e.searchId===t.searchId&&e.groupId===t.groupId&&e.bounds===t.bounds&&(e.sortId===t.sortId||e.offset===t.offset)},a.prototype.fetchFromUrl=function(t){var i=e.Helpers.UrlQueryVars(),n={searchId:App.searchData.searchId,groupId:i.groupId||App.searchData.groupId,sortId:i.sortId||App.searchData.sortId,offset:i.offset||0,bounds:t&&t.bounds?t.bounds:i.bounds,forceFetch:!(!t||!t.forceFetch)||null};this.fetch(n)},a.prototype.fetchFromHTML=function(t){var i=e.Helpers.UrlQueryVars(),n={searchId:App.searchData.searchId,groupId:i.groupId||App.searchData.groupId,sortId:i.sortId||App.searchData.sortId,offset:i.offset||0};this.pendingCoreParams={searchId:App.searchData.searchId,groupId:n.groupId,sortId:n.sortId,offset:i.offset||0},e.Utility.LogConsole("NRT.Properties.fetchFromHTML: loaded pin data locally..."),this.totalResultsCount=App.searchData.TotalResults,this.onFetchSuccess({resultSetInfo:{Results:e.InitialPinData}})},a.prototype.inCurrentRange=function(e,t,i){return Math.floor(e/i)===Math.floor(t/i)},a.prototype.onFetchSuccess=function(i){var o,a,r;for(this.currentCoreParams=n.clone(this.pendingCoreParams),o=i.resultSetInfo.Results,this.totalResultsCount=o.length,i.list?this.renderedList=i.list:this.renderedList=null,a=!1,r=0;r<o.length;r+=1)if(0!==o[r][1]&&0!==o[r][2]){a=!0;break}for(a||0===o.length?t("#UnmapableMessage").addClass("hide"):t("#UnmapableMessage").removeClass("hide"),this.models=[],r=0;r<o.length;r+=1)this.models.push(n.extend(o[r],{index:r}));e.Utility.LogConsole("NRT.Properties.onFetchSuccess: pins retrieved we're back!"),this.triggerSuccess()},a.prototype.onFetchFail=function(t,i){if("abort"===i)e.Utility.LogConsole("NRT.Properties.onFetchFail: previous request aborted due to later subsequent request");else{e.Utility.LogConsole("NRT.Properties.onFetchFail: retrieval failed");e.Event.Raise(e.Event.eError.ASYNC_ERROR,"NRT.Properties.onFetchFail",t,i),App.spinner.Stop()}},a.prototype.triggerSuccess=function(){i("app.events").trigger(e.PropertiesEvent.FETCH_SUCCESS,{models:this.models,searchParams:n.clone(this.currentCoreParams),renderedList:this.renderedList})},e.Properties=a}(window.NRT,jQuery,ioc,_),function(e,t,i){var n={blockNextList:[],blockedList:[],block:function(e){-1===t.indexOf(this.blockedList,e)&&this.blockedList.push(e)},blockNext:function(e){-1===t.indexOf(this.blockNextList,e)&&this.blockNextList.push(e)},isBlocked:function(e){return t.indexOf(this.blockNextList,e)>-1?(this.unblock(e),!0):t.indexOf(this.blockedList,e)>-1},trigger:function(e,t){return this.isBlocked(e)?this:i.trigger.apply(this,arguments)},unblock:function(e){this.blockedList=t.without(this.blockedList,e),this.blockNextList=t.without(this.blockNextList,e)}};e.EventBus=t.extend(n,i)}(window.NRT,_,Backbone.Events),function(e,t,i,n,o){var a=function(){this.options=n("app.config").searchMap,this.initialLatLong={},this.drawBoundaries=!1,this.lastBounds=null,this.centerLat=0,this.centerLng=0,this.map=null,this.isMessageShowing=!1,this.$map=t(this.options.selector),this.$mainWrap=t(".layout-search-results"),this.$listWrap=t(".layout-search-results .listing-results"),this.$mapWrap=t(".layout-search-results .results-map"),this.$mapInner=t(".layout-search-results .results-map .results-map-inner"),this.$mapTools=t(".layout-search-results .results-map .results-map-inner .map-tools"),this.markers=null,this.YelpArray=[],this.setCenterLat=function(e){this.centerLat=e},this.setCenterLng=function(e){this.centerLng=e}};a.prototype.onEnterMobileSize=function(){this.bigTeardown(),this.smallInitialize()},a.prototype.onExitMobileSize=function(){this.smallTeardown(),this.adjustWidth(),this.bigInitialize()},a.prototype.onEnterTabletDownSize=function(){this.bigTeardown(),this.smallInitialize()},a.prototype.onExitTabletDownSize=function(){this.smallTeardown(),this.adjustWidth(),this.bigInitialize(),"listMap"===App.getLayout()&&(n("app.events").once(e.SearchMapEvent.IDLE,function(){App.searchMap.baseInitializeMap(),App.router.maybeFetch()}),e.Utility.LogConsole("NRT.SearchMap.onExitTabletDownsize: resizing: listMap mode: reset map"))},a.prototype.buildListMapView=function(){var i,n;t(".layout-search-results").addClass("map-view").removeClass("layout-list-view"),t(".listing-results").show(),App.searchMap.toggleMapOnly(t(this)),App.searchMap.togglePager(t(this)),t("a.center-map").show(),t.fn.matchHeight._update(),App.searchMap.SetHref("list-map"),(i=e.Helpers.UrlQueryVars()).c&&(n=e.Helpers.UrlQueryVar("c",null,i).split(","),App.searchMap.map.setCenter({lat:parseFloat(n[0]),lng:parseFloat(n[1])})),App.searchMap.resetGeo(),e.Utility.LogConsole("NRT.SearchMap.buildListMapView: list-map-view built")},a.prototype.buildListOnlyView=function(){t(".layout-search-results").addClass("layout-list-view").removeClass("map-view"),t(".listing-results").show(),App.searchMap.togglePager(t(this)),t("a.center-map").hide(),App.searchMap.SetHref("list-only"),App.searchMap.bigTeardown(),t.fn.matchHeight._update(),e.Utility.LogConsole("NRT.SearchMap.buildListOnlyView: list-view built")},a.prototype.buildMapOnlyView=function(i){var n,o;t("div.map-tools>div.property-search-simple-search").show(),t(".link-view").removeClass("active"),t("li.map-only").addClass("active"),t(".layout-search-results").removeClass("layout-list-view map-view"),t(".listing-results").hide(),App.searchMap.toggleMapOnly(t(this)),App.searchMap.SetHref("map-only"),(n=e.Helpers.UrlQueryVars()).c&&(o=e.Helpers.UrlQueryVar("c",null,n).split(","),App.searchMap.map.setCenter({lat:parseFloat(o[0]),lng:parseFloat(o[1])})),App.searchMap.resetGeo(),e.Utility.LogConsole("NRT.SearchMap.buildMapOnlyView: map-view built")},a.prototype.listOnlyClick=function(t){t.preventDefault(),e.Utility.LogConsole("NRT.SearchMap.listOnlyClick: clicked"),App.setLayout("listOnly"),n("app.events").trigger(e.SearchListEvent.LIST_ONLY_CLICK)},a.prototype.listMapClick=function(t){t.preventDefault(),e.Utility.LogConsole("NRT.SearchMap.listMapClick: clicked"),App.setLayout("listMap"),n("app.events").once(e.SearchMapEvent.IDLE,function(){App.router.maybeFetch()}),n("app.events").trigger(e.SearchListEvent.LIST_MAP_CLICK)},a.prototype.mapOnlyClick=function(t){t.preventDefault(),e.Utility.LogConsole("NRT.SearchMap.mapOnlyClick: clicked"),App.setLayout("mapOnly"),n("app.events").once(e.SearchMapEvent.IDLE,function(){App.router.maybeFetch()}),n("app.events").trigger(e.SearchListEvent.MAP_ONLY_CLICK)},a.prototype.modeSwitchClick=function(i){i.preventDefault(),e.Utility.LogConsole("NRT.SearchMap.modeSwitchClick: clicked");var o=t(i.currentTarget);o.hasClass("list-only-link")?(App.setLayout("listOnly"),n("app.events").trigger(e.SearchListEvent.LIST_ONLY_CLICK),o.addClass("list-map-link").removeClass("list-only-link").text("Show Map")):o.hasClass("list-map-link")&&(App.setLayout("listMap"),n("app.events").trigger(e.SearchListEvent.LIST_MAP_CLICK),o.addClass("list-only-link").removeClass("list-map-link").text("Hide Map")),o.toggleClass("down")},a.prototype.makeMap=function(){this.initializeAppEvents(),n("app.state").isTabletDownSize()?this.smallInitialize():this.bigInitialize()},a.prototype.resetGeo=function(){var i=e.Helpers.UrlQueryVars();e.Helpers.UrlQueryVar("g",null,i)?(App.searchData.offset=i.offset,null!==i.groupId&&void 0!==i.groupId?App.searchData.groupId=i.groupId:App.searchData.groupId=App.defaultGroupID,App.searchData.sortId=i.sortId,t(n("app.config").general.redoSearchCheckboxSelector).prop("checked",!0),App.state.pageInitialized&&App.setGeoMode(!0)):n("app.events").trigger(e.AppEvent.REVERT_FROM_GALLERYVIEW)},a.prototype.baseInitializeMap=function(){this.initializeMap(),this.makeZoomControls(),this.makeMapTypeControls(),this.initializeMapEvents()},a.prototype.initializeMap=function(){var t,n="33.744023",o="-90.7248187",a=12,r=e.Helpers.UrlQueryVars();e.Utility.LogConsole("NRT.SearchMap.initializeMap: hi"),(0!==this.initialLatLong.Latitude&&0!==this.initialLatLong.Longitude||r.c)&&(r.c?(n=(t=r.c.split(","))[0],o=t[1],e.Utility.LogConsole("NRT.SearchMap.initializeMap: utilizing query params for map position.")):(n=this.initialLatLong.Latitude.toString(),o=this.initialLatLong.Longitude.toString(),a=this.initialLatLong.Zoom.toString(),e.Utility.LogConsole("NRT.SearchMap.initializeMap: utilizing initial html lat/lng for map position.")),a=e.Helpers.UrlQueryVar("z",a,r)),this.options.map.center=new i.LatLng(n,o),a&&(this.options.map.zoom=parseInt(a,10)),this.map=new i.Map(this.$map[0],this.options.map),this.markers=new e.MapMarkers(this)},a.prototype.initializeAppEvents=function(){n("app.events").on(e.AppEvent.ENTER_TABLET_DOWN_SIZE,this.onEnterTabletDownSize,this),n("app.events").on(e.AppEvent.EXIT_TABLET_DOWN_SIZE,this.onExitTabletDownSize,this),n("app.events").on(e.SearchListEvent.LIST_MAP_CLICK,this.buildListMapView),n("app.events").on(e.SearchListEvent.LIST_ONLY_CLICK,this.buildListOnlyView)},a.prototype.initializeMapEvents=function(){var o=this,a=i.event;t(n("app.config").general.redoSearchCheckboxSelector).on("change",function(e){App.setGeoMode(e.target.checked)}),a.addListener(this.map,"bounds_changed",function(){n("app.events").trigger(e.SearchMapEvent.BOUNDS_CHANGED,{map:o.map})}),a.addListener(this.map,"center_changed",function(){n("app.events").trigger(e.SearchMapEvent.CENTER_CHANGED,{map:o.map})}),a.addListener(this.map,"click",function(t){n("app.events").trigger(e.SearchMapEvent.CLICK,t)}),a.addListener(this.map,"dblclick",function(t){n("app.events").trigger(e.SearchMapEvent.DBLCLICK,t)}),a.addListener(this.map,"drag",function(){n("app.events").trigger(e.SearchMapEvent.DRAG,{map:o.map})}),a.addListener(this.map,"dragend",function(){n("app.events").trigger(e.SearchMapEvent.DRAGEND,{map:o.map})}),a.addListener(this.map,"dragstart",function(){n("app.events").trigger(e.SearchMapEvent.DRAGSTART,{map:o.map})}),a.addListener(this.map,"heading_changed",function(){n("app.events").trigger(e.SearchMapEvent.HEADING_CHANGED,{map:o.map})}),a.addListener(this.map,"idle",function(){n("app.events").trigger(e.SearchMapEvent.IDLE,{map:o.map})}),a.addListener(this.map,"maptypeid_changed",function(){n("app.events").trigger(e.SearchMapEvent.MAPTYPEID_CHANGED,{map:o.map})}),a.addListener(this.map,"mousemove",function(t){n("app.events").trigger(e.SearchMapEvent.MOUSEMOVE,t)}),a.addListener(this.map,"mouseout",function(t){n("app.events").trigger(e.SearchMapEvent.MOUSEOUT,t)}),a.addListener(this.map,"mouseover",function(t){n("app.events").trigger(e.SearchMapEvent.MOUSEOVER,t)}),a.addListener(this.map,"projection_changed",function(){n("app.events").trigger(e.SearchMapEvent.PROJECTION_CHANGED,{map:o.map})}),a.addListener(this.map,"resize",function(){n("app.events").trigger(e.SearchMapEvent.RESIZE,{map:o.map})}),a.addListener(this.map,"rightclick",function(t){n("app.events").trigger(e.SearchMapEvent.RIGHTCLICK,t)}),a.addListener(this.map,"tilesloaded",function(){n("app.events").trigger(e.SearchMapEvent.TILESLOADED,{map:o.map})}),a.addListener(this.map,"tilt_changed",function(){n("app.events").trigger(e.SearchMapEvent.TILT_CHANGED,{map:o.map})}),a.addListener(this.map,"zoom_changed",function(){n("app.events").trigger(e.SearchMapEvent.ZOOM_CHANGED,{map:o.map})})},a.prototype.makeZoomControls=function(){var n=this,o=this.options.zoomImages.minus[e.Helpers.IsRetina()?1:0],a=this.options.zoomImages.minusHover[e.Helpers.IsRetina()?1:0],r=this.options.zoomImages.plus[e.Helpers.IsRetina()?1:0],s=this.options.zoomImages.plusHover[e.Helpers.IsRetina()?1:0],l=t("<img>").addClass("zoom-minus").attr("src",o).click(function(){n.map.setZoom(Math.max(n.map.getZoom()-1,4))}).hover(function(){t(this).attr("src",a)},function(){t(this).attr("src",o)}),p=t("<img>").addClass("zoom-plus").attr("src",r).click(function(){n.map.setZoom(Math.min(n.map.getZoom()+1,20))}).hover(function(){t(this).attr("src",s)},function(){t(this).attr("src",r)}),c=t("<div>").addClass("zoom-controls").append(p).append(l),h=new Image,u=new Image;h.src=a,u.src=s,this.map.controls[i.ControlPosition.TOP_RIGHT].push(c[0])},a.prototype.makeMapTypeControls=function(){var n=this,o=t('<a href="#">Map</a>').addClass("roadmap-button roadmap-button-map").click(function(o){o.preventDefault();var a=t.extend({},e.AppConfig.searchMap.map.styles,e.AppConfig.searchMap.roadmapOverrideStyles);n.map.setOptions(a),n.map.setMapTypeId(i.MapTypeId.ROADMAP)}),a=t('<a href="#">Satellite</a>').addClass("roadmap-button roadmap-button-satellite").click(function(o){o.preventDefault();var a=t.extend({},e.AppConfig.searchMap.map.styles,e.AppConfig.searchMap.satelliteOverrideStyles);n.map.setOptions(a),n.map.setMapTypeId(i.MapTypeId.HYBRID)}),r=t("<div>").addClass("roadmap-controls").append(o,a);this.map.controls[i.ControlPosition.RIGHT_TOP].push(r[0])},a.prototype.bigInitialize=function(){t(".property-search-simple-search.psr-panel .view-switch-psr .mode-switch, .psr-filters-results-header .mode-change-psr .mode-change").off("click","a").on("click","a",this.modeSwitchClick),this.bigSetup(),e.Utility.LogConsole("NRT.SearchMap.bigInitialize()")},a.prototype.bigSetup=function(){this.bigWidthSetup(),this.bigHeightSetup(),this.bigStickySetup(),this.map||(this.baseInitializeMap(),t(o).trigger("scroll.sticky"))},a.prototype.bigTeardown=function(){this.bigMapTeardown(),this.bigWidthTeardown(),this.bigStickyTeardown(),this.bigHeightTeardown()},a.prototype.isBigMap=function(){return this.$mainWrap.hasClass("map-view")},a.prototype.toggleMapOnly=function(e){var i=App.searchMap;i.$mainWrap.hasClass("map-view")?(i.$mainWrap.toggleClass("map-view"),t("div#mapVowAlert").hide(),i.$listWrap.show(),i.bigStickySetup()):(i.$mainWrap.toggleClass("map-view"),t("div#mapVowAlert").show(),i.$listWrap.hide(),i.bigStickyTeardown()),i.adjustWidth(),n("app.state").inGeocoordinateSearchMode||t(o).trigger("scroll.sticky")},a.prototype.togglePager=function(e){App.searchMap.$mainWrap.hasClass("layout-list-view")?(t("p.search-results-load-more").hide(),t("div.load-previous-properties").hide(),t("div.search-results-pager").show()):(t("p.search-results-load-more").show(),t("div.load-previous-properties").show(),t("div.search-results-pager").hide())},a.prototype.bigMapTeardown=function(){this.$mainWrap.removeClass("map-view"),this.$listWrap.show(),this.adjustWidth()},a.prototype.bigHeightSetup=function(){var e=this,n=this.$map.parent(),a=t(o);function r(){var t,o,r=a.innerHeight()-n.position().top,s=null,l=422-e.$mapTools.outerHeight();s=e.$listWrap.is(":visible")?e.$listWrap.outerHeight()-(e.$mapInner.outerHeight()-n.outerHeight()):0,t=Math.min(r,s),o=Math.max(t,l),n.css("height",o+"px"),e.map&&i.event.trigger(e.map,"resize")}a.on("resize.adjustHeight",r),a.on("scroll.adjustHeight",r),r()},a.prototype.bigHeightTeardown=function(){var e=t(o);e.off("resize.adjustHeight"),e.off("scroll.adjustHeight")},a.prototype.bigStickySetup=function(){var i,n=this,a=!1,r=t(o),s=t(".psr-filters-results-header").outerHeight(!0),l=t(".psr-filter-search-form"),p=(t(".psr-filters-all"),function(){a?(t("section.listing-results.psr-panel").hasClass(".map-left")&&"left",n.$mapInner.css({position:"fixed",top:n.calculateAdjustedMapTop(),mapOrientation:"0"}),r.trigger("resize")):n.$mapInner.css({position:"relative",top:"0"})}),c=function(){return n.$mainWrap.offset().top+s-t(o).scrollTop()-l.height()<0};r.on("scroll.sticky",function(){i=c(),a!==i&&(a=i,r.trigger("stickyChange"))}),r.on("stickyChange",p),e.Global.Feature.UseNewPropertySearchFilters&&r.on(e.HeaderEvent.ALERT_CHANGE,function(){t(".psr-search-filters-nav").is(".fixedsticky")&&c()&&n.$mapInner.css({top:n.calculateAdjustedMapTop()})}),p()},a.prototype.bigStickyTeardown=function(){var i=t(o);i.off("stickyChange"),e.Global.Feature.UseNewPropertySearchFilters&&i.off(e.HeaderEvent.ALERT_CHANGE),this.$mapInner.css({position:"relative"})},a.prototype.bigWidthSetup=function(){t(o).on("resize.adjustWidth",t.proxy(this.adjustWidth,this)),this.adjustWidth()},a.prototype.bigWidthTeardown=function(){t(o).off("resize.adjustWidth")},a.prototype.smallInitialize=function(){this.smallTabsSetup(),this.smallAdjustHeight(),this.adjustWidth(),this.map||this.baseInitializeMap()},a.prototype.smallTeardown=function(){this.smallTabsTeardown()},a.prototype.smallTabsSetup=function(){var i;"m"===e.Helpers.UrlQueryVar("mode","l")&&(t(".trigger-map").addClass("active").siblings().removeClass("active"),i=parseInt(e.Helpers.UrlQueryVar("z",11),10),App.searchMap.map.setZoom(i))},a.prototype.showList=function(){t("body").addClass("body-list-on").removeClass("body-map-on"),this.$mapWrap.hide(),this.$listWrap.show()},a.prototype.showMap=function(){t("body").addClass("body-map-on").removeClass("body-list-on"),t(o).scrollTop(0),this.$listWrap.hide(),this.$mapWrap.show(),this.adjustWidth(),this.map||this.baseInitializeMap(),this.smallAdjustHeight()},a.prototype.smallTabsTeardown=function(){this.$mapWrap.show(),this.$listWrap.show()},a.prototype.smallAdjustHeight=function(){var e=t(o).innerHeight()-t(".page-header").outerHeight()-t(".mobile-triggers").outerHeight();this.$mapWrap.css({height:e}),this.$mapInner.css({height:e}),this.$map.parent().css({height:e}),t(".google-maps").css({height:e-t(".map-tools").outerHeight()}),this.map&&i.event.trigger(this.map,"resize")},a.prototype.adjustWidth=function(){var t=this.$listWrap.is(":visible")?this.$listWrap.outerWidth()+1:0,n=this.$mainWrap.width()-t;this.$mapWrap.css({width:n}),this.$mapInner.css({width:n}),this.$map.parent().css({width:n}),this.map&&i.event.trigger(this.map,"resize"),e.Utility.LogConsole("NRT.SearchMap.adjustWidth() - map width is "+n)},a.prototype.GetMap=function(){return this.map},a.prototype.SetHref=function(e){switch(e){case"list-map":t("li.list-map>a").removeAttr("href"),t("li.list-only>a").attr("href","#"),t("li.map-only>a").attr("href","#");break;case"list-only":t("li.list-only>a").removeAttr("href"),t("li.list-map>a").attr("href","#"),t("li.map-only>a").attr("href","#");break;case"map-only":t("li.map-only>a").removeAttr("href"),t("li.list-only>a").attr("href","#"),t("li.list-map>a").attr("href","#")}},a.prototype.calculateAdjustedMapTop=function(){if(!(e.Global.Feature.UseNewPropertySearchFilters&&t(".psr-search-filters-nav.fixedsticky").length>0))return 0;var i=t(".psr-filter-search-form"),n=t(".psr-filters-all"),o=i.position().top,a=i.outerHeight(!0),r=t(".property-search-alert.dym.psr-panel")[0],s=t(".property-search-alert.property-search-mls-alert")[0];return o+a+(r&&r.offsetHeight||0)+(s&&s.offsetHeight||0)-(n[0]&&n[0].offsetHeight||0)},e.SearchMap=a}(window.NRT,jQuery,google.maps,ioc,window),function(e,t,i,n,o){var a=function(){};a.prototype.onSaveSearchCloseClick=function(t){t.preventDefault(),i("app.events").trigger(e.SearchListEvent.SAVE_SEARCH_CLOSE_CLICK,{element:t.currentTarget})},a.prototype.onDYMCloseClick=function(t){t.preventDefault(),i("app.events").trigger(e.SearchListEvent.DYM_CLOSE_CLICK,{element:t.currentTarget})},a.prototype.onVOWCloseClick=function(t){t.preventDefault(),i("app.events").trigger(e.SearchListEvent.VOW_CLOSE_CLICK,{element:t.currentTarget})},a.prototype.onCenterMapClick=function(n){n.preventDefault(),i("app.events").trigger(e.SearchListEvent.CENTER_MAP_CLICK,{offset:t(n.currentTarget).data("offset")})},a.prototype.onLoadMoreClick=function(n){n.preventDefault(),i("app.events").trigger(e.SearchListEvent.LOAD_MORE_CLICK,{pageoffset:t(n.currentTarget).data("pageoffset")})},a.prototype.onPagerClick=function(n){n.preventDefault(),i("app.events").trigger(e.SearchListEvent.PAGER_CLICK,{pagenumber:t(n.currentTarget).data("pagenumber")})},a.prototype.onSnapshotMouseEnter=function(t){i("app.events").trigger(e.SearchListEvent.SNAPSHOT_MOUSEENTER,{element:t.currentTarget})},a.prototype.onSnapshotMouseLeave=function(t){i("app.events").trigger(e.SearchListEvent.SNAPSHOT_MOUSELEAVE,{element:t.currentTarget})},a.prototype.onInfoClick=function(t){t.preventDefault(),i("app.events").trigger(e.SearchListEvent.INFO_CLICK,{element:t.currentTarget})},a.prototype.onTriggerMapBtnClick=function(t){t.preventDefault(),i("app.events").trigger(e.SearchListEvent.SHOW_MAP_CLICK_NEW_PSR_PANELS,{element:t.currentTarget})},a.prototype.onForwardClick=function(t){t.preventDefault(),i("app.events").trigger(e.SearchListEvent.FORWARD_CLICK,{element:t.currentTarget})},a.prototype.onHidePropertyClick=function(t){t.preventDefault(),i("app.events").trigger(e.SearchListEvent.HIDE_PROPERTY_CLICK,{element:t.currentTarget})},a.prototype.onLoadDetailFrame=function(e){var i,n,o;App.state.isShowPDModal&&(i=(o=t(e.target)).closest("div.property-snapshot-psr-panel").data("pid"),n=o.closest("a").attr("href"),e.ctrlKey||(e.preventDefault(),App.loadDetailModal(i,n)))},a.prototype.bindEvents=function(e){var i=".property-snapshot-psr-panel";e?(t(i).on("mouseenter",this.onSnapshotMouseEnter),t(i).on("mouseleave",this.onSnapshotMouseLeave),t(".icon-question").on("click",this.onInfoClick),t(".icon-export").on("click",this.onForwardClick),t(".trigger-map-btn a").on("click",this.onTriggerMapBtnClick),t(".center-map").on("click",this.onCenterMapClick),t(".dym-alert-close").on("click",this.onDYMCloseClick),t(".save-search-alert-close").on("click",this.onSaveSearchCloseClick),t(".vow-alert-close").on("click",this.onVOWCloseClick)):(t(i).off("mouseenter",this.onSnapshotMouseEnter),t(i).off("mouseleave",this.onSnapshotMouseLeave),t(".icon-question").off("click",this.onInfoClick),t(".icon-export").off("click",this.onForwardClick),t(".trigger-map-btn a").off("click",this.onTriggerMapBtnClick),t(".center-map").off("click",this.onCenterMapClick),t(".dym-alert-close").off("click",this.onDYMCloseClick),t(".save-search-alert-close").off("click",this.onSaveSearchCloseClick),t(".vow-alert-close").off("click",this.onVOWCloseClick),t(".propertysearch-results-pager li a").off("click",this.onPagerClick))},a.prototype.initialize=function(){var o,a,r,s,l,p,c=this,h=i("app.config").searchList.list;c.el=t(h),c.initialLoad=!0,i("app.events").on(e.PropertiesEvent.FETCH_SUCCESS,function(h){return r=c.initialLoad,c.storedSearchLayout,c.initialLoad?(c.currentCoreParams=h.searchParams,c.initialLoad=!1,c.bindEvents(!0)):(c.bindEvents(!1),"listOnly"===Cookies.getJSON("SearchPreferences").Layout&&setTimeout(function(){i("app.events").trigger(e.SearchListEvent.LIST_ONLY_CLICK)},500)),h.renderedList&&!r||h.renderedList&&App.state.inGeocoordinateSearchMode?(e.Utility.LogConsole("NRT.SearchList.initialize: property_fetch_success: rendering attached event.renderedList from property fetch event."),e.Forms.Initialize(),void c.render(h.searchParams,h.renderedList)):n.isEqual(c.currentCoreParams,h.searchParams)?(e.Utility.LogConsole("NRT.SearchList.initialize: property_fetch_success: search params same - skipping list retrieval from server."),s=i("app.config").properties.listSize,p=h.searchParams.offset,o=t(l=".property-snapshot-psr-panel").first().data("offset"),a=t(l).last().data("offset"),c.bindEvents(!0),void i("app.events").trigger(e.SearchListEvent.RENDER_COMPLETE,{offset:p,isLoadPrevious:!1,lastIndex:p+s-1,indexRange:[o,a],isInitialLoad:r,changesOccurred:!1})):void c.render(h.searchParams)})},a.prototype.render=function(n,a){var r=!1,s=i("app.config").properties.listSize,l=e.Helpers.UrlQueryVar("offset",0),p=t(".property-snapshot-psr-panel").first(),c=p.length>0&&l+s===p.data("offset"),h=this,u=function(o){var a,p,u,d;r||e.Utility.LogConsole("NRT.SearchList.render > completeRender: list retrieved from server!"),h.bindEvents(!1),App.unbindAndDestroyOwlCarousels(),d=h.el,h.el.remove(),"psr-panel"!==t(o).last()[0].className?h.el=d:h.el=t(o).last(),t(".listing-results").append(h.el),h.bindEvents(!0),t(document).trigger("nrt.searchlist.listingNodesChanged"),h.currentCoreParams=n,a=t(".search-list "+(u=".property-snapshot-psr-panel")).first().data("offset"),p=t(".search-list "+u).last().data("offset"),i("app.events").trigger(e.SearchListEvent.RENDER_COMPLETE,{offset:l,isLoadPrevious:c,forceScroll:!0,lastIndex:l+s-1,indexRange:[a,p],isInitialLoad:!1,changesOccurred:!0}),i("app.state").showSaveSearch||t(".save-search-alert-close").parent().parent().hide(),i("app.state").showVOWAlert||t(".vow-alert-close").parent().parent().hide()};if(a)return r=!0,void u(a);e.Utility.LogConsole("NRT.SearchList.render: getting new list HTML from the server..."),t.ajax({type:"POST",url:o.location.protocol+"//"+o.location.hostname+o.location.pathname,data:n}).done(function(e,t,i){u(e)}).fail(function(e,t,i){h.el.html(i)})},e.SearchList=a}(window.NRT,jQuery,ioc,_,window),function(e,t,i){var n={general:{redoSearchCheckboxSelector:"#move-map-update"},nearbyForm:{selector:".nearby-form",initialize:function(){$(".nearby-form").change(function(){i("app.events").trigger(e.FormEvent.CHANGE,{className:"NearbyForm"})})}},properties:{endpoint:e.Utility.AssembleUrl(["searchresults","getsearchresults"]),maxResults:0,pageSize:0,listSize:0},searchForm:{selector:".search-form"},searchList:{list:"#searchList",listGapTemplate:".load-incremental-properties-template",listGroupTemplate:".list-items-template",listTemplate:".list-template"},marker:{icons:{property:{cluster:{anchor:null,width:22,height:30,infoBox:{alignBottom:!0,disableAutoPan:!0,closeBoxURL:"",maxWidth:380,pixelOffset:new google.maps.Size(-185,-32)}},major:{normal:[e.StaticBasePath+"/i/map/pins/pin-major/1.png",e.StaticBasePath+"/i/map/pins/pin-major@2x/1.png"],active:[e.StaticBasePath+"/i/map/pins/pin-major-active/1.png",e.StaticBasePath+"/i/map/pins/pin-major-active@2x/1.png"],visited:[e.StaticBasePath+"/i/map/pins/pin-major-visited/1.png",e.StaticBasePath+"/i/map/pins/pin-major-visited@2x/1.png"],anchor:null,width:22,height:30,infoBox:{alignBottom:!0,disableAutoPan:!0,closeBoxURL:"",maxWidth:380,pixelOffset:new google.maps.Size(-185,-32)}},minor:{normal:[e.StaticBasePath+"/i/map/pins/pin-major/1.png",e.StaticBasePath+"/i/map/pins/pin-major@2x/1.png"],active:[e.StaticBasePath+"/i/map/pins/pin-major-active/1.png",e.StaticBasePath+"/i/map/pins/pin-major-active@2x/1.png"],visited:[e.StaticBasePath+"/i/map/pins/pin-major-visited/1.png",e.StaticBasePath+"/i/map/pins/pin-major-visited@2x/1.png"],anchor:null,width:22,height:30,infoBox:{alignBottom:!0,disableAutoPan:!0,closeBoxURL:"",maxWidth:380,pixelOffset:new google.maps.Size(-185,-32)}}},poi:{default:{normal:["/a/i/hc/pins/poi-flag.png","/a/i/hc/pins/poi-flag@2x.png"],active:["/a/i/hc/pins/poi-flag-hover.png","/a/i/hc/pins/poi-flag-hover@2x.png"],anchor:null,width:28,height:38,searchTypes:[],infoBox:{alignBottom:!0,disableAutoPan:!0,closeBoxURL:"",maxWidth:380,pixelOffset:new google.maps.Size(-191,-48)}},dining:{normal:["/a/i/hc/pins/poi-dining.png","/a/i/hc/pins/poi-dining@2x.png"],active:["/a/i/hc/pins/poi-dining-hover.png","/a/i/hc/pins/poi-dining-hover@2x.png"],anchor:null,width:28,height:38,searchTypes:["restaurant"],infoBox:{alignBottom:!0,disableAutoPan:!0,closeBoxURL:"",maxWidth:380,pixelOffset:new google.maps.Size(-191,-48)}},schools:{normal:["/a/i/hc/pins/poi-schools.png","/a/i/hc/pins/poi-schools@2x.png"],active:["/a/i/hc/pins/poi-schools-hover.png","/a/i/hc/pins/poi-schools-hover@2x.png"],anchor:null,width:28,height:38,searchTypes:["school"],infoBox:{alignBottom:!0,disableAutoPan:!0,closeBoxURL:"",maxWidth:380,pixelOffset:new google.maps.Size(-191,-48)}},shopping:{normal:["/a/i/hc/pins/poi-shopping.png","/a/i/hc/pins/poi-shopping@2x.png"],active:["/a/i/hc/pins/poi-shopping-hover.png","/a/i/hc/pins/poi-shopping-hover@2x.png"],anchor:null,width:28,height:38,searchTypes:["store"," shopping_mall"],infoBox:{alignBottom:!0,disableAutoPan:!0,closeBoxURL:"",maxWidth:380,pixelOffset:new t.Size(-191,-48)}},worship:{normal:["/a/i/hc/pins/poi-worship.png","/a/i/hc/pins/poi-worship@2x.png"],active:["/a/i/hc/pins/poi-worship-hover.png","/a/i/hc/pins/poi-worship-hover@2x.png"],anchor:null,width:28,height:38,searchTypes:["place_of_worship"],infoBox:{alignBottom:!0,disableAutoPan:!0,closeBoxURL:"",maxWidth:380,pixelOffset:new t.Size(-191,-48)}}},detail:{major:{normal:[e.StaticBasePath+"/i/map/pins/pin-major/1.png",e.StaticBasePath+"/i/map/pins/pin-major@2x/1.png"],active:[e.StaticBasePath+"/i/map/pins/pin-major-active/1.png",e.StaticBasePath+"/i/map/pins/pin-major-active@2x/1.png"],visited:[e.StaticBasePath+"/i/map/pins/pin-major-visited/1.png",e.StaticBasePath+"/i/map/pins/pin-major-visited@2x/1.png"],anchor:null,width:28,height:38,infoBox:{alignBottom:!0,disableAutoPan:!0,closeBoxURL:"",maxWidth:380,pixelOffset:new t.Size(-180,-51)}},minor:{normal:[e.StaticBasePath+"/i/map/pins/pin-minor/1.png",e.StaticBasePath+"/i/map/pins/pin-minor@2x/1.png"],active:[e.StaticBasePath+"/i/map/pins/pin-minor-active/1.png",e.StaticBasePath+"/i/map/pins/pin-minor-active@2x/1.png"],visited:[e.StaticBasePath+"/i/map/pins/pin-minor-visited/1.png",e.StaticBasePath+"/i/map/pins/pin-minor-visited@2x/1.png"],anchor:[8,8],width:17,height:17,infoBox:{alignBottom:!0,disableAutoPan:!0,closeBoxURL:"",maxWidth:380,pixelOffset:new t.Size(-180,-21)}}}},endpoint:e.Utility.AssembleUrl(["searchresults","getmapbubble"])},mapMarkers:{endpoint:e.Utility.AssembleUrl(["searchresults","getmapbubble"])},searchMap:{selector:"#map",zoomImages:{minus:[e.StaticBasePath+"/i/map/controls/zoom-minus/1.png",e.StaticBasePath+"/i/map/controls/zoom-minus@2x/1.png"],minusHover:[e.StaticBasePath+"/i/map/controls/zoom-minus-hover/1.png",e.StaticBasePath+"/i/map/controls/zoom-minus@2x-hover/1.png"],plus:[e.StaticBasePath+"/i/map/controls/zoom-plus/1.png",e.StaticBasePath+"/i/map/controls/zoom-plus@2x/1.png"],plusHover:[e.StaticBasePath+"/i/map/controls/zoom-plus-hover/1.png",e.StaticBasePath+"/i/map/controls/zoom-plus@2x-hover/1.png"],width:25,height:25},map:{mapTypeId:t.MapTypeId.ROADMAP,scrollwheel:!1,zoom:12,panControl:!1,zoomControl:!1,mapTypeControl:!1,scaleControl:!1,streetViewControl:!1,overviewMapControl:!1,styles:[{featureType:"road.highway",elementType:"geometry",stylers:[{saturation:-100},{color:"#bebebe"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#dce6f9"},{visibility:"on"}]},{featureType:"road.arterial",elementType:"geometry.fill",stylers:[{color:"#ffffff"},{visibility:"on"}]},{featureType:"poi.attraction",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.business",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.government",elementType:"labels",stylers:[{visibility:"on"}]},{featureType:"poi.medical",elementType:"labels.text",stylers:[{saturation:-100},{visibility:"on"}]},{featureType:"poi.place_of_worship",elementType:"labels",stylers:[{visibility:"on"}]},{featureType:"poi.school",elementType:"labels",stylers:[{visibility:"on"}]},{featureType:"poi.sports_complex",elementType:"labels",stylers:[{visibility:"on"}]},{featureType:"administrative.land_parcel",elementType:"geometry",stylers:[{visibility:"on"}]},{featureType:"poi.medical",elementType:"geometry.fill",stylers:[{color:"#cfc4ba"},{lightness:38},{visibility:"on"}]},{featureType:"transit",elementType:"labels.icon",stylers:[{visibility:"on"}]},{featureType:"road.highway",elementType:"labels",stylers:[{saturation:-100}]},{featureType:"poi.park",elementType:"geometry",stylers:[{visibility:"on"},{saturation:-19},{color:"#cfdaa8"}]},{featureType:"poi.park",elementType:"labels.icon",stylers:[{visibility:"on"}]},{featureType:"poi.medical",elementType:"labels.icon",stylers:[{visibility:"on"}]},{featureType:"transit",elementType:"labels.text",stylers:[{saturation:-100}]},{featureType:"poi.park",elementType:"labels.text",stylers:[{saturation:-100}]},{featureType:"road",elementType:"labels.icon",stylers:[{saturation:-100},{visibility:"on"}]},{featureType:"poi.business",elementType:"geometry",stylers:[{visibility:"off"}]},{featureType:"poi.sports_complex",elementType:"geometry",stylers:[{visibility:"on"}]},{featureType:"poi.school",elementType:"geometry",stylers:[{visibility:"off"}]},{featureType:"poi.attraction",elementType:"geometry",stylers:[{visibility:"off"}]},{featureType:"poi.place_of_worship",stylers:[{visibility:"on"}]},{featureType:"poi.government",stylers:[{visibility:"on"}]},{featureType:"landscape.man_made",elementType:"all",stylers:[{visibility:"on",color:"#e3e3e3"}]},{featureType:"landscape.natural",elementType:"all",stylers:[{color:"#f0eee5"}]},{featureType:"administrative.land_parcel",stylers:[{visibility:"on"}]},{featureType:"administrative.neighborhood",stylers:[{visibility:"on"},{saturation:-100},{lightness:30}]},{featureType:"road.local",elementType:"geometry.stroke",stylers:[{visibility:"on"},{saturation:-100},{lightness:37}]},{featureType:"transit.station.airport",elementType:"geometry.fill",stylers:[{visibility:"on"}]},{featureType:"administrative.country",elementType:"labels.text.fill",stylers:[{visibility:"on"},{color:"#474747"}]},{featureType:"administrative.locality",elementType:"labels.text.stroke",stylers:[{color:"#ffffff"}]},{featureType:"administrative.locality",elementType:"labels.text.fill",stylers:[{color:"#122c4a"}]}]},roadmapOverrideStyles:{styles:[{featureType:"road.highway",elementType:"geometry",stylers:[{visibility:"on"},{saturation:-100},{color:"#bebebe"}]},{featureType:"road.arterial",elementType:"geometry.fill",stylers:[{color:"#ffffff"},{visibility:"on"}]},{featureType:"road.local",elementType:"geometry.fill",stylers:[{visibility:"on"}]}]},satelliteOverrideStyles:{styles:[{featureType:"road.highway",elementType:"geometry",stylers:[{visibility:"off"}]},{featureType:"road.arterial",elementType:"geometry.fill",stylers:[{visibility:"off"}]},{featureType:"road.local",elementType:"geometry.fill",stylers:[{visibility:"off"}]},{featureType:"road.local",elementType:"geometry.stroke",stylers:[{visibility:"off"}]}]}}};e.AppConfig=n}(window.NRT,google.maps,ioc),function(e,t,i,n){var o=function(e){a.searchMap=e},a={};o.prototype.SubmitYelpQueries=function(i,n,o){var r,s={bounds:i,categories:n};a.fillEmptyAttempts=0,r=t.proxy(a.fetchSuccess,a),t.ajax({type:"POST",contentType:"application/json; charset=utf-8",dataType:"json",url:e.Utility.AssembleUrl(["yelp","query"]),data:JSON.stringify(s)}).done(function(e){r(e,o)}).fail(function(t,i,n){e.StatusSlider.ShowErrorSlider();var o="NRT.PoiManager.submitYelpQueries: Ajax Error";throw e.Event.Raise(e.Event.eError.ASYNC_ERROR,o,t,i,n),e.Utility.LogConsole(o+": "+n),new Error(o)})},a={initialResponse:[],index:{},nonGeocodedBalloons:[],scratchpad:[],fillEmptyAttempts:0,establishedSections:[],searchMap:null,restoreCoordinate:function(e){var t,i,n;t=e[0].geometry.location.lat(),i=e[0].geometry.location.lng(),n=a.index[e.balloon.Address],a.initialResponse[n.responseIndex].Balloons[n.balloonIndex].Latitude=t,a.initialResponse[n.responseIndex].Balloons[n.balloonIndex].Longitude=i},reQueueRequest:function(e){a.nonGeocodedBalloons.push(e.balloon)},batchComplete:function(t){return e.Utility.ExecuteOnNth(function(){a.fillEmptyAttempts<3&&0!==a.nonGeocodedBalloons.length&&(a.fillEmptyAttempts+=1,a.fillMissingGeocodes())},t,a)},fetchSuccess:function(e,i){var o,r,s,l,p,c,h=e.length,u=a.initialResponse,d=function(e){return 0!==e.Latitude&&0!==e.Longitude},f=function(e){return 0===e.Latitude&&0===e.Longitude};for(o=u.length=0,a.index={},a.nonGeocodedBalloons.length=0,t.extend(!0,u,e),i(),r=0;r<h;r+=1){for(a.scratchpad=n.filter(u[r].Balloons,d),s=0;s<a.scratchpad.length;s+=1)a.placeYelpDataOnSearchMap(a.scratchpad[s]);a.scratchpad=n.filter(u[r].Balloons,f),a.nonGeocodedBalloons=a.nonGeocodedBalloons.concat(a.scratchpad),a.scratchpad.length=0}if(0!==a.nonGeocodedBalloons.length){for(r=0;r<o;r+=1)for(p=(l=u[r].Balloons).length,s=0;s<p;s+=1)(c=a.index[l[s].Address]={}).responseIndex=r,c.balloonIndex=s;a.fillEmptyAttempts+=1,a.fillMissingGeocodes()}},fillMissingGeocodes:function(){var n,o=a.nonGeocodedBalloons.slice(0),r=o.length,s=new i.Geocoder,l=e.Utility.TimeDistribute(function(e,t){s.geocode(e,t)},105,a),p=[],c=t.proxy(a.batchComplete(r),a),h=t.proxy(a.restoreCoordinate,a),u=t.proxy(a.reQueueRequest,a),d=t.proxy(a.placeGoogleGeocodedYelpDataOnSearchMap,a),f=function(e,t){h(e,t),d(e,t)},g=function(e,t){u(e,t)},m=function(e,t){c(e,t)},y=function(e,t){var i;setTimeout((i=o[n],function(){"pending"===e.state()&&e.reject({balloon:i})}),t)},v=function(e,i,n){l({address:e.Address},function(o,a){"OK"===a?i.resolve(t.extend(o,{balloon:e}),a,n):i.reject(t.extend(o,{balloon:e}),a,n)})};for(a.nonGeocodedBalloons.length=0,n=0;n<r;n+=1)p.push(t.Deferred().done(f).fail(g).always(m)),p[n].timeout=y,p[n].timeout(p[n],8100),v(o[n],p[n],n)},yelpDataAndGeocodesAreDone:function(){var e,t,i,n,o,r=a.initialResponse,s=r.length;for(e=0;e<s;e+=1)for(n=(i=r[e]).Balloons.length,t=0;t<n;t+=1)o=a.groomYelpData(i.Balloons[t],i.Category),a.searchMap.YelpArray.push(o);a.searchMap.markers.onNearbySearchComplete()},placeGoogleGeocodedYelpDataOnSearchMap:function(e,t){a.placeYelpMarker(a.groomGoogleGeocodedYelpData(e))},groomGoogleGeocodedYelpData:function(e,t){var i=e.balloon;return i.POICategory=["restaurant","store","school","place_of_worship"][i.POICategory],i.geometry={},i.geometry.location=e[0].geometry.location,i.isOnMap=0,i},placeYelpDataOnSearchMap:function(e){a.placeYelpMarker(a.groomYelpData(e))},groomYelpData:function(e){return e.POICategory=["restaurant","store","school","place_of_worship"][e.POICategory],e.geometry={},e.geometry.location=new i.LatLng(e.Latitude,e.Longitude),e.isOnMap=0,e},placeYelpMarker:function(t){var i=new e.PoiMarker({placeResult:t},{position:t.geometry.location,map:a.searchMap.map});a.searchMap.markers.poiMarkers.push(i),t.isOnMap=1}},e.PoiManager=o}(window.NRT,jQuery,google.maps,_),function(e,t,i){var n=function(){},o={drawCallback:null,map:null,fitBoundsPostDraw:!1,fitBoundsPreDrawCondition:!1,config:null};n.prototype.Initialize=function(e){o.drawCallback=e.drawCallback,o.map=e.map,o.fitBoundsPostDraw=e.fitBoundsPostDraw||!1,o.fitBoundsPreDrawCondition=e.fitBoundsPreDrawCondition||!1,e.config?o.config=e.config:o.config={fillColor:"#5778a4",fillOpacity:.2,strokeColor:"#2560b1",strokeOpacity:.8,strokeWeight:2}},n.prototype.DrawBoundaries=function(t){var n,a,r,s,l,p,c,h,u,d,f,g,m,y,v,S,M,E,L,_;if(o.fitBoundsPreDrawCondition)return n=o.fitBoundsPreDrawCondition,o.fitBoundsPreDrawCondition=!1,n({instance:o,data:t}),void e.Utility.LogConsole("NRT.MapBoundaries.DrawBoundaries: boundary drawing > preDrawCondition found, defering boundary drawing to delegate.");if(l=t.primaryLocation,_=t.envelope,E=t.totalLocationCount,s=(r=l.shapeArray?JSON.parse(l.shapeArray):[]).length,0,null,a=null,M=[],E>1)return L={north:_.latitudeMax,east:_.longitudeMax,south:_.latitudeMin,west:_.longitudeMin},o.map.fitBounds(L);for(l&&void 0!==l.latitude&&void 0!==l.longitude&&1===E&&new i.LatLng(l.latitude,l.longitude),p=0;p<s;p+=1){for(o.config.paths=[],h=(c=r[p]).length,u=0;u<h;u+=1){for(f=(d=c[u]).length,g=[],m=0;m<f;m+=1)y=d[m],v=new i.LatLng(y[1],y[0]),g.push(v);1===c.length?o.config.paths=g:o.config.paths.push(g)}o.config.clickable=!1,(S=new i.Polygon(o.config)).setMap(o.map),M.push(S.getBounds())}M&&M.length>0&&(a=this.getBoundsOfPolygons(M)),null!==a&&o.fitBoundsPostDraw?(o.drawCallback&&o.drawCallback(),o.map.fitBounds(a),e.Utility.LogConsole("NRT.MapBoundaries.DrawBoundaries: boundary drawing > map boundaries drawn and map fitted.")):e.Utility.LogConsole("NRT.MapBoundaries.DrawBoundaries: boundary drawing > skipping drawing because "+(null===a?" no bounds available ":" fitBoundsPostDraw is false."))},n.prototype.getBoundsOfPolygons=function(e){var t,i,n,o,a,r,s,l,p;for(n=90,o=180,a=-90,r=-180,p=null,t=0;t<e.length;t++)s=(p=e[t]).getNorthEast(),l=p.getSouthWest(),s.lat()>a&&(a=s.lat()),s.lng()>r&&(r=s.lng()),l.lat()<n&&(n=l.lat()),l.lng()<o&&(o=l.lng());return(i=new google.maps.LatLngBounds).extend(new google.maps.LatLng(n,o)),i.extend(new google.maps.LatLng(a,r)),i},t(window).load(function(){i.Polygon.prototype.getBounds=function(){var e,t,n,o,a=new i.LatLngBounds,r=this.getPaths(),s=r.getLength();for(n=0;n<s;n+=1)for(t=(e=r.getAt(n)).getLength(),o=0;o<t;o+=1)a.extend(e.getAt(o));return a}}),e.MapBoundaries=n}(window.NRT,jQuery,google.maps),function(e,t,i,n,o,a,r,s,l){var p={},c={};p={state:{isIE8:!s.addEventListener,pageInitialized:!1,mobileLatchState:!1,tabletDownLatchState:!1,isMobileViewShowingMap:!1,listIndexRange:[-1,-1],showSaveSearch:!0,showVOWAlert:!0,inGeocoordinateSearchMode:!1,listViewType:"",isMobileSize:function(){return t(r).width()<=601},isTabletDownSize:function(){return r.matchMedia("(max-width: 1000px)").matches},isShowPDModal:!1,mapBoundaryNotDrawn:!0,carouselsOn:!1,isPDModalOpen:!1},clientDeviceMode:1,poiManager:{},searchData:{},infoWindow:null,spinner:null,router:null,panelToHide:null,userInitiatedLoad:!1,properties:null,searchForm:null,nearbyForm:null,searchMap:null,searchList:null,defaultGroupID:11111,reloadResults:function(){this.searchMap.markers.clearAll(),this.infoWindow&&this.infoWindow.Close(),this.state.inGeocoordinateSearchMode?(this.searchData.offset=0,e.Utility.LogConsole("in Geo mode - reset offset to 0."),this.router.fetchBoundsData(!0)):this.properties.fetch({searchId:this.searchData.searchId,groupId:this.searchData.groupId,sortId:this.searchData.sortId,offset:this.searchData.offset,forceFetch:!0})},onInitialMapTabClickHandler:function(t){ioc("app.events").once(e.SearchListEvent.MOBILE_MAP_TRIGGER_CLICK,function(e){t.instance.drawBoundaries(t.data)})},bootstrap:function(t){var i;this.clientDeviceMode=t.ClientDeviceMode,this.searchData=t.SearchData||{},this.searchMap.initialLatLong=t.MapData,this.searchMap.drawBoundaries=t.MapData.DrawBoundaries,this.state.isShowPDModal=e.Global.Feature.UsePDModal,this.properties.config().maxResults=t.Config.maxResults,this.properties.config().pageSize=t.Config.pageSize,this.properties.config().listSize=t.Config.listSize,this.searchform.initialPrimaryLocationPath=t.InitialPrimaryLocationPath,this.searchform.initialPrimaryLocationEntity=t.InitialPrimaryLocationEntity,this.searchform.searchType=t.SearchType,this.searchform.searchTypeOriginalId=t.SearchTypeOriginalId,this.searchform.searchCategoryType=t.SearchCategoryType,this.searchform.propertyCategoryType=t.PropertyCategoryType,this.searchform.searchSource=t.SearchSource,this.searchData.TotalResults=t.TotalResults,this.searchform.stateId=t.StateID,this.state.listViewType=t.ListViewType,i=p.getLayout(),["listOnly","mapOnly","listMap"].indexOf(i)>-1&&(e.Utility.LogConsole('App.boostrap: change value of me.state.listViewType from "'+p.state.listViewType+'" to "'+i+'".'),p.state.listViewType=i)},kickOff:function(){n.history.start({pushState:a.history,root:r.location.pathname})},getLayout:function(){return o.getJSON("SearchPreferences").Layout},setLayout:function(t){var i="SearchPreferences",n=o.getJSON(i);ioc("app.state").listViewType=t,n?n.Layout=t:n={Layout:t,Sort:0},o.set(i,n,{domain:"."+r.location.hostname,expires:30}),e.Utility.LogConsole("App.setLayout: Set layout to "+t+".")},setGeoMode:function(n){var o,a,r,s;if(p.state.inGeocoordinateSearchMode===n)return e.Utility.LogConsole("App.setGeoMode: already in proper geo mode, isgeoMode="+n.toString()),void(n&&(e.Utility.LogConsole("App.setGeoMode: geo Mode is on, fetching property data..."),p.router.fetchBoundsData(!0)));p.state.inGeocoordinateSearchMode=n,e.ListingCache.Clear(),e.Utility.LogConsole("App.setGeoMode: flipping isgeoMode to "+n.toString()),n?(p.spinner.Spin(),t("#UnmapableMessage").addClass("hide"),!(s=e.Helpers.UrlQueryVarsForReset()).z&&p.searchMap.map&&(s.z=p.searchMap.map.getZoom(),o=p.searchMap.map.getCenter(),s.c=o.lat()+","+o.lng()),p.state.pageInitialized&&(p.searchData.offset=0),e.Utility.LogConsole("App.setGeoMode: geoMode on, fetching bounded property data..."),p.router.fetchBoundsData()):(p.spinner.Spin(),s&&(e.Utility.LogConsole("App.setGeoMode: exiting geo mode, reverting to saved params..."),p.searchData.offset=s.offset||0,p.searchData.sortId=s.sortId||0,p.searchData.groupId=s.groupId,a=p.searchMap.map.getZoom(),(r=s.z||a)!==a&&(ioc("app.events").blockNext(e.SearchMapEvent.ZOOM_CHANGED),p.searchMap.map.setZoom(parseInt(r,10))),s.c&&(o=s.c.split(","),e.Utility.LogConsole("App.setGeoMode: exiting geo mode, reverting to saved map center..."),p.searchMap.map.setCenter(new i.LatLng(parseFloat(o[0]),parseFloat(o[1]))))),e.Utility.LogConsole("App.setGeoMode: Fetching non-bounds data..."),p.router.fetchNonBoundsData(),e.Utility.LogConsole("App.setGeoMode: done."))},unbindAndDestroyOwlCarousels:function(){e.Utility.LogConsole("App.unbindAndDestroyOwlCarousels : start"),t("div.photo-carousel.owl").each(function(){var e=t(this).find("div.owl-carousel");e.trigger("destroy.owl.carousel"),e.html(e.find(".owl-stage-outer").html()).removeClass("owl-loaded"),e.off("prev.owl.carousel").off("initialized.owl.carousel").off("changed.owl.carousel")}),p.state.carouselsOn=!1,e.Utility.LogConsole("App.unbindAndDestroyOwlCarousels : end")},owlCarouselSetup:function(i){var n=t(i),o=n.find("div.owl-carousel"),a=!((o.data("photocount")||0)<=1);e.Utility.LogConsole("App.owlCarouselSetup: executed"),o.trigger("destroy.owl.carousel"),o.html(o.find(".owl-stage-outer").html()).removeClass("owl-loaded"),o.one("initialized.owl.carousel",function(t){n.parent().find(".open-house").velocity({bottom:0},{duration:1e3},{easing:"easeOutSine"}),ioc("app.events").on(e.SearchListEvent.LIST_ONLY_CLICK,function(){o.trigger("refresh.owl.carousel")}),ioc("app.events").on(e.SearchListEvent.LIST_MAP_CLICK,function(){o.trigger("refresh.owl.carousel")})}),o.off("changed.owl.carousel").on("changed.owl.carousel",function(e){if(e.namespace&&"position"===e.property.name){var i=e.item.index,o=(t(e.currentTarget).find(".owl-item").eq(i),i+1-e.relatedTarget._clones.length/2),a=e.item.count;(o>a||0===o)&&(o=a-o%a),n.siblings(".photo-count-open-house-holder").find(".photo-count.icon-camera.owl").text(o+"/"+a)}}),o.owlCarousel({items:1,center:!0,dots:!1,loop:!0,lazyLoad:!0,margin:0,stagePadding:0,mergeFit:!1,startPosition:0,nav:!1,touchDrag:a,mouseDrag:a}),a?n.find(".controls").find(".prev").off("click").on("click",function(){o.trigger("prev.owl.carousel")}).end().find(".next").off("click").on("click",function(){o.trigger("next.owl.carousel")}).end():n.find(".controls").hide()},loadAndInitializeOwlCarousels:function(){p.state.carouselsOn||(e.Utility.LogConsole("App.loadAndInitializeOwlCarousels: start"),t("div.photo-carousel.owl").one("inview",function(){e.Utility.LogConsole("App.loadAndInitializeOwlCarousels: inview event fired: initializing..."),p.owlCarouselSetup(this)}),p.state.carouselsOn=!0,e.Utility.LogConsole("App.loadAndInitializeOwlCarousels: end"))},loadDetailModal:function(i,n){var o,a,l;p.state.isShowPDModal&&(p.state.isPDModalOpen?e.PropertyDetailModal.navigate(n):(p.state.isPDModalOpen=!0,o=0===p.clientDeviceMode,a=p.state.isMobileSize(),o||a?(l=t(s).scrollTop(),t("section.content,.page-header,.page-footer").hide(),t(".hbib-properties-drawer").css("display","none"),s.getElementById("detail-modal-container")||t("body").prepend(['<div id="detail-modal-container" style="background:#fff;position:absolute">','<div id="detail-iframe-header" class="modal-container" style="position:fixed;left:0;right:0;width:100%;z-Index:100000">','<a href="#" id="detail-iframe-close" class="btn-pd-modal btn-pd-close icon-cross"><span>Close</span></a>',a?"":'<a id="detail-iframe-expand" target="_blank" href="#" class="btn-pd-modal btn-pd-expand icon-expand"><span>Expand</span></a>',"</div>",'<div id="detail-iframe-container" style="margin-top:43px;background:#fff;width:100vw;height:100vh">','<iframe id="detail-iframe" src="about:blank" style="border:0;width:100vw;height:100vh"></iframe>',"</div>","</div>"].join("")),o?t("#detail-iframe").on("load",function(){r.scrollTo(0,0)}):t("body").css("position","fixed"),t("#detail-iframe-close").on("click",e.PropertyDetailModal.close),e.PropertyDetailModal.open(n,function(){o||t("body").css("position","");t("#detail-iframe-close").off("click",e.PropertyDetailModal.close),t("#detail-modal-container").remove(),t("section.content, .page-header, .page-footer").show(),t(".hbib-properties-drawer").css("display",""),t(".google-maps").css("position","relative"),t("window").trigger("resize"),t(s).scrollTop(l)})):p.loadDetailModalInLightBox(i,n)))},loadDetailModalInLightBox:function(i,n){var o,a;s.getElementById("detail-modal-container")||(a=t("body").css("overflow"),t("body").css("overflow","hidden").prepend(['<div id="detail-modal-container" style="border:0;left:0;right:0;width:calc(100vw - 9%);max-width:1520px;height:100vh;z-index:9999999;background-color:transparent;overflow:hidden">','<div id="detail-iframe-header" class="modal-container" style="width:100%">','<a href="#" id="detail-iframe-close" class="btn-pd-modal btn-pd-close icon-cross"><span>Close</span></a>','<a id="detail-iframe-expand" target="_blank" href="#" class="btn-pd-modal btn-pd-expand icon-expand"><span>Expand</span></a>',"</div>",'<iframe id="detail-iframe" src="about:blank" allowfullscreen="true" style="position:absolute;border:0;width:calc(100vw - 10%);max-width:1520px;top:43px;height:calc(100vh - 40px);z-index:99999999"></iframe>',"</div>"].join("")),o=t("#detail-modal-container").lightbox_me({centered:!0,clipHeaderPadding:!0,closeClick:!1,preventScroll:!0,overlaySpeed:0,lightboxSpeed:0,destroyOnClose:!0,onClose:function(){t("body").css("overflow",a)},modalCSS:{position:"fixed",height:"100%",background:"#fff"}}),t("#detail-iframe-close").on("click",function(t){t.preventDefault(),e.PropertyDetailModal.close(!0),o.trigger("close")})),e.PropertyDetailModal.open(n,function(){o.trigger("close")})}},r.addEventListener("popstate",function(i){var n=i.state&&i.state.depth;0===n?p.state.isPDModalOpen&&(e.PropertyDetailModal.close(),e.PropertyDetailModal.saveState(i.state.url,i.state.depth,!1)):n===l||null===n||(p.state.isPDModalOpen?(e.PropertyDetailModal.navigate(i.state.url),e.PropertyDetailModal.saveState(i.state.url,i.state.depth,!1)):t("body").hasClass("body-property-search-results")?(e.PropertyDetailModal.open(i.state.url),e.PropertyDetailModal.saveState(i.state.url,i.state.depth,!1)):r.location.reload())},!0),c={initialize:function(){var o;p.spinner=new e.Spinner,p.state.tabletDownLatchState=p.state.isTabletDownSize(),t(r).on("resize",e.Utility.Throttle(function(){o=p.state.isTabletDownSize(),p.state.tabletDownLatchState!==o&&(p.state.tabletDownLatchState=o,o?ioc("app.events").trigger(e.AppEvent.ENTER_TABLET_DOWN_SIZE):ioc("app.events").trigger(e.AppEvent.EXIT_TABLET_DOWN_SIZE))},250)),c.initPSRPanelCarouselsInview(),ioc.register("app.config",e.AppConfig),ioc.register("app.events",e.EventBus),ioc.register("app.state",p.state),p.properties=new e.Properties,e.Effects.Initialize(),p.searchform=new e.SearchForm(e.AppConfig.searchForm),p.nearbyForm=new e.NearbyForm(e.AppConfig.nearbyForm),p.searchMap=new e.SearchMap,p.searchList=new e.SearchList,p.searchList.initialize(),c.Router=n.Router.extend({initialize:function(){var i,n=this;t(s).on("click","#searchList .next-mls-group",function(n){p.spinner.Spin();var o,a,l=t(this).prop("href"),c=/\/g_(\d+)\//i.exec(l);c&&c[1]?p.searchData.groupId=Number(c[1]):p.searchData.groupId=p.defaultGroupID,p.searchData.offset=0,i=p.searchMap.map.getBounds().toUrlValue(),"listOnly"!==p.state.listViewType&&(p.searchMap.lastBounds=i),a=p.searchData.groupId===p.defaultGroupID?{sortId:p.searchData.sortId,groupId:null,offset:null}:{sortId:p.searchData.sortId,groupId:p.searchData.groupId,offset:null},o=e.Helpers.Path(a),p.router.navigate(o),p.properties.fetchFromUrl(p.state.inGeocoordinateSearchMode?{bounds:i,forceFetch:!0}:null),r.history.replaceState({url:l,depth:0},s.title,l),n.preventDefault()}),e.Global.Feature.UseNewPropertySearchFilters||t(".layout-search-results").on("change",".sort select",function(e){var i=parseInt(t(this).val())||0;e.preventDefault(),p.spinner.Spin(),p.searchData.sortId=i,p.searchData.offset=0,p.state.inGeocoordinateSearchMode?p.router.fetchBoundsData():p.router.fetchNonBoundsData()}),ioc("app.events").on(e.SearchListEvent.MOBILE_MAP_TRIGGER_CLICK,function(){var t=null;p.state.isMobileViewShowingMap=!0,setTimeout(function(){e.Utility.LogConsole("NRT.SearchListEvent.MOBILE_MAP_TRIGGER_CLICK: setTimeout completed: "),t=null,p.searchMap.map&&(t=p.searchMap.map.getZoom()),n.navigate(e.Helpers.Path({sortId:p.searchData.sortId,offset:p.searchData.offset,z:t,mode:"m"})),p.router.maybeFetch()},500)}),ioc("app.events").on(e.SearchListEvent.MOBILE_LIST_TRIGGER_CLICK,function(){p.state.isMobileViewShowingMap=!1,n.navigate(e.Helpers.Path({sortId:p.searchData.sortId,offset:p.searchData.offset,mode:"l"}))}),ioc("app.events").on(e.SearchListEvent.LOAD_MORE_CLICK,function(t){p.spinner.Spin(),p.userInitiatedLoad=!0,p.searchData.offset=t.pageoffset,p.searchMap.lastBounds=p.searchMap.map.getBounds().toUrlValue(),n.navigate(e.Helpers.Path({sortId:p.searchData.sortId,offset:p.searchData.offset})),p.properties.fetchFromUrl(p.state.inGeocoordinateSearchMode?{bounds:p.searchMap.lastBounds,forceFetch:!0}:null)}),ioc("app.events").on(e.SearchListEvent.PAGER_CLICK,function(t){p.spinner.Spin(),p.userInitiatedLoad=!0,p.searchData.offset=(t.pagenumber-1)*e.AppConfig.properties.listSize,n.navigate(e.Helpers.Path({sortId:p.searchData.sortId,offset:p.searchData.offset})),p.properties.fetchFromUrl(p.state.inGeocoordinateSearchMode?{bounds:p.searchMap.lastBounds,forceFetch:!0}:null)}),ioc("app.events").on(e.SearchMapEvent.MAJOR_PIN_CLICK,function(t){n.navigate(e.Helpers.Path({sortId:p.searchData.sortId,l:t.marker.model.Offset}))}),ioc("app.events").on(e.SearchMapEvent.MINOR_PIN_CLICK,function(t){var i,n,o;p.spinner.Spin(),p.userInitiatedLoad=!0,i=t.marker.model.Offset,n=ioc("app.config").properties.listSize,o=e.Helpers.BaseIndex(i,n),p.searchData.offset=o,e.Utility.LogConsole("App.router.initialize: Clicked minor pin offset "+i+" with base list offset to load set at "+o),p.state.inGeocoordinateSearchMode?p.router.fetchBoundsData():p.router.fetchNonBoundsData()}),ioc("app.events").on(e.SearchListEvent.HIDE_PROPERTY_CLICK,function(i){var n,o,a=t(i.element);a&&(o=a.parentsUntil("div.property-snapshot").parent())&&(n=o.data("pid"),e.HBIB.HideListing(n,function(){p.reloadResults()}))}),ioc("app.events").on(e.SearchListEvent.DYM_CLOSE_CLICK,function(i){t(i.element).parent().parent().hide(),n.navigate(e.Helpers.Path({sortId:p.searchData.sortId,offset:p.searchData.offset,dym:null})),t("[name=input_for_location]").val(p.searchform.initialPrimaryLocationEntity.DisplayText)}),ioc("app.events").on(e.SearchListEvent.SAVE_SEARCH_CLOSE_CLICK,function(e){t(e.element).parent().parent().hide(),ioc("app.state").showSaveSearch=!1}),ioc("app.events").on(e.SearchListEvent.VOW_CLOSE_CLICK,function(e){t(e.element).parent().parent().hide(),ioc("app.state").showVOWAlert=!1}),ioc("app.events").on(e.AppEvent.SCROLL_EFFECT_COMPLETE,function(){p.spinner.Stop()}),ioc("app.events").on(e.SearchListEvent.RENDER_COMPLETE,function(i){var n,o,a="",s=e.session.get("pdModal"),h=null,u=!1;e.Global.Feature.UseNewPropertySearchFilters||(n=t("#prop-listing-head-totalpropcount"),a=p.properties.totalResultsCount.toLocaleString("en")+" properties",n.length>0&&n.html(a),(o=t("#prop-listing-head-alt-totalpropcount")).length>0&&o.html(" "+a)),p.state.listIndexRange=i.indexRange,p.searchData.offset=i.offset,(i.isInitialLoad||i.changesOccurred)&&(c.initPSRPanelCarouselsInview(),p.spinner.Stop(),ioc("app.events").trigger(e.AppEvent.SEARCHLIST_CHANGED,i),e.Utility.LogConsole("App.initialize: RenderComplete: initial load or changes: "+i.isInitialLoad+", changes: "+i.changesOccurred)),p.state.isTabletDownSize()||"listOnly"===p.state.listViewType&&p.searchMap.togglePager(),e.Utility.LogConsole("App.initialize: RenderComplete"),s&&s.isSyncing?(h=s.urls[s.depth],u=!0):(h=r.location.href,u=!1),e.PropertyDetailModal.saveState(h,null===history.state||history.state.depth===l?0:history.state.depth,u)})},routes:{"*splat":"main"},main:function(i){var n,o,a,r,s,l,c,h=/g_(\d+)\//i.exec(i);e.session.get("syncGeoSearch");if(e.Utility.MediaQueryEvents.currentDisplayMode<e.Utility.MediaQueryEvents.eCurrentDisplayMode.PSRMAP?this.navigate(e.Helpers.Path({g:null})):1!==e.Helpers.UrlQueryVar("g",0,n)&&e.session.get("syncGeoSearch")&&this.navigate(e.Helpers.Path({g:1})),e.session.delete("syncGeoSearch"),n=e.Helpers.UrlQueryVars(),h&&h[1]?(n.groupId=Number(h[1]),p.searchData.groupId=Number(h[1])):(n.groupId=p.defaultGroupID,p.searchData.groupId=p.defaultGroupID),o=!1===p.state.pageInitialized&&n.offset&&n.offset>0||n.groupId||0===n.groupId||n.c||n.z||n.g||0===n.g||n.groupId||0===n.groupId,!p.state.isPDModalOpen)if(ioc("app.events").on(e.PropertiesEvent.FETCH_SUCCESS,function(e){a=e.models}),!1===p.state.pageInitialized){if(r=t.Deferred(),s=t.Deferred(),l=t.Deferred(),n.pid){var u=parseInt(n.pid,10);t.ajax({type:"GET",contentType:"application/json; charset=utf-8",dataType:"json",url:e.Utility.AssembleUrl(["propertylisting","getdetailsurlforpid"]),data:{listingId:u}}).done(function(e){if(e&&e.length>0){var i=t('div[data-pid="'+n.pid+'"]');i.length>0&&i[0].scrollIntoView(),p.loadDetailModal(u,e)}})}e.Utility.LogConsole("App.router.main: App not initialized, initializing... >>>>>>>>>>>"),e.Utility.LogConsole("App.router.main: loadPreviousState is "+o.toString()),ioc("app.events").once(e.SearchMapEvent.IDLE,function(){ioc("app.events").on(e.PropertiesEvent.FETCH_SUCCESS,function(t){ioc("app.events").trigger(e.AppEvent.MAPDATA_READY,t)}),r.resolve()}),t("section.layout-search-results.psr-panel").on("click",".owl-item a, .no-photo-psr-panel a, .address a",p.searchList.onLoadDetailFrame).on("click",".load-previous-properties a, .search-results-load-more a",p.searchList.onLoadMoreClick).on("click",".propertysearch-results-pager li a",p.searchList.onPagerClick),p.searchMap.makeMap(),p.poiManager=new e.PoiManager(p.searchMap),t.when(l,s,r).done(function(t){t&&p.router.drawBoundaries(t,o),ioc("app.events").on(e.SearchMapEvent.DRAGEND,_.debounce(p.router.maybeFetch,800),p.router),ioc("app.events").on(e.SearchMapEvent.ZOOM_CHANGED,_.debounce(p.router.maybeFetch,500),p.router),ioc("app.events").trigger(e.AppEvent.MAPDATA_READY,{models:a})}),p.router.getBoundaryData({boundaryDataHasLoaded:l}),c=function(){p.router.getInitialPropertyData({propertyDataHasLoaded:s,loadPreviousState:o,queryVars:n})},1===e.Helpers.UrlQueryVar("g",0,n)?(e.Utility.LogConsole("App.router.main: App in geo mode, so defer getting prop data until map has loaded..."),t.when(r).done(function(){e.Utility.LogConsole("App.router.main: Map loaded, getting initial property data."),c(),p.state.pageInitialized=!0,e.Utility.LogConsole("App.router.main: App initialized.<<<<<<<<<<<<<<<<<")})):(c(),p.state.pageInitialized=!0,e.Utility.LogConsole("App.router.main: App initialized.<<<<<<<<<<<<<<<<<"))}else{if(n.pid){u=parseInt(n.pid,10);t.ajax({type:"GET",contentType:"application/json; charset=utf-8",dataType:"json",url:e.Utility.AssembleUrl(["propertylisting","getdetailsurlforpid"]),data:{listingId:u}}).done(function(e){var i=t('div[data-pid="'+n.pid+'"]');i.length>0&&i[0].scrollIntoView(),p.loadDetailModal(u,e)})}p.spinner.Spin(),p.router.restoreStateFromURL(n)||p.properties.fetchFromUrl(),p.spinner.Stop()}},getInitialPropertyData:function(e){e.loadPreviousState?p.router.restoreStateFromURL(e.queryVars)||p.properties.fetchFromUrl():p.properties.fetchFromHTML(p.searchMap.initialLatLong),e.propertyDataHasLoaded.resolve()},getBoundaryData:function(i){var n=[{entityType:p.searchform.initialPrimaryLocationEntity.EntityType,entityId:p.searchform.initialPrimaryLocationEntity.EntityId}],o=p.searchform.initialPrimaryLocationPath;if(n=n.concat(c.extractLocationsFromUrl("uloc-",o)).concat(c.extractLocationsFromUrl("aloc-",o)),!0===p.searchMap.drawBoundaries||n.length>1)return t.ajax({type:"POST",contentType:"application/json; charset=utf-8",dataType:"json",url:e.Utility.AssembleUrl(["location","getboundariesforsearchlocations"]),data:JSON.stringify(n)}).done(function(e){i.boundaryDataHasLoaded.resolve(e)});i.boundaryDataHasLoaded.resolve()},drawBoundaries:function(t,i){var n=new e.MapBoundaries;e.Utility.LogConsole("App.router.drawBoundaries: hi"),n.Initialize({map:p.searchMap.map,fitBoundsPostDraw:!0!==i||0===e.Helpers.UrlQueryVar("z",0),config:{fillColor:"#000000",fillOpacity:0,strokeColor:"#2560b1",strokeOpacity:.8,strokeWeight:2}}),p.state.isTabletDownSize()?p.state.isMobileViewShowingMap?n.DrawBoundaries(t):ioc("app.events").once(e.SearchListEvent.MOBILE_MAP_TRIGGER_CLICK,function(e){n.DrawBoundaries(t)}):"listOnly"===p.state.listViewType?(e.Utility.LogConsole("App.router.drawBoundaries: Deferring boundary drawing to list_map and map click events"),ioc("app.events").once(e.SearchListEvent.LIST_MAP_CLICK,function(i){e.Utility.LogConsole("App.router.list_map_click: drawing boundaries"),p.state.mapBoundaryNotDrawn&&(n.DrawBoundaries(t),p.state.mapBoundaryNotDrawn=!1)})):n.DrawBoundaries(t)},restoreStateFromURL:function(n){var o,a,r,s,l;return"m"===e.Helpers.UrlQueryVar("mode","l",n)&&(p.state.isMobileMapView=!0,ioc("app.events").trigger(e.SearchListEvent.MOBILE_MAP_TRIGGER_CLICK)),o=p.searchMap.map.getZoom(),(a=e.Helpers.UrlQueryVar("z",o,n))!==o&&p.searchMap.map.setZoom(parseInt(a,10)),(r=e.Helpers.UrlQueryVar("c",null,n))&&(r=r.split(","),p.searchMap.map.setCenter(new i.LatLng(parseFloat(r[0]),parseFloat(r[1])))),(s=e.Helpers.UrlQueryVar("l",-1,n))>-1&&ioc("app.events").once(e.SearchMapEvent.PROPERTY_MARKERS_ADDED,function(t){l=p.searchMap.markers.propertyMarkers[s],p.searchMap.markers.setActiveMarker(l),e.Effects.ScrollToProperty(s,!0)}),e.Helpers.UrlQueryVar("g",null,n)?(p.searchData.offset=n.offset||0,p.searchData.groupId=n.groupId,p.searchData.sortId=n.sortId||0,t(ioc("app.config").general.redoSearchCheckboxSelector).prop("checked",!0),p.setGeoMode(!0),!0):(t(ioc("app.config").general.redoSearchCheckboxSelector).prop("checked",!1),p.setGeoMode(!1),!1)},maybeFetch:function(){p.state.inGeocoordinateSearchMode?(p.searchData.offset=0,e.Utility.LogConsole("App.router.maybeFetch: in Geo mode - reset offset to 0."),this.fetchBoundsData()):(p.router.navigate(e.Helpers.Path({sortId:p.searchData.sortId,offset:p.searchData.offset,z:p.searchMap.map.getZoom(),g:null,c:p.searchMap.map.getCenter().toUrlValue(),b:null,l:null})),p.properties.fetch({searchId:p.searchData.searchId,groupId:p.searchData.groupId,sortId:p.searchData.sortId,offset:p.searchData.offset}))},fetchNonBoundsData:function(){p.router.navigate(e.Helpers.Path({sortId:p.searchData.sortId,offset:p.searchData.offset,z:p.searchMap.map.getZoom(),c:p.searchMap.map.getCenter().toUrlValue(),g:null,b:null,l:null})),p.searchMap.markers.clearAll(),p.properties.fetch({searchId:p.searchData.searchId,groupId:p.searchData.groupId,sortId:p.searchData.sortId,offset:p.searchData.offset})},fetchBoundsData:function(t){var i,n;"listOnly"!==p.state.listViewType?(i=p.searchMap.map.getBounds().toUrlValue(),n=p.searchMap.map.getCenter().toUrlValue(),e.Utility.LogConsole("App.router.fetchBoundsData: boundary data pulled from current map dimensions and center:"+i)):(i=e.Helpers.UrlQueryVar("b",null),n=e.Helpers.UrlQueryVar("c",null),e.Utility.LogConsole("App.router.fetchBoundsData: boundary data pulled from query string: "+i)),t||p.router.navigate(e.Helpers.Path({sortId:p.searchData.sortId,z:p.searchMap.map.getZoom(),offset:p.searchData.offset,c:n,g:1,b:i,l:null})),p.properties.fetch({searchId:p.searchData.searchId,groupId:p.searchData.groupId,sortId:p.searchData.sortId,offset:p.searchData.offset,bounds:i,forceFetch:!0})}}),p.router=new c.Router,c.mapToolbarToggles()},mapToolbarToggles:function(){t(".map-tools .with-dropdown").nrtToggle({duration:0,hide:".map-tools .dropdown",target:"next .dropdown",addClass:"open",classTarget:"self"}),t(".whats-nearby a").click(function(){t(".icon-flag").removeClass("open")}),t(".map-tools .icon-flag").click(function(){t(".icon-location").removeClass("open")})},initPSRPanelCarouselsInview:function(){t("div.property-snapshot-psr-panel").off("inview").one("inview",function(i){var n=t(this).find(".photo-carousel.owl, .no-photo-psr-panel").not(".is-loaded"),o=n.find("img.psr-lazy"),a=o.data("src-psr"),r=o.data("srcset-psr");e.Utility.LogConsole("App: carousel first image: inview"),a!==l&&(n.addClass("is-loading"),o.on("load",function(){var i=t(this);i.removeData("src-psr").removeData("srcset-psr"),n.hasClass("owl")?t(s).trigger(e.SearchListEvent.CAROUSEL_FIRST_IMAGE_LOADED,n):n.parent().find(".open-house").velocity({bottom:0},{duration:1e3},{easing:"easeOutSine"}),n.removeClass("is-loading").addClass("is-loaded"),setTimeout(function(){i.removeClass("psr-lazy")},2e3)}),o.attr("src",a).attr("srcset",r))})},extractLocationsFromUrl:function(e,t){var i=t.indexOf(e);return i>-1?t.slice(i+e.length).replace(/\/.*$/,"").split(",").map(function(e){var t=e.split("_");return{entityId:t[0],entityType:t[1]}}):[]}},t(s).on(e.SearchListEvent.CAROUSEL_FIRST_IMAGE_LOADED,function(e,t){p.owlCarouselSetup(t)}),r.App=p,c.initialize()}(window.NRT,jQuery,google.maps,Backbone,Cookies,Modernizr,window,document);